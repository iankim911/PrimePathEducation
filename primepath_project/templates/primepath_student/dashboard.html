{% extends 'student_base.html' %}

{% block title %}My Classes - PrimePath Student Portal{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2>My Classes</h2>
            <p style="color: #666; margin-bottom: 0;">You are enrolled in {{ total_classes }} class{{ total_classes|pluralize:"es" }}</p>
        </div>
        <div>
            <a href="{% url 'primepath_student:exam_history' %}" class="btn" 
               style="background-color: #1976D2; color: white; padding: 10px 20px;">
                üìä View Exam History
            </a>
        </div>
    </div>
</div>

{% if classes %}
    {% for class_info in classes %}
    <div class="class-card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3>{{ class_info.class_display }}
                    {% if class_info.has_active_exam %}
                    <span class="exam-badge">EXAM AVAILABLE</span>
                    {% endif %}
                </h3>
                <p style="color: #666; margin-top: 5px;">
                    Enrolled since: {{ class_info.assignment.assigned_at|date:"F j, Y" }}
                </p>
            </div>
            <div>
                <a href="{% url 'primepath_student:class_detail' class_info.class_code %}" 
                   class="btn btn-primary">
                    View Class
                </a>
            </div>
        </div>
        
        {% if class_info.has_active_exam %}
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
            <p style="color: #E53935; font-weight: 500;">
                ‚ö†Ô∏è Active Exam Available
            </p>
            <p style="color: #666; margin-top: 5px;">
                Click "View Class" to access the exam
            </p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <div class="card" style="text-align: center; padding: 40px;">
        <h3 style="color: #999; margin-bottom: 10px;">No Classes Yet</h3>
        <p style="color: #666;">You haven't been assigned to any classes yet.</p>
        <p style="color: #666;">Please contact your teacher or administrator for class enrollment.</p>
    </div>
{% endif %}

<!-- Account Settings Card -->
<div class="card" style="margin-top: 30px;">
    <h3 style="color: #1565C0; margin-bottom: 15px;">Account Settings</h3>
    
    <div style="padding: 15px; background-color: #F8F9FA; border-radius: 8px; margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <p style="margin: 0; font-weight: 500;">Kakao Account</p>
                {% if student.kakao_id %}
                <p style="margin: 5px 0 0 0; color: #00C896; font-size: 14px;">‚úì Connected</p>
                {% else %}
                <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">Not connected</p>
                {% endif %}
            </div>
            <div>
                {% if student.kakao_id %}
                <button onclick="unlinkKakao()" class="btn" 
                        style="background-color: #F5F5F5; color: #333; padding: 8px 16px; font-size: 14px;">
                    Disconnect
                </button>
                {% else %}
                <a href="{% url 'primepath_student:kakao_login' %}?next={% url 'primepath_student:dashboard' %}" 
                   class="btn" style="background-color: #FEE500; color: #000; padding: 8px 16px; font-size: 14px; display: inline-flex; align-items: center;">
                    <svg width="16" height="16" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path fill="#000000" d="M12 3C6.48 3 2 6.21 2 10.2c0 2.52 1.78 4.74 4.47 6.02-.15 1.02-.38 2.58-.47 3.18-.09.6.22.81.5.59.28-.22 3.41-2.34 4.72-3.24.58.05 1.17.08 1.78.08 5.52 0 10-3.21 10-7.2S17.52 3 12 3z"/>
                    </svg>
                    Connect Kakao
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <p style="color: #666; margin-top: 10px;">
        Your Student ID: <strong>{{ student.student_id }}</strong>
    </p>
</div>

<div class="card" style="margin-top: 30px; background-color: #F5F5F5;">
    <h3 style="color: #1565C0; margin-bottom: 10px;">Need Help?</h3>
    <p style="color: #666;">
        If you're having trouble accessing your classes or exams, please contact your teacher or school administrator.
    </p>
</div>

{% if student.kakao_id %}
<script>
function unlinkKakao() {
    if (confirm('Are you sure you want to disconnect your Kakao account?')) {
        fetch("{% url 'primepath_student:kakao_unlink' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to disconnect Kakao account');
            }
        })
        .catch(error => {
            alert('An error occurred');
            console.error(error);
        });
    }
}
</script>
{% endif %}
{% endblock %}