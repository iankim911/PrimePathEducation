{% load static %}
{% load navigation_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PrimePath RoutineTest - Continuous Assessment Platform{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}">
    
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" href="{% static 'css/mobile-responsive.css' %}">
    
    
    <!-- Console Debugging for RoutineTest -->
    <script>
        console.log('%c[RoutineTest] Page Loading...', 'color: #00A65E; font-weight: bold;');
        console.log('[RoutineTest] Navigation: Tab-based horizontal layout');
        console.log('[RoutineTest] Theme: BCG Green (#00A65E)');
        console.log('[RoutineTest] Module: Continuous Assessment Platform');
        window.ROUTINETEST_DEBUG = true;
        window.MATRIX_TAB_VERSION = '3.0';
        window.NAVIGATION_TIMESTAMP = new Date().toISOString();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* Header Section - Darker Muted Green Theme (Matching PlacementTest weight) */
        .header {
            background-color: #1B5E20;  /* Darker, more muted green */
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .header h1 {
            text-align: center;
            font-size: 2rem;
        }
        
        .header {
            position: relative; /* For mode toggle positioning */
        }
        
        /* Navigation Tabs - Darker Muted Green Theme (Matching PlacementTest style) */
        .nav-tabs {
            background-color: #0D4F1F;  /* Very dark, muted green */
            padding: 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow-x: auto;  /* Allow horizontal scroll for many tabs */
            -webkit-overflow-scrolling: touch;  /* Smooth scrolling on mobile */
            border-bottom: 2px solid #2E7D32;  /* Visual separation */
        }
        
        /* Custom scrollbar for nav tabs */
        .nav-tabs::-webkit-scrollbar {
            height: 4px;
        }
        
        .nav-tabs::-webkit-scrollbar-track {
            background: #0A3D15;
        }
        
        .nav-tabs::-webkit-scrollbar-thumb {
            background: #2E7D32;
            border-radius: 2px;
        }
        
        /* Removed Matrix tab styles - no longer part of V8 navigation */
        
        .nav-tabs * {
            box-sizing: border-box;
        }
        
        .nav-tabs ul {
            list-style: none;
            display: flex;
            margin: 0 auto;
            max-width: none;  /* Remove width restriction */
            padding: 0 10px;  /* Minimal padding */
            overflow-x: visible;  /* Show all tabs */
            width: 100%;
        }
        
        .nav-tabs li {
            margin: 0;
            padding: 0;
            display: flex;
        }
        
        .nav-tabs a {
            display: block;
            padding: 12px 12px;  /* Even more compact */
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            height: 100%;
            white-space: nowrap;
            font-size: 13px;  /* Smaller font to fit more */
        }
        
        .nav-tabs a:hover {
            background-color: #1B5E20;  /* Darker muted green on hover */
            color: white;
        }
        
        /* WCAG AAA Compliant - High Contrast Active Tab */
        .nav-tabs a.active {
            background-color: #E8F5E9 !important;  /* Light green background */
            color: #0D4F1F !important;  /* Very dark green text - contrast ratio > 7:1 */
            font-weight: 700;
            box-shadow: inset 0 -3px 0 #2E7D32;
            border-top: 2px solid #2E7D32;  /* Top accent for better visibility */
            position: relative;
        }
        
        /* Focus styles for keyboard navigation */
        .nav-tabs a:focus {
            outline: 2px solid #81C784;
            outline-offset: 2px;
            background-color: #1B5E20;
        }
        
        .nav-tabs a.active:focus {
            outline: 2px solid #2E7D32;
            outline-offset: 2px;
        }
        
        /* Profile Link Styling */
        .nav-tabs .profile-link {
            display: flex !important;
            align-items: center;
            white-space: nowrap !important;
            min-width: fit-content;
        }
        
        .nav-tabs .profile-link span {
            display: inline-block;
            vertical-align: middle;
        }
        
        /* Logout Button - Red */
        #logout-link {
            background-color: #e74c3c !important;
            color: white !important;
        }
        
        #logout-link:hover {
            background-color: #c0392b !important;
        }
        
        /* Container - Full width for navigation */
        .container {
            max-width: 100%;  /* Full width */
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Content container with max width */
        .content-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Content Area */
        .content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }
        
        /* Messages/Alerts - BCG Green Theme */
        .messages {
            margin-bottom: 20px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .alert-success {
            background-color: #F1F8E9;
            border: 1px solid #689F38;  /* Muted olive green border */
            color: #33691E;  /* Dark olive green text */
        }
        
        .alert-info {
            background-color: #E0F2F1;
            border: 1px solid #00ACC1;
            color: #004D40;
        }
        
        .alert-warning {
            background-color: #FFF3E0;
            border: 1px solid #FF9800;
            color: #E65100;
        }
        
        .alert-danger {
            background-color: #FFEBEE;
            border: 1px solid #F44336;
            color: #B71C1C;
        }
        
        .close-alert {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
            margin-left: 20px;
        }
        
        /* Buttons - Darker Muted Green Theme */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #2E7D32;  /* Darker muted green */
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #1B5E20;  /* Even darker on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(27, 94, 32, 0.3);
        }
        
        .btn-secondary {
            background-color: #558B57;  /* Muted sage green */
        }
        
        .btn-secondary:hover {
            background-color: #3D6F3F;  /* Darker sage green */
        }
        
        /* Danger button - MUST stay red for destructive actions */
        .btn-danger,
        button.btn-danger,
        .btn.btn-danger,
        button[onclick*="confirmDelete"] {
            background-color: #dc3545 !important;
            background-image: none !important;
            border-color: #dc3545 !important;
            color: white !important;
        }
        
        .btn-danger:hover,
        button.btn-danger:hover,
        .btn.btn-danger:hover,
        button[onclick*="confirmDelete"]:hover {
            background-color: #c82333 !important;
            background-image: none !important;
            border-color: #bd2130 !important;
            transform: translateY(-2px) !important;
        }
        
        /* NUCLEAR OVERRIDE - Ensure delete buttons are NEVER green */
        .routinetest-theme .btn-danger,
        .routinetest-theme button.btn-danger,
        .routinetest-theme .btn.btn-danger,
        .routinetest-theme button[onclick*="confirmDelete"],
        body.routinetest-theme .btn-danger,
        body.routinetest-theme button.btn-danger,
        body.routinetest-theme button[onclick*="confirmDelete"] {
            background-color: #dc3545 !important;
            background-image: none !important;
            border-color: #dc3545 !important;
            color: white !important;
        }
        
        /* Form Controls - Softer Green Theme */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #90A4AE;  /* Muted gray-green border */
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2E7D32;  /* Darker green on focus */
            box-shadow: 0 0 0 0.2rem rgba(46, 125, 50, 0.20);
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #263238;  /* Dark gray for better readability */
        }
    </style>
    
    {% block extra_css %}{% endblock %}
    
</head>
<body class="routinetest-theme">
    <!-- Immediate theme application -->
    <script>
        // Apply theme class immediately to prevent FOUC
        document.documentElement.classList.add('routinetest-theme');
        if (document.body) {
            document.body.classList.add('routinetest-theme');
        }
    </script>
    <!-- Debug Console Logger -->
    <script>
        console.group('%cðŸŽ¨ RoutineTest Navigation Loaded', 'background: #00A65E; color: white; padding: 5px; border-radius: 3px;');
        console.log('Theme: BCG Green (#00A65E)');
        console.log('Navigation: Horizontal Tab Layout');
        console.log('Module: RoutineTest - Exam Management System');
        console.log('User: {% if user.is_authenticated %}{{ user.username }}{% else %}Anonymous{% endif %}');
        console.groupEnd();
    </script>
    
    <!-- Header Section -->
    <div class="header">
        <div class="container">
            <h1>{% block header %}RoutineTest - Exam Management{% endblock %}</h1>
        </div>
    </div>
    
    <!-- Navigation Tabs - Version 8.0 with Complete Cache Busting -->
    <!-- UNIFIED CLASSES & EXAMS ONLY - NO OLD TABS -->
    {% include 'primepath_routinetest/includes/navigation_tabs_v8.html' %}
    
    
    <!-- Additional Navigation Verification -->
    <script>
        console.log('[ROUTINETEST_BASE] Loading Navigation V8 at', new Date().toISOString());
        console.log('[ROUTINETEST_BASE] User: {{ user.username|default:"Anonymous" }}');
        console.log('[ROUTINETEST_BASE] Cache Bust: {% now "U" %}');
    </script>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Messages/Alerts -->
        {% if messages %}
            <div class="messages" id="message-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        <button type="button" class="close-alert" onclick="this.parentElement.style.display='none'">&times;</button>
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
            <script>
                // Auto-scroll to top when there's a message
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Auto-hide success messages after 10 seconds
                setTimeout(function() {
                    const successAlerts = document.querySelectorAll('.alert-success');
                    successAlerts.forEach(function(alert) {
                        alert.style.transition = 'opacity 0.5s ease-out';
                        alert.style.opacity = '0';
                        setTimeout(function() {
                            alert.style.display = 'none';
                        }, 500);
                    });
                }, 10000);
                
                console.log('[RoutineTest] Messages displayed:', document.querySelectorAll('.alert').length);
            </script>
        {% endif %}
        
        <!-- Page Content -->
        <div class="content">
            {% block content %}{% endblock %}
        </div>
    </div>
    
    <!-- Load RoutineTest Theme CSS IMMEDIATELY after base styles -->
    <link rel="stylesheet" href="{% static 'css/routinetest-theme.css' %}?v={% now 'U' %}">
    
    <!-- Pre-apply theme class to prevent FOUC and ensure CSS rules work -->
    <script>
    (function() {
        // Apply theme class immediately to prevent flash of unstyled content
        document.documentElement.classList.add('routinetest-theme');
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.body.classList.contains('routinetest-theme')) {
                document.body.classList.add('routinetest-theme');
                console.log('[Theme Pre-apply] Added routinetest-theme class to body');
            }
        });
    })();
    </script>
    
    <!-- Load RoutineTest Theme JS -->
    <script src="{% static 'js/routinetest-theme.js' %}?v={% now 'U' %}"></script>
    
    <!-- Removed redundant matrix tab JavaScript files - Navigation V8 handles this -->
    
    <!-- Navigation JavaScript with Console Debugging -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.group('%c[RoutineTest Navigation] Initialization', 'color: #00A65E; font-weight: bold;');
            
            // Log navigation state
            const navTabs = document.querySelectorAll('.nav-tabs a');
            console.log(`Found ${navTabs.length} navigation tabs`);
            
            // Log active tab
            const activeTab = document.querySelector('.nav-tabs a.active');
            if (activeTab) {
                console.log('Active Tab:', activeTab.getAttribute('data-nav') || activeTab.textContent.trim());
                console.log('Active URL:', activeTab.href);
            }
            
            // Add click tracking to all nav items
            navTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    const navName = this.getAttribute('data-nav') || this.textContent.trim();
                    console.log(`%c[RoutineTest Nav Click] ${navName}`, 'color: #00A65E;');
                    console.log('Target URL:', this.href);
                    console.log('Timestamp:', new Date().toISOString());
                    
                    // Track navigation in sessionStorage
                    const navHistory = JSON.parse(sessionStorage.getItem('routinetest_nav_history') || '[]');
                    navHistory.push({
                        tab: navName,
                        url: this.href,
                        timestamp: new Date().toISOString()
                    });
                    sessionStorage.setItem('routinetest_nav_history', JSON.stringify(navHistory.slice(-10))); // Keep last 10
                });
            });
            
            // Log authentication state
            const authState = {
                authenticated: {% if user.is_authenticated %}true{% else %}false{% endif %},
                username: {% if user.is_authenticated %}'{{ user.username }}'{% else %}null{% endif %},
                fullName: {% if user.is_authenticated %}'{{ user.get_full_name }}'{% else %}null{% endif %},
                is_staff: {% if user.is_authenticated %}{{ user.is_staff|lower }}{% else %}false{% endif %},
                page: '{{ request.resolver_match.url_name }}',
                path: '{{ request.path }}',
                timestamp: new Date().toISOString()
            };
            
            console.log('[RoutineTest Auth State]', authState);
            
            // Log theme confirmation
            console.log('[RoutineTest Theme Check]', {
                primaryColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') || '#00A65E',
                headerBg: getComputedStyle(document.querySelector('.header')).background,
                navBg: getComputedStyle(document.querySelector('.nav-tabs')).backgroundColor
            });
            
            // Performance metrics
            if (window.performance) {
                const perfData = window.performance.timing;
                const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                console.log(`[RoutineTest Performance] Page load time: ${pageLoadTime}ms`);
            }
            
            console.groupEnd();
            
            // Navigation history display
            const navHistory = JSON.parse(sessionStorage.getItem('routinetest_nav_history') || '[]');
            if (navHistory.length > 0) {
                console.group('%c[RoutineTest Navigation History]', 'color: #007C3F;');
                console.table(navHistory);
                console.groupEnd();
            }
        });
        
        // Logout confirmation
        const logoutLink = document.getElementById('logout-link');
        if (logoutLink) {
            logoutLink.addEventListener('click', function(e) {
                console.log('[RoutineTest] Logout initiated');
                if (!confirm('Are you sure you want to logout?')) {
                    e.preventDefault();
                    console.log('[RoutineTest] Logout cancelled');
                }
            });
        }
        
        // Global error handler for debugging
        window.addEventListener('error', function(e) {
            console.error('[RoutineTest Error]', {
                message: e.message,
                filename: e.filename,
                line: e.lineno,
                column: e.colno,
                error: e.error
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>