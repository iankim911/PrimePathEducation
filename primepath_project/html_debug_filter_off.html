

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Library - RoutineTest</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="shortcut icon" href="/static/favicon.ico">
    
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" href="/static/css/mobile-responsive.css">
    
    <!-- Mode Toggle Position Fix - MUST LOAD LAST TO OVERRIDE -->
    <link rel="stylesheet" href="/static/css/mode-toggle-position-fix.css?v=1755845820">
    
    <!-- Console Debugging for RoutineTest -->
    <script>
        console.log('%c[RoutineTest] Page Loading...', 'color: #00A65E; font-weight: bold;');
        console.log('[RoutineTest] Navigation: Tab-based horizontal layout');
        console.log('[RoutineTest] Theme: BCG Green (#00A65E)');
        console.log('[RoutineTest] Module: Continuous Assessment Platform');
        window.ROUTINETEST_DEBUG = true;
        window.MATRIX_TAB_VERSION = '3.0';
        window.NAVIGATION_TIMESTAMP = new Date().toISOString();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* Header Section - Darker Muted Green Theme (Matching PlacementTest weight) */
        .header {
            background-color: #1B5E20;  /* Darker, more muted green */
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .header h1 {
            text-align: center;
            font-size: 2rem;
        }
        
        .header {
            position: relative; /* For mode toggle positioning */
        }
        
        /* Navigation Tabs - Darker Muted Green Theme (Matching PlacementTest style) */
        .nav-tabs {
            background-color: #0D4F1F;  /* Very dark, muted green */
            padding: 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow-x: auto;  /* Allow horizontal scroll for many tabs */
            -webkit-overflow-scrolling: touch;  /* Smooth scrolling on mobile */
        }
        
        /* Custom scrollbar for nav tabs */
        .nav-tabs::-webkit-scrollbar {
            height: 4px;
        }
        
        .nav-tabs::-webkit-scrollbar-track {
            background: #0A3D15;
        }
        
        .nav-tabs::-webkit-scrollbar-thumb {
            background: #2E7D32;
            border-radius: 2px;
        }
        
        /* Matrix Tab Pulse Animation */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7);
            }
            50% {
                box-shadow: 0 0 10px 5px rgba(255, 152, 0, 0.3);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 152, 0, 0);
            }
        }
        
        /* Ensure Matrix Tab is ALWAYS visible */
        #matrix-tab-item {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #matrix-tab-item a {
            display: block !important;
            visibility: visible !important;
        }
        
        .nav-tabs * {
            box-sizing: border-box;
        }
        
        .nav-tabs ul {
            list-style: none;
            display: flex;
            margin: 0 auto;
            max-width: none;  /* Remove width restriction */
            padding: 0 10px;  /* Minimal padding */
            overflow-x: visible;  /* Show all tabs */
            width: 100%;
        }
        
        .nav-tabs li {
            margin: 0;
            padding: 0;
            display: flex;
        }
        
        .nav-tabs a {
            display: block;
            padding: 12px 12px;  /* Even more compact */
            color: #ecf0f1;
            text-decoration: none;
            transition: background-color 0.3s;
            font-weight: 500;
            position: relative;
            height: 100%;
            white-space: nowrap;
            font-size: 13px;  /* Smaller font to fit more */
        }
        
        .nav-tabs a:hover {
            background-color: #1B5E20;  /* Darker muted green on hover */
        }
        
        .nav-tabs a.active {
            background-color: #2E7D32 !important;  /* Darker green for active */
            color: white;
            font-weight: 600;
            box-shadow: inset 0 -3px 0 rgba(255, 255, 255, 0.15);
        }
        
        /* Profile Link Styling */
        .nav-tabs .profile-link {
            display: flex !important;
            align-items: center;
            white-space: nowrap !important;
            min-width: fit-content;
        }
        
        .nav-tabs .profile-link span {
            display: inline-block;
            vertical-align: middle;
        }
        
        /* Logout Button - Red */
        #logout-link {
            background-color: #e74c3c !important;
            color: white !important;
        }
        
        #logout-link:hover {
            background-color: #c0392b !important;
        }
        
        /* Container - Full width for navigation */
        .container {
            max-width: 100%;  /* Full width */
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Content container with max width */
        .content-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Content Area */
        .content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }
        
        /* Messages/Alerts - BCG Green Theme */
        .messages {
            margin-bottom: 20px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .alert-success {
            background-color: #F1F8E9;
            border: 1px solid #689F38;  /* Muted olive green border */
            color: #33691E;  /* Dark olive green text */
        }
        
        .alert-info {
            background-color: #E0F2F1;
            border: 1px solid #00ACC1;
            color: #004D40;
        }
        
        .alert-warning {
            background-color: #FFF3E0;
            border: 1px solid #FF9800;
            color: #E65100;
        }
        
        .alert-danger {
            background-color: #FFEBEE;
            border: 1px solid #F44336;
            color: #B71C1C;
        }
        
        .close-alert {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
            margin-left: 20px;
        }
        
        /* Buttons - Darker Muted Green Theme */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #2E7D32;  /* Darker muted green */
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #1B5E20;  /* Even darker on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(27, 94, 32, 0.3);
        }
        
        .btn-secondary {
            background-color: #558B57;  /* Muted sage green */
        }
        
        .btn-secondary:hover {
            background-color: #3D6F3F;  /* Darker sage green */
        }
        
        /* Danger button - MUST stay red for destructive actions */
        .btn-danger,
        button.btn-danger,
        .btn.btn-danger,
        button[onclick*="confirmDelete"] {
            background-color: #dc3545 !important;
            background-image: none !important;
            border-color: #dc3545 !important;
            color: white !important;
        }
        
        .btn-danger:hover,
        button.btn-danger:hover,
        .btn.btn-danger:hover,
        button[onclick*="confirmDelete"]:hover {
            background-color: #c82333 !important;
            background-image: none !important;
            border-color: #bd2130 !important;
            transform: translateY(-2px) !important;
        }
        
        /* NUCLEAR OVERRIDE - Ensure delete buttons are NEVER green */
        .routinetest-theme .btn-danger,
        .routinetest-theme button.btn-danger,
        .routinetest-theme .btn.btn-danger,
        .routinetest-theme button[onclick*="confirmDelete"],
        body.routinetest-theme .btn-danger,
        body.routinetest-theme button.btn-danger,
        body.routinetest-theme button[onclick*="confirmDelete"] {
            background-color: #dc3545 !important;
            background-image: none !important;
            border-color: #dc3545 !important;
            color: white !important;
        }
        
        /* Form Controls - Softer Green Theme */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #90A4AE;  /* Muted gray-green border */
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2E7D32;  /* Darker green on focus */
            box-shadow: 0 0 0 0.2rem rgba(46, 125, 50, 0.20);
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #263238;  /* Dark gray for better readability */
        }
    </style>
    
    
    
    <!-- Mode Toggle Fix Scripts -->
    <script src="/static/js/routinetest/mode-toggle-fix.js?v=1755845820" defer></script>
    <script src="/static/js/routinetest/aggressive-mode-fix.js?v=1755845820"></script>
    
    <!-- Inline Mode Toggle Fix (Immediate Execution) -->
    <script>
    // Immediate fix for "function:" text issue
    (function() {
        function fixModeToggleText() {
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                if (el.childNodes.length === 1 && el.firstChild && el.firstChild.nodeType === 3) {
                    const text = el.firstChild.nodeValue;
                    if (text && text.includes('function:')) {
                        console.warn('[IMMEDIATE_FIX] Found and fixing "function:" text:', text);
                        el.firstChild.nodeValue = text.replace(/function\s*:\s*/gi, '');
                    }
                }
            });
            
            // Remove any toggles from stats areas
            const statsAreas = document.querySelectorAll('.class-stats, .class-stat, .stats-box, .stat-box');
            statsAreas.forEach(area => {
                const toggles = area.querySelectorAll('[class*="toggle"]');
                if (toggles.length > 0) {
                    console.warn('[IMMEDIATE_FIX] Removing toggles from stats area');
                    toggles.forEach(t => t.remove());
                }
            });
        }
        
        // Run multiple times to catch dynamic content
        fixModeToggleText();
        setTimeout(fixModeToggleText, 0);
        setTimeout(fixModeToggleText, 100);
        setTimeout(fixModeToggleText, 500);
        
        // Also run on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fixModeToggleText);
        } else {
            fixModeToggleText();
        }
    })();
    </script>
</head>
<body class="routinetest-theme">
    <!-- Immediate theme application -->
    <script>
        // Apply theme class immediately to prevent FOUC
        document.documentElement.classList.add('routinetest-theme');
        if (document.body) {
            document.body.classList.add('routinetest-theme');
        }
    </script>
    <!-- Debug Console Logger -->
    <script>
        console.group('%cðŸŽ¨ RoutineTest Navigation Loaded', 'background: #00A65E; color: white; padding: 5px; border-radius: 3px;');
        console.log('Theme: BCG Green (#00A65E)');
        console.log('Navigation: Horizontal Tab Layout');
        console.log('Module: RoutineTest - Exam Management System');
        console.log('User: teacher1');
        console.groupEnd();
    </script>
    
    <!-- Header Section -->
    <div class="header">
        <div class="container">
            <h1>Exam Library</h1>
        </div>
    </div>
    
    <!-- Navigation Tabs - Version 8.0 with Complete Cache Busting -->
    <!-- UNIFIED CLASSES & EXAMS ONLY - NO OLD TABS -->
    <!-- RoutineTest Navigation - VERSION 8.0 UNIFIED COMPLETE -->
<!-- Cache Bust: 1755845820 -->
<!-- NO OLD TABS - UNIFIED CLASSES & EXAMS ONLY -->
<nav class="nav-tabs" id="routinetest-nav-v8-5" data-version="8.0" data-timestamp="2025-08-22T15:57:00.124155+09:00">
    <ul style="display: flex; justify-content: space-between; width: 100%;">
        <div style="display: flex; flex: 1;">
            <!-- Dashboard -->
            <li>
                <a href="/RoutineTest/" 
                   data-nav="dashboard"
                   class="">
                   Dashboard
                </a>
            </li>
            
            <!-- Upload Exam -->
            <li>
                <a href="/RoutineTest/exams/create/" 
                   data-nav="upload"
                   class="">
                   Upload Exam
                </a>
            </li>
            
            <!-- Exam Library -->
            <li>
                <a href="/RoutineTest/exams/" 
                   data-nav="keys"
                   class="active">
                   Exam Library
                </a>
            </li>
            
            <!-- UNIFIED CLASSES & EXAMS TAB (VERSION 8) -->
            <li id="unified-tab-v8">
                <a href="/RoutineTest/classes-exams/" 
                   data-nav="classes-exams"
                   class="">
                   Classes & Exams
                </a>
            </li>
            
            <!-- Results & Analytics -->
            <li>
                <a href="/RoutineTest/sessions/" 
                   data-nav="results"
                   class="">
                   Results & Analytics
                </a>
            </li>
            
            <!-- Admin Only: Curriculum Mapping - Only show in Admin mode -->
            
        </div>
        
        <!-- User Section -->
        <div style="display: flex; margin-left: auto;">
            
                <li><a href="#" class="profile-link">ðŸ‘¤ teacher1</a></li>
                <li><a href="/logout/" style="background: #e74c3c;">Logout</a></li>
            
        </div>
    </ul>
</nav>

<!-- Aggressive Cache Busting and Verification Script -->
<script>
(function() {
    const navVersion = 8.0;
    const timestamp = new Date().getTime();
    const userId = '5';
    
    console.group('%c[NAV_V8_UNIFIED] RoutineTest Navigation Version 8.0', 
        'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 5px; font-weight: bold;');
    
    console.log('ðŸ“Œ Version:', navVersion);
    console.log('â±ï¸ Timestamp:', new Date(timestamp).toISOString());
    console.log('ðŸ‘¤ User:', userId);
    console.log('ðŸ”„ Cache Bust ID:', timestamp);
    
    // Log URL resolution from Django templates
    console.group('ðŸ”— URL Resolution from Django:');
    console.log('Dashboard URL: /RoutineTest/');
    console.log('Create Exam URL: /RoutineTest/exams/create/');
    console.log('Exam List URL: /RoutineTest/exams/');
    console.log('Classes & Exams URL: /RoutineTest/classes-exams/');
    console.log('Session List URL: /RoutineTest/sessions/');
    
    console.groupEnd();
    
    // Verify navigation structure
    const nav = document.getElementById('routinetest-nav-v8-' + userId);
    if (nav) {
        console.log('âœ… Navigation V8 element found');
        
        // Count and log all tabs
        const allTabs = nav.querySelectorAll('a[data-nav]');
        console.log('ðŸ“Š Total navigation tabs:', allTabs.length);
        
        const tabStructure = [];
        allTabs.forEach((tab, index) => {
            const text = tab.textContent.trim();
            const dataNav = tab.getAttribute('data-nav');
            const href = tab.getAttribute('href');
            
            tabStructure.push({
                index: index + 1,
                text: text,
                dataNav: dataNav,
                href: href
            });
            
            // Log each tab
            const isUnified = dataNav === 'classes-exams';
            const marker = isUnified ? 'ðŸŽ¯' : '  ';
            console.log(`${marker} Tab ${index + 1}: "${text}" [${dataNav}] â†’ ${href}`);
        });
        
        // Check for unified tab
        const unifiedTab = nav.querySelector('a[data-nav="classes-exams"]');
        if (unifiedTab) {
            console.log('âœ… UNIFIED TAB FOUND:', unifiedTab.textContent.trim());
            
            // Force visibility
            const unifiedLi = document.getElementById('unified-tab-v8');
            if (unifiedLi) {
                unifiedLi.style.display = 'flex';
                unifiedLi.style.visibility = 'visible';
                unifiedLi.style.opacity = '1';
                console.log('âœ… Unified tab visibility enforced (consistent styling applied)');
            }
        } else {
            console.error('âŒ UNIFIED TAB NOT FOUND!');
        }
        
        // Check for OLD tabs (should not exist)
        const oldTabsCheck = Array.from(allTabs).filter(tab => {
            const text = tab.textContent;
            const dataNav = tab.getAttribute('data-nav');
            return (text.includes('My Classes') && text.includes('Access')) || 
                   text.includes('Exam Assignments') ||
                   dataNav === 'my-classes' ||
                   dataNav === 'exam-assignments';
        });
        
        if (oldTabsCheck.length > 0) {
            console.error('âŒ OLD TABS DETECTED:', oldTabsCheck.map(t => t.textContent.trim()));
            console.error('These tabs should be removed!');
            
            // Remove old tabs dynamically
            oldTabsCheck.forEach(tab => {
                const li = tab.closest('li');
                if (li) {
                    li.style.display = 'none';
                    console.log('ðŸ—‘ï¸ Hiding old tab:', tab.textContent.trim());
                }
            });
        } else {
            console.log('âœ… No old tabs found - navigation is clean');
        }
        
        // Store navigation state
        window.ROUTINETEST_NAV_V8 = {
            version: navVersion,
            timestamp: timestamp,
            tabs: tabStructure,
            unified: unifiedTab ? true : false
        };
        
    } else {
        console.error('âŒ Navigation V8 element not found!');
    }
    
    console.groupEnd();
    
    // Track any URL modifications
    const originalUrls = {};
    document.querySelectorAll('.nav-tabs a').forEach(link => {
        const dataNav = link.getAttribute('data-nav');
        if (dataNav) {
            originalUrls[dataNav] = link.href;
        }
    });
    
    // Periodic check to ensure navigation stays correct and URLs aren't modified
    let checkCount = 0;
    const checkInterval = setInterval(function() {
        checkCount++;
        
        const tabs = document.querySelectorAll('.nav-tabs a[data-nav]');
        
        // Check for URL modifications
        tabs.forEach(tab => {
            const dataNav = tab.getAttribute('data-nav');
            if (dataNav && originalUrls[dataNav] && tab.href !== originalUrls[dataNav]) {
                console.error(`[URL_MODIFIED] ${dataNav}: ${originalUrls[dataNav]} â†’ ${tab.href}`);
            }
        });
        
        const hasOldTabs = Array.from(tabs).some(tab => 
            tab.getAttribute('data-nav') === 'my-classes' || 
            tab.getAttribute('data-nav') === 'exam-assignments'
        );
        
        if (hasOldTabs) {
            console.warn(`[NAV_V8_CHECK_${checkCount}] Old tabs detected at ${new Date().toISOString()}`);
            // Hide them
            tabs.forEach(tab => {
                if (tab.getAttribute('data-nav') === 'my-classes' || 
                    tab.getAttribute('data-nav') === 'exam-assignments') {
                    tab.closest('li').style.display = 'none';
                }
            });
        }
        
        if (checkCount >= 5) {
            clearInterval(checkInterval);
            console.log('[NAV_V8_MONITORING] Completed 5 checks, navigation stable');
        }
    }, 1000);
})();

// Simple navigation debouncing to prevent rapid clicking
(function() {
    let lastClickTime = 0;
    const clickDelay = 300; // 300ms debounce
    
    document.addEventListener('click', function(e) {
        const navLink = e.target.closest('.nav-tabs a');
        if (navLink) {
            const now = Date.now();
            if (now - lastClickTime < clickDelay) {
                e.preventDefault();
                return false;
            }
            lastClickTime = now;
        }
    });
})();
</script>

<style>
/* Navigation V8 Specific Styles */
#routinetest-nav-v8-5 {
    position: relative;
    z-index: 1000;
}

#unified-tab-v8 {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Hide any old tabs if they somehow appear */
li:has(a[data-nav="my-classes"]),
li:has(a[data-nav="exam-assignments"]) {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
}
</style>
    
    <!-- Mode Toggle - Positioned below navigation -->
    
    
    <!-- Additional Navigation Verification -->
    <script>
        console.log('[ROUTINETEST_BASE] Loading Navigation V8 at', new Date().toISOString());
        console.log('[ROUTINETEST_BASE] User: teacher1');
        console.log('[ROUTINETEST_BASE] Cache Bust: 1755845820');
    </script>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Messages/Alerts -->
        
        
        <!-- Page Content -->
        <div class="content">
            
<!-- CSRF Token for AJAX requests -->
<input type="hidden" name="csrfmiddlewaretoken" value="yyfeLvzkJzBaA4KBO4guHgw6USf4cPfVZU79Mn4slTm0geBuGz5GZsVqsR8LyZrA">

<!-- ============================================================================ -->
<!-- CRITICAL: Global Functions - MUST load before any buttons are rendered      -->
<!-- ============================================================================ -->
<!-- CRITICAL FUNCTIONS - Must be loaded IMMEDIATELY in global scope -->
<!-- This script MUST be included right after <body> tag or in <head> -->
<script>
(function() {
    'use strict';
    
    console.log('%c[CRITICAL_FUNCTIONS] Initializing global exam functions...', 'color: #FF6B6B; font-weight: bold');
    
    // ============================================================================
    // GLOBAL FUNCTION DEFINITIONS - MUST BE AVAILABLE BEFORE ANY ONCLICK
    // ============================================================================
    
    // Track initialization
    window.EXAM_FUNCTIONS_READY = false;
    window.EXAM_FUNCTIONS_INIT_TIME = Date.now();
    
    // Track deletion state to prevent multiple requests
    window.DELETION_IN_PROGRESS = {};
    
    // Delete functionality
    window.confirmDelete = function(examId, examName) {
        console.log('%c[DELETE] confirmDelete called', 'color: #e74c3c; font-weight: bold', {
            examId: examId,
            examName: examName,
            timestamp: new Date().toISOString()
        });
        
        if (!examId) {
            console.warn('[DELETE] No exam ID provided');
            alert('Error: No exam ID provided for deletion');
            return;
        }
        
        // Check if deletion is already in progress for this exam
        if (window.DELETION_IN_PROGRESS[examId]) {
            console.warn('[DELETE] Deletion already in progress for exam:', examId);
            return;
        }
        
        const confirmMessage = `Are you sure you want to delete "${examName || 'this exam'}"?\n\nThis action cannot be undone.`;
        
        if (confirm(confirmMessage)) {
            console.log('[DELETE] User confirmed deletion');
            window.deleteExam(examId);
        } else {
            console.log('[DELETE] User cancelled deletion');
        }
    };
    
    window.deleteExam = async function(examId) {
        // ENHANCED COMPREHENSIVE DEBUGGING
        const deleteDebugInfo = {
            examId: examId,
            timestamp: new Date().toISOString(),
            user: document.querySelector('meta[name="user-name"]')?.content || 'Unknown',
            userId: document.querySelector('meta[name="user-id"]')?.content || 'Unknown',
            isAdmin: document.querySelector('meta[name="user-is-admin"]')?.content === 'true',
            currentUrl: window.location.href,
            examCard: document.querySelector(`[data-exam-id="${examId}"]`) ? 'Found' : 'Not Found'
        };
        
        console.log('%c[DELETE] ðŸš¨ Starting exam deletion', 'color: #e74c3c; font-weight: bold', deleteDebugInfo);
        
        // Prevent multiple simultaneous deletions
        if (window.DELETION_IN_PROGRESS[examId]) {
            console.warn('[DELETE] âš ï¸ Already processing deletion for exam:', examId);
            return;
        }
        
        // Mark as in progress
        window.DELETION_IN_PROGRESS[examId] = true;
        
        // Disable all delete buttons temporarily
        const deleteButtons = document.querySelectorAll('button[onclick*="confirmDelete"]');
        deleteButtons.forEach(btn => {
            if (btn.onclick && btn.onclick.toString().includes(examId)) {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            }
        });
        
        // Track if this is a permission denial
        let isPermissionDenied = false;
        let result = null;  // Initialize result variable in outer scope
        
        console.log('[DELETE] Starting deletion process for exam:', examId);
        
        try {
            const deleteUrl = `/RoutineTest/exams/${examId}/delete/`;
            console.log('[DELETE] Sending DELETE request to:', deleteUrl);
            
            // Get CSRF token
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                             document.querySelector('meta[name="csrf-token"]')?.content || '';
            
            if (!csrfToken) {
                console.warn('[DELETE] No CSRF token found, request may fail');
            }
            
            // ENHANCED REQUEST WITH DEBUGGING
            console.log('[DELETE] ðŸ“¡ Sending DELETE request with:', {
                url: deleteUrl,
                method: 'DELETE',
                hasCSRFToken: !!csrfToken,
                csrfTokenLength: csrfToken ? csrfToken.length : 0
            });
            
            const response = await fetch(deleteUrl, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'  // Ensure cookies are sent
            });
            
            // Only log non-permission responses
            if (response.status !== 403) {
                console.log('[DELETE] Response received:', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                });
            }
            
            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch (jsonError) {
                    errorData = { error: `HTTP error! status: ${response.status}` };
                }
                
                // Handle permission errors with enhanced debugging
                if (response.status === 403) {
                    // COMPREHENSIVE PERMISSION DENIAL DEBUGGING
                    const permissionDebug = {
                        status: 'Access Denied (403)',
                        examId: examId,
                        errorResponse: errorData,
                        userInfo: deleteDebugInfo,
                        timestamp: new Date().toISOString()
                    };
                    
                    console.group('%c[DELETE] âŒ PERMISSION DENIED', 'color: #e74c3c; font-weight: bold');
                    console.log('Debug Info:', permissionDebug);
                    console.log('Server Response:', errorData);
                    console.log('Detailed Error:', errorData.details || 'No details provided');
                    console.groupEnd();
                    
                    // Clean up the error message for better user experience
                    let permissionMessage = errorData.error || 
                        "You do not have permission to delete this exam.";
                    
                    // Log permission denial with full context
                    console.info('%c[DELETE] Permission check result:', 'color: #f39c12', {
                        status: 'Access Denied',
                        reason: errorData.details?.reason || 'Insufficient permissions',
                        required: 'FULL access',
                        message: 'This is expected behavior - user needs FULL access to delete'
                    });
                    
                    // Clean up message if needed
                    if (!permissionMessage.includes('Access Denied') && !permissionMessage.includes('FULL access')) {
                        permissionMessage = "You do not have the required access level to delete this exam. Only teachers with FULL access can delete exams.";
                    }
                    
                    // Show user-friendly notification
                    if (window.showErrorNotification) {
                        window.showErrorNotification(permissionMessage);
                    } else {
                        alert('Access Denied\n\n' + permissionMessage);
                    }
                    
                    // Mark as permission denied - DON'T throw error, DON'T return early
                    isPermissionDenied = true;
                    console.log('[DELETE] Permission denied flag set, skipping further processing');
                } else {
                    // Only log non-permission errors
                    console.error('[DELETE] Server error (non-403):', {
                        status: response.status,
                        error: errorData,
                        examId: examId
                    });
                    
                    // For other errors, throw to be caught by catch block
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
            }
            
            // Only process success response if not a permission denial
            if (!isPermissionDenied && response.ok) {
                const result = await response.json();
                console.log('[DELETE] Processing success response:', {
                    success: result.success,
                    message: result.message,
                    examId: examId
                });
                
                if (result.success) {
                    // Find and remove the exam card from DOM
                    const examCard = document.querySelector(`button[onclick*="${examId}"]`)?.closest('.exam-card');
                    if (examCard) {
                        console.log('[DELETE] Removing exam card from DOM');
                        const classExams = examCard.closest('.class-exams');
                        
                        // Animate removal
                        examCard.style.transition = 'opacity 0.3s, transform 0.3s';
                        examCard.style.opacity = '0';
                        examCard.style.transform = 'scale(0.95)';
                        
                        setTimeout(() => {
                            examCard.remove();
                            
                            // Check if this was the last exam
                            if (classExams && classExams.querySelectorAll('.exam-card').length === 0) {
                                classExams.innerHTML = '<div class="no-exams">No exams in this class</div>';
                            }
                            
                            // Show success notification
                            if (window.showSuccessNotification) {
                                window.showSuccessNotification('Exam deleted successfully');
                            } else {
                                alert('Exam deleted successfully');
                            }
                        }, 300);
                    } else {
                        console.log('[DELETE] Exam card not found, reloading page');
                        alert('Exam deleted successfully');
                        setTimeout(() => window.location.reload(), 1500);
                    }
                } else if (!isPermissionDenied && result) {
                    // Log as warning, not error, since this is a controlled response
                    console.warn('[DELETE] Server returned success:false', result);
                    alert(result.message || result.error || 'Failed to delete exam');
                }
            }
        } catch (error) {
            // Don't log or handle if permission was already denied
            if (isPermissionDenied) {
                console.log('[DELETE] Skipping error handling - permission already denied');
                return;
            }
            
            // Only log actual errors, not permission denials
            if (error && error.message && !error.message.includes('permission') && !error.message.includes('Access Denied')) {
                console.error('[DELETE] Exception caught:', error);
            }
            
            // Only show error if it's not a permission error (already handled above)
            if (error && error.message && !error.message.includes('permission') && !error.message.includes('Access Denied')) {
                if (window.showErrorNotification) {
                    window.showErrorNotification('Error deleting exam: ' + error.message);
                } else {
                    alert('Error deleting exam: ' + error.message);
                }
            }
        } finally {
            // Always clean up state
            delete window.DELETION_IN_PROGRESS[examId];
            
            // Re-enable delete buttons
            const deleteButtons = document.querySelectorAll('button[onclick*="confirmDelete"]');
            deleteButtons.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(examId)) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                }
            });
            
            console.log('[DELETE] Cleanup complete for exam:', examId);
        }
    };
    
    // Copy functionality
    window.openCopyModal = function(examId, examName) {
        console.log('%c[COPY] openCopyModal called', 'color: #3498db; font-weight: bold', {
            examId: examId,
            examName: examName,
            timestamp: new Date().toISOString()
        });
        
        if (!examId) {
            console.error('[COPY] No exam ID provided');
            alert('Error: No exam ID provided for copying');
            return;
        }
        
        // Check if modal manager is available
        if (window.CopyModalManager && window.CopyModalManager.open) {
            console.log('[COPY] Using CopyModalManager');
            window.CopyModalManager.open(examId, examName);
        } else if (window.openCopyModalInternal) {
            console.log('[COPY] Using openCopyModalInternal');
            window.openCopyModalInternal(examId, examName);
        } else {
            console.error('[COPY] No copy modal handler available yet');
            // Store for later execution
            window.pendingCopyModal = { examId, examName };
            alert('Copy modal is still loading. Please try again in a moment.');
        }
    };
    
    window.closeCopyModal = function() {
        console.log('%c[COPY] closeCopyModal called', 'color: #3498db; font-weight: bold');
        
        if (window.CopyModalManager && window.CopyModalManager.close) {
            window.CopyModalManager.close();
        } else if (window.closeCopyModalInternal) {
            window.closeCopyModalInternal();
        } else {
            // Fallback: try to hide modal directly
            const modal = document.getElementById('copyExamModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    };
    
    // Notification functions
    window.showSuccessNotification = function(message) {
        console.log('[NOTIFICATION] Success:', message);
        if (window.showNotification) {
            window.showNotification(message, 'success');
        } else {
            alert('âœ“ ' + message);
        }
    };
    
    window.showErrorNotification = function(message) {
        console.log('[NOTIFICATION] Error:', message);
        if (window.showNotification) {
            window.showNotification(message, 'error');
        } else {
            alert('âœ— ' + message);
        }
    };
    
    window.showNotification = function(message, type) {
        type = type || 'info';
        console.log(`[NOTIFICATION] ${type}:`, message);
        
        // Remove any existing notifications
        const existingNotification = document.querySelector('.exam-notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `exam-notification notification-${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 10001;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        `;
        
        // Set colors based on type
        if (type === 'success') {
            notification.style.backgroundColor = '#4CAF50';
            notification.style.color = 'white';
        } else if (type === 'error') {
            notification.style.backgroundColor = '#f44336';
            notification.style.color = 'white';
        } else {
            notification.style.backgroundColor = '#2196F3';
            notification.style.color = 'white';
        }
        
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    };
    
    // Mark as ready
    window.EXAM_FUNCTIONS_READY = true;
    
    // Log initialization complete
    const initTime = Date.now() - window.EXAM_FUNCTIONS_INIT_TIME;
    console.log('%c[CRITICAL_FUNCTIONS] Global functions ready!', 'color: #27ae60; font-weight: bold', {
        initTime: initTime + 'ms',
        functions: ['confirmDelete', 'deleteExam', 'openCopyModal', 'closeCopyModal'],
        ready: window.EXAM_FUNCTIONS_READY
    });
    
    // Verify functions are available
    console.log('[CRITICAL_FUNCTIONS] Function availability check:', {
        confirmDelete: typeof window.confirmDelete,
        deleteExam: typeof window.deleteExam,
        openCopyModal: typeof window.openCopyModal,
        closeCopyModal: typeof window.closeCopyModal
    });
    
})();

// Double-check functions are in global scope
console.log('[GLOBAL_CHECK] Functions in window:', {
    confirmDelete: typeof window.confirmDelete === 'function',
    deleteExam: typeof window.deleteExam === 'function',
    openCopyModal: typeof window.openCopyModal === 'function',
    closeCopyModal: typeof window.closeCopyModal === 'function'
});
</script>

<style>
    /* Main Layout */
    .exam-library-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .library-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    /* Global Access Level Indicator */
    .global-access-indicator {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 20px;
    }
    
    .global-access-indicator.view-only {
        background: #fff3e0;
        border: 1px solid #ff9800;
        color: #f57c00;
    }
    
    .global-access-indicator.full-access {
        background: #e8f5e9;
        border: 1px solid #4caf50;
        color: #2e7d32;
    }
    
    .library-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .header-controls {
        display: flex;
        gap: 15px;
        align-items: center;
    }
    
    /* Filter Toggle */
    .filter-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #dee2e6;
    }
    
    .filter-toggle input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }
    
    .filter-toggle label {
        cursor: pointer;
        user-select: none;
        font-weight: 500;
    }
    
    /* Tab System */
    .exam-type-tabs {
        display: flex;
        gap: 0;
        margin-bottom: 30px;
        border-bottom: 2px solid #dee2e6;
        background: #f8f9fa;
        border-radius: 8px 8px 0 0;
        overflow: hidden;
    }
    
    .exam-type-tab {
        flex: 1;
        padding: 15px 20px;
        text-align: center;
        cursor: pointer;
        background: #f8f9fa;
        border: none;
        color: #6c757d;
        font-weight: 500;
        transition: all 0.3s;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .exam-type-tab:hover {
        background: #e9ecef;
        color: #495057;
    }
    
    .exam-type-tab.active {
        background: #2E7D32;
        color: white;
        font-weight: 600;
    }
    
    .tab-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.85rem;
        background: rgba(0,0,0,0.1);
        min-width: 24px;
    }
    
    .exam-type-tab.active .tab-badge {
        background: rgba(255,255,255,0.2);
    }
    
    /* Hierarchical Display */
    .program-section {
        margin-bottom: 40px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .program-header {
        background: linear-gradient(135deg, #2E7D32, #4CAF50);
        color: white;
        padding: 15px 20px;
        font-size: 1.3rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .program-header:hover {
        background: linear-gradient(135deg, #1B5E20, #388E3C);
    }
    
    .program-toggle {
        font-size: 1.2rem;
        transition: transform 0.3s;
    }
    
    .program-section.collapsed .program-toggle {
        transform: rotate(-90deg);
    }
    
    .program-content {
        padding: 20px;
        background: #fafafa;
    }
    
    .program-section.collapsed .program-content {
        display: none;
    }
    
    /* Class Sections */
    .class-section {
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        background: white;
    }
    
    .class-section.accessible {
        border: 2px solid #81C784;
        background: linear-gradient(to right, #E8F5E9 0%, white 5%);
    }
    
    .class-header {
        padding: 12px 15px;
        background: #f5f5f5;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
    }
    
    .class-section.accessible .class-header {
        background: #E8F5E9;
    }
    
    .class-name {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .access-badge {
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .access-badge.full {
        background: #4CAF50;
        color: white;
    }
    
    .access-badge.co-teacher {
        background: #2196F3;
        color: white;
    }
    
    .access-badge.view {
        background: #9E9E9E;
        color: white;
    }
    
    .class-toggle {
        transition: transform 0.3s;
    }
    
    .class-section.collapsed .class-toggle {
        transform: rotate(-90deg);
    }
    
    .class-exams {
        padding: 15px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 15px;
    }
    
    .class-section.collapsed .class-exams {
        display: none;
    }
    
    /* Exam Cards */
    .exam-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        transition: box-shadow 0.2s;
        position: relative;
    }
    
    .exam-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .exam-card.editable {
        border-left: 4px solid #4CAF50;
    }
    
    .exam-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3e50;
        font-size: 1rem;
    }
    
    .exam-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .exam-meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    /* Answer Mapping Status */
    .answer-status {
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 10px;
        font-size: 0.9rem;
    }
    
    .answer-status.complete {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }
    
    .answer-status.partial {
        background: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
    }
    
    .answer-status.not-started {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }
    
    .answer-progress-bar {
        width: 100%;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
        margin: 5px 0;
    }
    
    .answer-progress-fill {
        height: 100%;
        transition: width 0.3s;
    }
    
    .answer-progress-fill.complete {
        background: #28a745;
    }
    
    .answer-progress-fill.partial {
        background: #ffc107;
    }
    
    /* Action Buttons - Improved alignment */
    .exam-actions {
        display: flex;
        gap: 10px;
        flex-wrap: nowrap;  /* Keep buttons on same line */
        margin-top: 10px;
        align-items: center;
    }
    
    .btn {
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 0.9rem;
        text-decoration: none;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
        font-weight: 500;
        min-width: 90px;
        text-align: center;
        display: inline-block;
    }
    
    .btn-view {
        background: #6c757d;
        color: white;
        border-color: #6c757d;
    }
    
    .btn-view:hover {
        background: #5a6268;
        border-color: #545b62;
        color: white;
    }
    
    .btn-edit {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    .btn-edit:hover {
        background: #0056b3;
        border-color: #004085;
        color: white;
    }
    
    .btn-copy {
        background: #17a2b8;
        color: white;
        border-color: #17a2b8;
    }
    
    .btn-copy:hover {
        background: #138496;
        border-color: #117a8b;
    }
    
    /* Delete Button - Clean Red Styling */
    .btn-danger {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
    }
    
    .btn-danger:hover {
        background: #c82333;
        border-color: #bd2130;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.2);
    }
    
    .btn-danger:active {
        background: #bd2130;
        border-color: #b21f2d;
    }
    
    /* ULTIMATE DELETE BUTTON FIX - Maximum CSS specificity and comprehensive coverage */
    
    /* Target ALL possible delete button selectors with maximum specificity */
    html body.routinetest-theme .exam-library-container .exam-actions button.btn-danger,
    html body.routinetest-theme .exam-library-container .exam-actions button[onclick*="confirmDelete"],
    html body.routinetest-theme .exam-hierarchy .exam-actions button.btn-danger,
    html body.routinetest-theme .exam-hierarchy .exam-actions button[onclick*="confirmDelete"],
    html body .exam-library-container .exam-actions button.btn-danger,
    html body .exam-library-container .exam-actions button[onclick*="confirmDelete"],
    html body .exam-hierarchy .exam-actions button.btn-danger,
    html body .exam-hierarchy .exam-actions button[onclick*="confirmDelete"],
    /* Fallback selectors for various scenarios */
    button.btn-danger,
    .btn.btn-danger,
    .exam-actions .btn-danger,
    button[onclick*="confirmDelete"],
    .exam-actions button[onclick*="confirmDelete"],
    /* Override theme CSS that might be greening the buttons */
    .routinetest-theme .btn.btn-danger,
    .routinetest-theme button.btn-danger,
    .routinetest-theme .exam-actions .btn-danger,
    .routinetest-theme .exam-actions button[onclick*="confirmDelete"] {
        background: #dc3545 !important;
        background-color: #dc3545 !important;
        background-image: none !important;
        color: white !important;
        border: 1px solid #dc3545 !important;
        border-color: #dc3545 !important;
        border-top-color: #dc3545 !important;
        border-right-color: #dc3545 !important;
        border-bottom-color: #dc3545 !important;
        border-left-color: #dc3545 !important;
        /* Prevent any theme overrides */
        box-shadow: none !important;
        transform: none !important;
    }
    
    /* Hover states with same specificity pattern */
    html body.routinetest-theme .exam-library-container .exam-actions button.btn-danger:hover,
    html body.routinetest-theme .exam-library-container .exam-actions button[onclick*="confirmDelete"]:hover,
    html body.routinetest-theme .exam-hierarchy .exam-actions button.btn-danger:hover,
    html body.routinetest-theme .exam-hierarchy .exam-actions button[onclick*="confirmDelete"]:hover,
    html body .exam-library-container .exam-actions button.btn-danger:hover,
    html body .exam-library-container .exam-actions button[onclick*="confirmDelete"]:hover,
    html body .exam-hierarchy .exam-actions button.btn-danger:hover,
    html body .exam-hierarchy .exam-actions button[onclick*="confirmDelete"]:hover,
    button.btn-danger:hover,
    .btn.btn-danger:hover,
    .exam-actions .btn-danger:hover,
    button[onclick*="confirmDelete"]:hover,
    .exam-actions button[onclick*="confirmDelete"]:hover,
    .routinetest-theme .btn.btn-danger:hover,
    .routinetest-theme button.btn-danger:hover,
    .routinetest-theme .exam-actions .btn-danger:hover,
    .routinetest-theme .exam-actions button[onclick*="confirmDelete"]:hover {
        background: #c82333 !important;
        background-color: #c82333 !important;
        background-image: none !important;
        border-color: #bd2130 !important;
        border-top-color: #bd2130 !important;
        border-right-color: #bd2130 !important;
        border-bottom-color: #bd2130 !important;
        border-left-color: #bd2130 !important;
        color: white !important;
        /* Keep hover effects but ensure red color */
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3) !important;
    }
    
    /* Focus and active states */
    html body .exam-actions button.btn-danger:focus,
    html body .exam-actions button.btn-danger:active,
    html body .exam-actions button[onclick*="confirmDelete"]:focus,
    html body .exam-actions button[onclick*="confirmDelete"]:active {
        background: #bd2130 !important;
        background-color: #bd2130 !important;
        border-color: #bd2130 !important;
        color: white !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px;
        color: #6c757d;
    }
    
    .no-exams {
        padding: 20px;
        text-align: center;
        color: #6c757d;
        font-style: italic;
    }
    
    /* Summary Stats */
    .summary-stats {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .stat-label {
        font-weight: 500;
        color: #6c757d;
    }
    
    .stat-value {
        font-weight: 600;
        color: #2c3e50;
    }
    
    /* Modal Styles - Fixed with proper specificity */
    .modal {
        display: none;
        position: fixed;
        z-index: 10001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    /* High specificity rule to ensure modal shows */
    body .modal.show,
    body #copyExamModal.show {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    .modal-content {
        background-color: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        z-index: 10002;
    }
    
    /* Ensure modal content is visible */
    #copyExamModal .modal-content {
        background-color: white !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 28px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
        line-height: 20px;
        width: 30px;
        height: 30px;
        text-align: center;
    }
    
    .modal-close:hover,
    .modal-close:focus {
        color: #000;
    }
    
    .modal-content h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: #2c3e50;
        font-size: 1.5rem;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #495057;
    }
    
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        font-size: 1rem;
    }
    
    .form-group p {
        margin: 5px 0;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 4px;
        font-weight: 500;
    }
    
    .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #dee2e6;
    }
    
    .modal-actions .btn {
        min-width: 100px;
    }
    
    .modal-actions .btn-secondary {
        background-color: #6c757d;
        color: white;
    }
    
    .modal-actions .btn-secondary:hover {
        background-color: #5a6268;
    }
    
    /* Ensure modal is always on top */
    #copyExamModal {
        z-index: 10000;
    }
    
    #copyExamModal .modal-content {
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .library-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .class-exams {
            grid-template-columns: 1fr;
        }
        
        /* Responsive button layout for mobile */
        .exam-actions {
            flex-wrap: wrap;  /* Allow wrapping on small screens */
        }
        
        .exam-actions .btn {
            flex: 1;  /* Equal width buttons on mobile */
            min-width: 80px;  /* Smaller minimum width on mobile */
        }
        
        .summary-stats {
            flex-direction: column;
        }
        
        .modal-content {
            width: 95%;
            padding: 20px;
        }
    }
</style>

<div class="exam-library-container">
    <!-- Header -->
    <div class="library-header">
        <h1 class="library-title">Exam Library</h1>
        <div class="header-controls">
            <!-- Filter Toggle -->
            <div class="filter-toggle">
                <input type="checkbox" id="assignedOnlyFilter" >
                <label for="assignedOnlyFilter">Show Assigned Classes Only</label>
            </div>
            
            <!-- Upload Button (Admin or Full Access Teachers) -->
            
            <a href="/RoutineTest/exams/create/" class="btn btn-edit">
                ðŸ“¤ Upload New Exam
            </a>
            
        </div>
    </div>
    
    <!-- Global Access Level Indicator -->
    
    <div class="global-access-indicator full-access">
        
            âœ… Full Access - You can create, edit, and delete exams in your assigned classes
        
    </div>
    
    
    <!-- Summary Stats -->
    <div class="summary-stats">
        <div class="stat-item">
            <span class="stat-label">Total Exams:</span>
            <span class="stat-value">21</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Complete:</span>
            <span class="stat-value" style="color: #28a745;">14</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Partial:</span>
            <span class="stat-value" style="color: #ffc107;">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Not Started:</span>
            <span class="stat-value" style="color: #dc3545;">5</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Editable:</span>
            <span class="stat-value" style="color: #4CAF50;">18</span>
        </div>
        
    </div>
    
    <!-- Exam Type Tabs -->
    <div class="exam-type-tabs">
        <a href="?exam_type=REVIEW" 
           class="exam-type-tab ">
            <span>ðŸ“š Review / Monthly</span>
            <span class="tab-badge">9</span>
        </a>
        
        <a href="?exam_type=QUARTERLY" 
           class="exam-type-tab ">
            <span>ðŸ“Š Quarterly</span>
            <span class="tab-badge">6</span>
        </a>
        
        <a href="?exam_type=ALL" 
           class="exam-type-tab active">
            <span>ðŸ“‹ All Exams</span>
            <span class="tab-badge">15</span>
        </a>
    </div>
    
    <!-- Hierarchical Exam Display -->
    <!-- Debug: hierarchical_exams = {&#x27;CORE&#x27;: {&#x27;Chung-cho1&#x27;: [&lt;Exam: [Review / Monthly Exam] Admin&#x27;s Test Exam for Toggle Testing - AUGUST 2025&gt;, &lt;Exam: [Review / Monthly Exam] Admin&#x27;s Test Exam for Toggle Testing - AUGUST 2025&gt;, &lt;Exam: [Review / Monthly Exam] Admin&#x27;s Test Exam for Toggle Testing - AUGUST 2025&gt;], &#x27;PRIMARY_2A&#x27;: [&lt;Exam: [Review / Monthly Exam] Test Ownership Exam - AUGUST 2025&gt;, &lt;Exam: [Review / Monthly Exam] Test Ownership Exam&gt;], &#x27;PS1&#x27;: [&lt;Exam: [Review / Monthly Exam] [RT] - Jun 2025 - EDGE Spark Lv1_123 - June 2025 - PRIME EDGE Spark - Level 1&gt;], &#x27;P1&#x27;: [&lt;Exam: [Review / Monthly Exam] [RT] - Jun 2025 - EDGE Spark Lv1_123 - June 2025 - PRIME EDGE Spark - Level 1&gt;], &#x27;P2&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q3 2025 - PINNACLE Endeavor Lv2 - Q3 (Jul-Sep) 2025 - PRIME PINNACLE Endeavor - Level 2&gt;], &#x27;A2&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q2 2025 - PINNACLE Vision Lv1_123 - Q2 (Apr-Jun) 2025 - PRIME PINNACLE Vision - Level 1&gt;], &#x27;B2&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q2 2025 - PINNACLE Vision Lv1_123 - Q2 (Apr-Jun) 2025 - PRIME PINNACLE Vision - Level 1&gt;], &#x27;B3&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q2 2025 - PINNACLE Vision Lv1_123 - Q2 (Apr-Jun) 2025 - PRIME PINNACLE Vision - Level 1&gt;], &#x27;B4&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q1 2025 - EDGE Pursuit Lv2_12 - Q1 (Jan-Mar) 2025 - PRIME EDGE Pursuit - Level 2&gt;], &#x27;B5&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q1 2025 - EDGE Pursuit Lv2_12 - Q1 (Jan-Mar) 2025 - PRIME EDGE Pursuit - Level 2&gt;], &#x27;S2&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q1 2025 - EDGE Pursuit Lv2_12 - Q1 (Jan-Mar) 2025 - PRIME EDGE Pursuit - Level 2&gt;], &#x27;S3&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q1 2025 - EDGE Pursuit Lv2_12 - Q1 (Jan-Mar) 2025 - PRIME EDGE Pursuit - Level 2&gt;], &#x27;H1&#x27;: [&lt;Exam: [Review / Monthly Exam] [RT] - Jul 2025 - EDGE Spark Lv3_123 - July 2025 - PRIME EDGE Spark - Level 3&gt;], &#x27;CLASS_3A&#x27;: [&lt;Exam: [Quarterly Exam] Q2 Assessment - 3A - Q2 (Apr-Jun) 2025 - PRIME CORE Phonics - Level 2&gt;]}, &#x27;ASCENT&#x27;: {&#x27;All Classes&#x27;: [&lt;Exam: [Review / Monthly Exam] [RT] - Jan 2025 - ASCENT Drive Lv2_1 - January 2025 - PRIME ASCENT Drive - Level 2&gt;, &lt;Exam: [Quarterly Exam] [QTR] - Q1 2026 - ASCENT Nova Lv2_1 - Q1 (Jan-Mar) 2026 - PRIME ASCENT Nova - Level 2&gt;]}, &#x27;EDGE&#x27;: {&#x27;All Classes&#x27;: [&lt;Exam: [Quarterly Exam] [QTR] - Q2 2025 - EDGE Spark Lv2_123 - Q2 (Apr-Jun) 2025 - PRIME EDGE Spark - Level 2&gt;]}, &#x27;PINNACLE&#x27;: {&#x27;All Classes&#x27;: [&lt;Exam: [Review / Monthly Exam] [RT] - Apr 2025 - PINNACLE Success Lv1_1 - April 2025 - PRIME PINNACLE Success - Level 1&gt;]}} -->
    <div class="exam-hierarchy">
        
            
            
            <div class="program-section" data-program="CORE">
                <div class="program-header" onclick="toggleProgram('CORE')">
                    <span>CORE Program</span>
                    <span class="program-toggle">â–¼</span>
                </div>
                
                <div class="program-content">
                    <!-- Debug: 14 classes in CORE -->
                    
                        
                        <div class="class-section " 
                             data-class="Chung-cho1">
                            <div class="class-header" onclick="toggleClass('Chung-cho1')">
                                <div class="class-name">
                                    <span>Chung-cho1</span>
                                    
                                        
                                            <span class="access-badge view">View Only</span>
                                        
                                    
                                    <span style="color: #6c757d;">(3 exams)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = False
                                    - exam.id = f145cdc5-ea2c-4b66-b09b-f88364f26949
                                    - exam.name = Admin&#x27;s Test Exam for Toggle Testing
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = FALSE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Admin\u0027s Test Exam for Toggle Testing', {
                                        is_admin: false,
                                        exam_can_edit: false,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: false
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card ">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Admin&#x27;s Test Exam for Toggle Testing</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    AUGUST
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #9E9E9E; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            VIEW ONLY
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">Chung-cho1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status not-started">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Not Started</span>
                                            <span>0.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill not-started"
                                                 style="width: 0.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/f145cdc5-ea2c-4b66-b09b-f88364f26949/preview/" class="btn btn-view">
                                                View Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('f145cdc5-ea2c-4b66-b09b-f88364f26949', 'Admin\u0027s Test Exam for Toggle Testing')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                    </div>
                                </div>
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = False
                                    - exam.id = 807f7405-7e43-40d2-8d42-00249371dca2
                                    - exam.name = Admin&#x27;s Test Exam for Toggle Testing
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = FALSE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Admin\u0027s Test Exam for Toggle Testing', {
                                        is_admin: false,
                                        exam_can_edit: false,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: false
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card ">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Admin&#x27;s Test Exam for Toggle Testing</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    AUGUST
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #9E9E9E; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            VIEW ONLY
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">Chung-cho1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 0 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status ">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: No Questions</span>
                                            <span>0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill "
                                                 style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/807f7405-7e43-40d2-8d42-00249371dca2/preview/" class="btn btn-view">
                                                View Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('807f7405-7e43-40d2-8d42-00249371dca2', 'Admin\u0027s Test Exam for Toggle Testing')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                    </div>
                                </div>
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = False
                                    - exam.id = 971d924f-40d3-4fba-9c23-f5d6b715df8d
                                    - exam.name = Admin&#x27;s Test Exam for Toggle Testing
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = FALSE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Admin\u0027s Test Exam for Toggle Testing', {
                                        is_admin: false,
                                        exam_can_edit: false,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: false
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card ">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Admin&#x27;s Test Exam for Toggle Testing</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    AUGUST
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #9E9E9E; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            VIEW ONLY
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">Chung-cho1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 0 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status ">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: No Questions</span>
                                            <span>0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill "
                                                 style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/971d924f-40d3-4fba-9c23-f5d6b715df8d/preview/" class="btn btn-view">
                                                View Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('971d924f-40d3-4fba-9c23-f5d6b715df8d', 'Admin\u0027s Test Exam for Toggle Testing')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section accessible" 
                             data-class="PRIMARY_2A">
                            <div class="class-header" onclick="toggleClass('PRIMARY_2A')">
                                <div class="class-name">
                                    <span>Grade 2A</span>
                                    
                                        
                                            <span class="access-badge full">Full Access</span>
                                        
                                    
                                    <span style="color: #6c757d;">(2 exams)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 3108788b-3046-494d-9c8a-01620d69f898
                                    - exam.name = Test Ownership Exam
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Test Ownership Exam', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Test Ownership Exam</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    AUGUST
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">PRIMARY_2A</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status not-started">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Not Started</span>
                                            <span>0.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill not-started"
                                                 style="width: 0.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/3108788b-3046-494d-9c8a-01620d69f898/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('3108788b-3046-494d-9c8a-01620d69f898', 'Test Ownership Exam')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('3108788b-3046-494d-9c8a-01620d69f898', 'Test Ownership Exam')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 6e9b1d51-038e-4d93-9ae0-2b56f6a8816d
                                    - exam.name = Test Ownership Exam
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Test Ownership Exam', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Test Ownership Exam</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">PRIMARY_2A</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status not-started">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Not Started</span>
                                            <span>0.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill not-started"
                                                 style="width: 0.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/6e9b1d51-038e-4d93-9ae0-2b56f6a8816d/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('6e9b1d51-038e-4d93-9ae0-2b56f6a8816d', 'Test Ownership Exam')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('6e9b1d51-038e-4d93-9ae0-2b56f6a8816d', 'Test Ownership Exam')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="PS1">
                            <div class="class-header" onclick="toggleClass('PS1')">
                                <div class="class-name">
                                    <span>PS1</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 6bbb7b3c-895a-43c6-8797-cb10ddcaf19d
                                    - exam.name = [RT] - Jun 2025 - EDGE Spark Lv1_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[RT] - Jun 2025 - EDGE Spark Lv1_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    June
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">PS1</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">P1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status not-started">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Not Started</span>
                                            <span>0.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill not-started"
                                                 style="width: 0.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/6bbb7b3c-895a-43c6-8797-cb10ddcaf19d/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('6bbb7b3c-895a-43c6-8797-cb10ddcaf19d', '[RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('6bbb7b3c-895a-43c6-8797-cb10ddcaf19d', '[RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="P1">
                            <div class="class-header" onclick="toggleClass('P1')">
                                <div class="class-name">
                                    <span>P1</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 6bbb7b3c-895a-43c6-8797-cb10ddcaf19d
                                    - exam.name = [RT] - Jun 2025 - EDGE Spark Lv1_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[RT] - Jun 2025 - EDGE Spark Lv1_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    June
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">PS1</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">P1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status not-started">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Not Started</span>
                                            <span>0.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill not-started"
                                                 style="width: 0.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/6bbb7b3c-895a-43c6-8797-cb10ddcaf19d/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('6bbb7b3c-895a-43c6-8797-cb10ddcaf19d', '[RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('6bbb7b3c-895a-43c6-8797-cb10ddcaf19d', '[RT] \u002D Jun 2025 \u002D EDGE Spark Lv1_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="P2">
                            <div class="class-header" onclick="toggleClass('P2')">
                                <div class="class-name">
                                    <span>P2</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 883e4327-5a33-45dd-b373-82e33f60d5a6
                                    - exam.name = [QTR] - Q3 2025 - PINNACLE Endeavor Lv2
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q3 2025 \u002D PINNACLE Endeavor Lv2', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q3 2025 - PINNACLE Endeavor Lv2</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q3 (Jul-Sep)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">P2</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 2 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/883e4327-5a33-45dd-b373-82e33f60d5a6/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('883e4327-5a33-45dd-b373-82e33f60d5a6', '[QTR] \u002D Q3 2025 \u002D PINNACLE Endeavor Lv2')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('883e4327-5a33-45dd-b373-82e33f60d5a6', '[QTR] \u002D Q3 2025 \u002D PINNACLE Endeavor Lv2')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="A2">
                            <div class="class-header" onclick="toggleClass('A2')">
                                <div class="class-name">
                                    <span>A2</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = e6c139fb-0169-47dc-93b1-713670a4323e
                                    - exam.name = [QTR] - Q2 2025 - PINNACLE Vision Lv1_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q2 2025 - PINNACLE Vision Lv1_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q2 (Apr-Jun)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">A2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 8 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/e6c139fb-0169-47dc-93b1-713670a4323e/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="B2">
                            <div class="class-header" onclick="toggleClass('B2')">
                                <div class="class-name">
                                    <span>B2</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = e6c139fb-0169-47dc-93b1-713670a4323e
                                    - exam.name = [QTR] - Q2 2025 - PINNACLE Vision Lv1_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q2 2025 - PINNACLE Vision Lv1_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q2 (Apr-Jun)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">A2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 8 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/e6c139fb-0169-47dc-93b1-713670a4323e/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="B3">
                            <div class="class-header" onclick="toggleClass('B3')">
                                <div class="class-name">
                                    <span>B3</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = e6c139fb-0169-47dc-93b1-713670a4323e
                                    - exam.name = [QTR] - Q2 2025 - PINNACLE Vision Lv1_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q2 2025 - PINNACLE Vision Lv1_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q2 (Apr-Jun)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">A2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 8 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/e6c139fb-0169-47dc-93b1-713670a4323e/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('e6c139fb-0169-47dc-93b1-713670a4323e', '[QTR] \u002D Q2 2025 \u002D PINNACLE Vision Lv1_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="B4">
                            <div class="class-header" onclick="toggleClass('B4')">
                                <div class="class-name">
                                    <span>B4</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 33279fa8-1b64-4c05-add0-77c7a9e8d04a
                                    - exam.name = [QTR] - Q1 2025 - EDGE Pursuit Lv2_12
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q1 2025 - EDGE Pursuit Lv2_12</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q1 (Jan-Mar)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B4</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B5</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 2 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 3 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/33279fa8-1b64-4c05-add0-77c7a9e8d04a/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="B5">
                            <div class="class-header" onclick="toggleClass('B5')">
                                <div class="class-name">
                                    <span>B5</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 33279fa8-1b64-4c05-add0-77c7a9e8d04a
                                    - exam.name = [QTR] - Q1 2025 - EDGE Pursuit Lv2_12
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q1 2025 - EDGE Pursuit Lv2_12</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q1 (Jan-Mar)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B4</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B5</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 2 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 3 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/33279fa8-1b64-4c05-add0-77c7a9e8d04a/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="S2">
                            <div class="class-header" onclick="toggleClass('S2')">
                                <div class="class-name">
                                    <span>S2</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 33279fa8-1b64-4c05-add0-77c7a9e8d04a
                                    - exam.name = [QTR] - Q1 2025 - EDGE Pursuit Lv2_12
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q1 2025 - EDGE Pursuit Lv2_12</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q1 (Jan-Mar)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B4</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B5</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 2 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 3 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/33279fa8-1b64-4c05-add0-77c7a9e8d04a/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="S3">
                            <div class="class-header" onclick="toggleClass('S3')">
                                <div class="class-name">
                                    <span>S3</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 33279fa8-1b64-4c05-add0-77c7a9e8d04a
                                    - exam.name = [QTR] - Q1 2025 - EDGE Pursuit Lv2_12
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q1 2025 - EDGE Pursuit Lv2_12</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q1 (Jan-Mar)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B4</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">B5</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S2</span> 
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">S3</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 2 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 3 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/33279fa8-1b64-4c05-add0-77c7a9e8d04a/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('33279fa8-1b64-4c05-add0-77c7a9e8d04a', '[QTR] \u002D Q1 2025 \u002D EDGE Pursuit Lv2_12')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="H1">
                            <div class="class-header" onclick="toggleClass('H1')">
                                <div class="class-name">
                                    <span>H1</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 31105d96-4234-492b-9bf3-266dfdab1188
                                    - exam.name = [RT] - Jul 2025 - EDGE Spark Lv3_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [RT] \u002D Jul 2025 \u002D EDGE Spark Lv3_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[RT] - Jul 2025 - EDGE Spark Lv3_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    July
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">H1</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/31105d96-4234-492b-9bf3-266dfdab1188/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('31105d96-4234-492b-9bf3-266dfdab1188', '[RT] \u002D Jul 2025 \u002D EDGE Spark Lv3_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('31105d96-4234-492b-9bf3-266dfdab1188', '[RT] \u002D Jul 2025 \u002D EDGE Spark Lv3_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                        
                        <div class="class-section " 
                             data-class="CLASS_3A">
                            <div class="class-header" onclick="toggleClass('CLASS_3A')">
                                <div class="class-name">
                                    <span>CLASS_3A</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = ed31aaad-9444-42a0-98e9-5f5b515f8366
                                    - exam.name = Q2 Assessment - 3A
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: Q2 Assessment \u002D 3A', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">Q2 Assessment - 3A</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q2 (Apr-Jun)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 3px solid #4CAF50; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #2e7d32; margin-right: 6px;">ðŸ“š Assigned Classes:</strong>
                                        <span style="color: #1b5e20; font-weight: 500;">
                                            
                                                <span style="background: white; padding: 2px 6px; border-radius: 3px; margin: 0 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">CLASS_3A</span>
                                            
                                        </span>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 75 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/ed31aaad-9444-42a0-98e9-5f5b515f8366/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('ed31aaad-9444-42a0-98e9-5f5b515f8366', 'Q2 Assessment \u002D 3A')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('ed31aaad-9444-42a0-98e9-5f5b515f8366', 'Q2 Assessment \u002D 3A')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                </div>
            </div>
            
            
        
            
            
            <div class="program-section" data-program="ASCENT">
                <div class="program-header" onclick="toggleProgram('ASCENT')">
                    <span>ASCENT Program</span>
                    <span class="program-toggle">â–¼</span>
                </div>
                
                <div class="program-content">
                    <!-- Debug: 1 classes in ASCENT -->
                    
                        
                        <div class="class-section " 
                             data-class="All Classes">
                            <div class="class-header" onclick="toggleClass('All Classes')">
                                <div class="class-name">
                                    <span>All Classes</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(2 exams)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 62d5f2ee-509b-4907-bca1-cef44b4aa10d
                                    - exam.name = [RT] - Jan 2025 - ASCENT Drive Lv2_1
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [RT] \u002D Jan 2025 \u002D ASCENT Drive Lv2_1', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[RT] - Jan 2025 - ASCENT Drive Lv2_1</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    January
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: #fff3e0; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #e65100;">âš ï¸ No classes assigned</strong>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/62d5f2ee-509b-4907-bca1-cef44b4aa10d/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('62d5f2ee-509b-4907-bca1-cef44b4aa10d', '[RT] \u002D Jan 2025 \u002D ASCENT Drive Lv2_1')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('62d5f2ee-509b-4907-bca1-cef44b4aa10d', '[RT] \u002D Jan 2025 \u002D ASCENT Drive Lv2_1')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = d075bf25-f30e-487d-8849-bb2c625e39ba
                                    - exam.name = [QTR] - Q1 2026 - ASCENT Nova Lv2_1
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q1 2026 \u002D ASCENT Nova Lv2_1', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q1 2026 - ASCENT Nova Lv2_1</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2026
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q1 (Jan-Mar)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: #fff3e0; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #e65100;">âš ï¸ No classes assigned</strong>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/d075bf25-f30e-487d-8849-bb2c625e39ba/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('d075bf25-f30e-487d-8849-bb2c625e39ba', '[QTR] \u002D Q1 2026 \u002D ASCENT Nova Lv2_1')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('d075bf25-f30e-487d-8849-bb2c625e39ba', '[QTR] \u002D Q1 2026 \u002D ASCENT Nova Lv2_1')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                </div>
            </div>
            
            
        
            
            
            <div class="program-section" data-program="EDGE">
                <div class="program-header" onclick="toggleProgram('EDGE')">
                    <span>EDGE Program</span>
                    <span class="program-toggle">â–¼</span>
                </div>
                
                <div class="program-content">
                    <!-- Debug: 1 classes in EDGE -->
                    
                        
                        <div class="class-section " 
                             data-class="All Classes">
                            <div class="class-header" onclick="toggleClass('All Classes')">
                                <div class="class-name">
                                    <span>All Classes</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = 395c6924-65db-455b-b3bb-9bb58b851f99
                                    - exam.name = [QTR] - Q2 2025 - EDGE Spark Lv2_123
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [QTR] \u002D Q2 2025 \u002D EDGE Spark Lv2_123', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[QTR] - Q2 2025 - EDGE Spark Lv2_123</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    Q2 (Apr-Jun)
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: #fff3e0; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #e65100;">âš ï¸ No classes assigned</strong>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/395c6924-65db-455b-b3bb-9bb58b851f99/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('395c6924-65db-455b-b3bb-9bb58b851f99', '[QTR] \u002D Q2 2025 \u002D EDGE Spark Lv2_123')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('395c6924-65db-455b-b3bb-9bb58b851f99', '[QTR] \u002D Q2 2025 \u002D EDGE Spark Lv2_123')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                </div>
            </div>
            
            
        
            
            
            <div class="program-section" data-program="PINNACLE">
                <div class="program-header" onclick="toggleProgram('PINNACLE')">
                    <span>PINNACLE Program</span>
                    <span class="program-toggle">â–¼</span>
                </div>
                
                <div class="program-content">
                    <!-- Debug: 1 classes in PINNACLE -->
                    
                        
                        <div class="class-section " 
                             data-class="All Classes">
                            <div class="class-header" onclick="toggleClass('All Classes')">
                                <div class="class-name">
                                    <span>All Classes</span>
                                    
                                        <span class="access-badge view">View Only</span>
                                    
                                    <span style="color: #6c757d;">(1 exam)</span>
                                </div>
                                <span class="class-toggle">â–¼</span>
                            </div>
                            
                            <div class="class-exams">
                                
                                <!-- COMPREHENSIVE DEBUG START -->
                                <!-- 
                                    DELETE BUTTON DEBUG:
                                    - is_admin = False
                                    - exam.can_edit = True
                                    - exam.id = a910690b-15d8-49d7-99f2-ee36bf6b64ba
                                    - exam.name = [RT] - Apr 2025 - PINNACLE Success Lv1_1
                                    - User: teacher1
                                    - User.is_superuser = False
                                    - User.is_staff = False
                                    - Condition (is_admin or exam.can_edit) = TRUE
                                -->
                                <script>
                                    console.log('[DELETE_BUTTON_DEBUG] Exam: [RT] \u002D Apr 2025 \u002D PINNACLE Success Lv1_1', {
                                        is_admin: false,
                                        exam_can_edit: true,
                                        user_is_superuser: false,
                                        user_is_staff: false,
                                        should_show_delete: true
                                    });
                                </script>
                                <!-- COMPREHENSIVE DEBUG END -->
                                <div class="exam-card editable">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div class="exam-title">[RT] - Apr 2025 - PINNACLE Success Lv1_1</div>
                                            <!-- Year and Month/Quarter Display -->
                                            <div style="margin-top: 4px; display: flex; gap: 8px; align-items: center;">
                                                
                                                <span style="background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    2025
                                                </span>
                                                
                                                
                                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                                    April
                                                </span>
                                                
                                            </div>
                                        </div>
                                        
                                        <span class="badge" style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                            OWNER
                                        </span>
                                        
                                    </div>
                                    
                                    <!-- Display Assigned Class Codes -->
                                    
                                    <div class="exam-classes" style="margin: 8px 0; padding: 8px 12px; background: #fff3e0; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 0.85rem;">
                                        <strong style="color: #e65100;">âš ï¸ No classes assigned</strong>
                                    </div>
                                    
                                    
                                    <div class="exam-meta">
                                        <div class="exam-meta-item">
                                            ðŸ“„ 10 Questions
                                        </div>
                                        <div class="exam-meta-item">
                                            ðŸŽµ 0 Audio
                                        </div>
                                    </div>
                                    
                                    <!-- Answer Mapping Status -->
                                    <div class="answer-status complete">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Answer Keys: Complete</span>
                                            <span>100.0%</span>
                                        </div>
                                        <div class="answer-progress-bar">
                                            <div class="answer-progress-fill complete"
                                                 style="width: 100.0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="exam-actions">
                                        
                                            <a href="/RoutineTest/exams/a910690b-15d8-49d7-99f2-ee36bf6b64ba/preview/" class="btn btn-edit">
                                                Edit Answers
                                            </a>
                                        
                                        
                                        
                                            <button onclick="openCopyModal('a910690b-15d8-49d7-99f2-ee36bf6b64ba', '[RT] \u002D Apr 2025 \u002D PINNACLE Success Lv1_1')" class="btn btn-copy">
                                                Copy Exam
                                            </button>
                                        
                                        
                                        
                                            <button onclick="confirmDelete('a910690b-15d8-49d7-99f2-ee36bf6b64ba', '[RT] \u002D Apr 2025 \u002D PINNACLE Success Lv1_1')" 
                                                    class="btn btn-danger delete-exam-btn">
                                                Delete
                                            </button>
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        
                    
                </div>
            </div>
            
            
        
        
        
        
    </div>
</div>

<!-- Copy Exam Modal -->
<div id="copyExamModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeCopyModal()">&times;</span>
        <h3>Copy Exam to Another Class</h3>
        <form id="copyExamForm">
            <input type="hidden" id="sourceExamId" name="source_exam_id">
            
            <div class="form-group">
                <label>Source Exam:</label>
                <p id="sourceExamName" style="font-weight: 600; color: #2c3e50;">Loading...</p>
            </div>
            
            <div class="form-group">
                <label for="targetClass">Target Class:</label>
                <select id="targetClass" name="target_class" required>
                    <option value="">Select a class...</option>
                    
                        
                        <option value="C5">C5</option>
                        
                    
                        
                    
                        
                        <option value="HIGH_10E">HIGH_10E</option>
                        
                    
                        
                        <option value="HIGH_10F">HIGH_10F</option>
                        
                    
                        
                        <option value="HIGH_11D">HIGH_11D</option>
                        
                    
                        
                        <option value="MIDDLE_7A">MIDDLE_7A</option>
                        
                    
                        
                        <option value="PRIMARY_1D">Grade 1D</option>
                        
                    
                        
                        <option value="PRIMARY_2A">Grade 2A</option>
                        
                    
                        
                        <option value="SejongM">SejongM</option>
                        
                    
                        
                        <option value="Sungjong4">Sungjong4</option>
                        
                    
                        
                    
                    
                </select>
            </div>
            
            <div class="form-group">
                <label for="copyExamType">Exam Type:</label>
                <select id="copyExamType" name="exam_type" required>
                    <option value="">Select exam type...</option>
                    <option value="REVIEW">Review / Monthly</option>
                    <option value="QUARTERLY">Quarterly</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="timeslot">Time Period:</label>
                <select id="timeslot" name="timeslot" required disabled>
                    <option value="">First select exam type...</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="academicYear">Academic Year:</label>
                <select id="academicYear" name="academic_year" required>
                    <option value="">Select year...</option>
                    <option value="2024">2024</option>
                    <option value="2025" selected>2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="customSuffix">Custom Name Suffix (Optional):</label>
                <input type="text" id="customSuffix" name="custom_suffix" class="form-control" 
                       placeholder="e.g., 123 or version2" maxlength="50">
                <small class="text-muted">This will be appended to the auto-generated exam name (e.g., _123)</small>
            </div>
            
            <div class="form-group">
                <label>Preview of New Exam Name:</label>
                <div id="examNamePreview" style="padding: 10px; background: #f0f0f0; border-radius: 4px; font-weight: 600;">
                    <span id="previewText">Please complete all fields to see preview...</span>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" onclick="closeCopyModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-copy">Copy Exam</button>
            </div>
        </form>
    </div>
</div>

<script>
// ============================================================================
// COPY EXAM MODAL - COMPREHENSIVE FIX V2.0
// Date: 
// ============================================================================

console.log('%c[COPY MODAL FIX] Initializing comprehensive copy modal system...', 'color: #00A65E; font-weight: bold;');

// Global state management
window.CopyModalState = {
    initialized: false,
    currentExamId: null,
    currentExamName: null,
    debugMode: true,
    initTime: Date.now()
};

// ============================================================================
// INTERNAL COPY MODAL FUNCTION - Called by the global openCopyModal
// ============================================================================
window.openCopyModalInternal = function(examId, examName) {
    const startTime = performance.now();
    
    console.group('%c[COPY MODAL] Opening Modal', 'color: #00A65E; font-weight: bold;');
    console.log('Exam ID:', examId);
    console.log('Exam Name:', examName);
    console.log('Call Stack:', new Error().stack.split('\n')[2].trim());
    
    try {
        // Store current exam info
        window.CopyModalState.currentExamId = examId;
        window.CopyModalState.currentExamName = examName;
        
        // Find the modal element
        const modal = document.getElementById('copyExamModal');
        if (!modal) {
            console.error('[COPY MODAL] CRITICAL: Modal element #copyExamModal not found in DOM');
            console.log('Available modal IDs:', Array.from(document.querySelectorAll('[id*="modal"]')).map(el => el.id));
            alert('Error: Copy modal not found. Please refresh the page and try again.');
            console.groupEnd();
            return false;
        }
        
        console.log('[COPY MODAL] Modal element found successfully');
        
        // Find and update source exam elements
        const sourceExamIdInput = document.getElementById('sourceExamId');
        const sourceExamNameDisplay = document.getElementById('sourceExamName');
        
        if (!sourceExamIdInput) {
            console.error('[COPY MODAL] sourceExamId input not found');
        } else {
            sourceExamIdInput.value = examId;
            console.log('[COPY MODAL] Set source exam ID:', examId);
        }
        
        if (!sourceExamNameDisplay) {
            console.error('[COPY MODAL] sourceExamName display element not found');
        } else {
            sourceExamNameDisplay.textContent = examName || 'Unknown Exam';
            console.log('[COPY MODAL] Set source exam name:', examName);
        }
        
        // Reset the form
        const copyForm = document.getElementById('copyExamForm');
        if (copyForm) {
            copyForm.reset();
            // Re-set the exam ID after reset
            if (sourceExamIdInput) {
                sourceExamIdInput.value = examId;
            }
            console.log('[COPY MODAL] Form reset completed');
        } else {
            console.warn('[COPY MODAL] Copy form not found for reset');
        }
        
        // Reset timeslot dropdown
        const timeslotSelect = document.getElementById('timeslot');
        if (timeslotSelect) {
            timeslotSelect.innerHTML = '<option value="">First select exam type...</option>';
            timeslotSelect.disabled = true;
            console.log('[COPY MODAL] Timeslot dropdown reset');
        }
        
        // Show the modal
        modal.style.display = 'block';
        modal.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
        
        // Set up close handlers
        modal.onclick = function(e) {
            if (e.target === modal) {
                console.log('[COPY MODAL] Background clicked - closing modal');
                window.closeCopyModal();
            }
        };
        
        const executionTime = performance.now() - startTime;
        console.log(`[COPY MODAL] Modal opened successfully in ${executionTime.toFixed(2)}ms`);
        console.log('[COPY MODAL] Modal display:', window.getComputedStyle(modal).display);
        console.log('[COPY MODAL] Modal visibility:', window.getComputedStyle(modal).visibility);
        console.groupEnd();
        
        return true;
        
    } catch (error) {
        console.error('[COPY MODAL] CRITICAL ERROR:', error);
        console.error('Stack trace:', error.stack);
        alert('An error occurred while opening the copy modal. Please try again.');
        console.groupEnd();
        return false;
    }
};

// ============================================================================
// CLOSE MODAL FUNCTION - Internal implementation
// ============================================================================
window.closeCopyModalInternal = function() {
    console.group('%c[COPY MODAL] Closing Modal', 'color: #888; font-weight: bold;');
    
    try {
        const modal = document.getElementById('copyExamModal');
        if (!modal) {
            console.warn('[COPY MODAL] Modal element not found during close');
            console.groupEnd();
            return;
        }
        
        // Hide the modal
        modal.style.display = 'none';
        modal.classList.remove('show');
        document.body.style.overflow = ''; // Restore scrolling
        
        // Clear state
        window.CopyModalState.currentExamId = null;
        window.CopyModalState.currentExamName = null;
        
        // Reset form
        const copyForm = document.getElementById('copyExamForm');
        if (copyForm) {
            copyForm.reset();
            console.log('[COPY MODAL] Form reset on close');
        }
        
        // Remove event handlers
        modal.onclick = null;
        
        console.log('[COPY MODAL] Modal closed successfully');
        console.groupEnd();
        
    } catch (error) {
        console.error('[COPY MODAL] Error during close:', error);
        console.groupEnd();
    }
};

// Create global aliases for backward compatibility
var openCopyModal = window.openCopyModal;
var closeCopyModal = window.closeCopyModal;

console.log('[COPY MODAL] Functions registered globally:');
console.log('  - window.openCopyModal:', typeof window.openCopyModal);
console.log('  - window.closeCopyModal:', typeof window.closeCopyModal);
console.log('  - openCopyModal (alias):', typeof openCopyModal);
console.log('  - closeCopyModal (alias):', typeof closeCopyModal);

// PAGE LOAD DEBUGGING - Track exams and filter state
(function() {
    console.log('========================================');
    console.log('[PAGE_LOAD_DEBUG] Exam Library Page Loaded');
    console.log('[PAGE_LOAD_DEBUG] Current URL:', window.location.href);
    
    // Check filter state
    const urlParams = new URLSearchParams(window.location.search);
    const filterState = urlParams.get('assigned_only');
    const filterCheckbox = document.getElementById('assignedOnlyFilter');
    
    console.log('[PAGE_LOAD_DEBUG] Filter URL parameter:', filterState || 'not set (showing all)');
    console.log('[PAGE_LOAD_DEBUG] Filter checkbox state:', filterCheckbox?.checked ? 'CHECKED âœ…' : 'UNCHECKED âŒ');
    
    // Count and log exam cards with their badges
    const examCards = document.querySelectorAll('.exam-card');
    console.log('[PAGE_LOAD_DEBUG] Total exam cards displayed:', examCards.length);
    
    // Analyze access badges
    const badgeCounts = {
        'OWNER': 0,
        'ADMIN': 0,
        'FULL ACCESS': 0,
        'EDIT': 0,
        'VIEW ONLY': 0
    };
    
    examCards.forEach((card, index) => {
        const badge = card.querySelector('.access-badge');
        const examName = card.querySelector('.exam-title')?.textContent?.trim() || 'Unknown';
        const badgeText = badge?.textContent?.trim() || 'NO BADGE';
        
        if (index < 5) { // Log first 5 exams for detailed debugging
            console.log(`[PAGE_LOAD_DEBUG] Exam ${index + 1}: "${examName}" - Badge: ${badgeText}`);
        }
        
        // Count badges
        if (badgeCounts.hasOwnProperty(badgeText)) {
            badgeCounts[badgeText]++;
        }
    });
    
    console.log('[PAGE_LOAD_DEBUG] Badge distribution:', badgeCounts);
    
    // Check if we're in "Show Assigned Classes Only" mode
    if (filterCheckbox?.checked) {
        console.log('[PAGE_LOAD_DEBUG] âš ï¸ Filter is ON - Should show exams from EDITABLE classes only');
        console.log('[PAGE_LOAD_DEBUG] Expected: Exams with FULL ACCESS and EDIT badges only');
        console.log('[PAGE_LOAD_DEBUG] NOT Expected: VIEW ONLY badges (should be filtered out)');
        if (badgeCounts['VIEW ONLY'] > 0) {
            console.log('[PAGE_LOAD_DEBUG] âŒâŒâŒ CRITICAL BUG DETECTED âŒâŒâŒ');
            console.log('[PAGE_LOAD_DEBUG] Found ' + badgeCounts['VIEW ONLY'] + ' VIEW ONLY exams that should be HIDDEN!');
            
            // List all VIEW ONLY exams that shouldn't be visible
            console.log('[PAGE_LOAD_DEBUG] VIEW ONLY exams that should be hidden:');
            examCards.forEach((card, index) => {
                const badge = card.querySelector('.badge');
                const examName = card.querySelector('.exam-title')?.textContent?.trim() || 'Unknown';
                const badgeText = badge?.textContent?.trim() || 'NO BADGE';
                
                if (badgeText === 'VIEW ONLY' || badgeText.includes('VIEW')) {
                    const examClasses = card.querySelector('.exam-classes')?.textContent || 'No classes';
                    console.log(`[PAGE_LOAD_DEBUG]   âŒ Exam "${examName}"`);
                    console.log(`[PAGE_LOAD_DEBUG]      Badge: ${badgeText}`);
                    console.log(`[PAGE_LOAD_DEBUG]      Classes: ${examClasses}`);
                }
            });
        } else {
            console.log('[PAGE_LOAD_DEBUG] âœ… Correct: No VIEW ONLY exams shown (filtered out as expected)');
        }
    } else {
        console.log('[PAGE_LOAD_DEBUG] Filter is OFF - Showing all visible exams');
        console.log('[PAGE_LOAD_DEBUG] Expected: All badges including VIEW ONLY');
    }
    
    console.log('========================================');
})();

// IMMEDIATE DELETE BUTTON FIX - Run once without infinite loop
(function() {
    // Apply red color to all delete buttons immediately
    const fixDeleteButtons = function() {
        const deleteButtons = document.querySelectorAll('.btn-danger:not([data-delete-fixed]), button[onclick*="confirmDelete"]:not([data-delete-fixed])');
        deleteButtons.forEach(button => {
            // Force red styling via inline styles with highest priority
            button.style.setProperty('background-color', '#dc3545', 'important');
            button.style.setProperty('border-color', '#dc3545', 'important');
            button.style.setProperty('color', 'white', 'important');
            
            // Remove any conflicting classes
            button.classList.remove('btn-success', 'btn-primary', 'btn-secondary');
            // Ensure btn-danger class is present
            if (!button.classList.contains('btn-danger')) {
                button.classList.add('btn-danger');
            }
            
            // Mark as fixed to avoid reprocessing
            button.setAttribute('data-delete-fixed', 'true');
        });
    };
    
    // Run immediately
    fixDeleteButtons();
    
    // Run on DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', fixDeleteButtons);
    }
    
    // Run once after a short delay to catch any late-applied styles
    setTimeout(fixDeleteButtons, 100);
})();

// DELETE BUTTON FIX CONTINUES HERE - Functions already defined above

// Toggle functions
function toggleProgram(program) {
    const section = document.querySelector(`.program-section[data-program="${program}"]`);
    section.classList.toggle('collapsed');
}

function toggleClass(classCode) {
    const section = document.querySelector(`.class-section[data-class="${classCode}"]`);
    section.classList.toggle('collapsed');
}

// Filter toggle with comprehensive logging - WITH DOM READY CHECK
(function() {
    const filterCheckbox = document.getElementById('assignedOnlyFilter');
    if (!filterCheckbox) {
        console.error('[FILTER_DEBUG] âŒ CRITICAL ERROR: assignedOnlyFilter checkbox not found!');
        console.error('[FILTER_DEBUG] This means the filter will not work!');
        return;
    }
    
    console.log('[FILTER_DEBUG] âœ… Filter checkbox found, attaching event listener...');
    
    filterCheckbox.addEventListener('change', function() {
        console.log('========================================');
        console.log('[FILTER_DEBUG] "Show Assigned Classes Only" toggle changed');
        console.log('[FILTER_DEBUG] Checkbox state:', this.checked ? 'CHECKED âœ…' : 'UNCHECKED âŒ');
        console.log('[FILTER_DEBUG] Current URL:', window.location.href);
        
        const currentUrl = new URL(window.location.href);
        const previousState = currentUrl.searchParams.get('assigned_only');
        console.log('[FILTER_DEBUG] Previous filter state in URL:', previousState || 'not set (default: show all)');
        
        if (this.checked) {
            currentUrl.searchParams.set('assigned_only', 'true');
            console.log('[FILTER_DEBUG] Setting filter to: SHOW ASSIGNED CLASSES ONLY');
            console.log('[FILTER_DEBUG] Expected behavior: Show exams from classes where teacher can EDIT');
            console.log('[FILTER_DEBUG] This includes: FULL ACCESS and EDIT (CO_TEACHER) access levels');
            console.log('[FILTER_DEBUG] This EXCLUDES: VIEW ONLY access (read-only classes)');
        } else {
            currentUrl.searchParams.delete('assigned_only');
            console.log('[FILTER_DEBUG] Setting filter to: SHOW ALL EXAMS');
            console.log('[FILTER_DEBUG] Expected behavior: Show all exams visible to the teacher');
            console.log('[FILTER_DEBUG] This includes: FULL ACCESS, EDIT, and VIEW ONLY access levels');
        }
        
        // Add cache-busting timestamp
        currentUrl.searchParams.set('_t', Date.now());
        
        console.log('[FILTER_DEBUG] New URL to navigate to:', currentUrl.toString());
        console.log('[FILTER_DEBUG] Reloading page with new filter state...');
        console.log('========================================');
        
        // Force a hard refresh to bypass any caching
        window.location.replace(currentUrl.toString());
    });
    
    console.log('[FILTER_DEBUG] Event listener attached successfully');
})();

// ============================================================================
// COPY MODAL EVENT INITIALIZATION AND FORM HANDLING
// ============================================================================
console.log('[COPY MODAL] Setting up event handlers and form submission...');
        modal.style.removeProperty('visibility');
        modal.style.removeProperty('opacity');
        
        // Force a reflow to ensure the class change is applied
        modal.offsetHeight;
        
        console.log('Modal should be visible now');
        console.log('Modal classes:', modal.className);
        console.log('Computed display:', window.getComputedStyle(modal).display);
        console.log('Computed visibility:', window.getComputedStyle(modal).visibility);
        
        // Add click handler to close on background click
        modal.onclick = function(event) {
            if (event.target === modal) {
                closeCopyModal();
            }
        };
        
    } catch (error) {
        console.error('Error opening copy modal:', error);
        alert('Error opening copy modal: ' + error.message);
    }
}

// This function is now defined in critical_functions.html
// which calls closeCopyModalInternal defined above
console.log('[FUNCTION_NOTE] closeCopyModal is defined globally, using closeCopyModalInternal internally');

// Validate that all copy modal functions are available
function validateCopyModalFunctions() {
    console.log('[VALIDATE] Checking copy modal functions...');
    const checks = {
        modal: document.getElementById('copyExamModal'),
        form: document.getElementById('copyExamForm'),
        openCopyModal: typeof window.openCopyModal === 'function',
        closeCopyModal: typeof window.closeCopyModal === 'function',
        openCopyModalInternal: typeof window.openCopyModalInternal === 'function',
        closeCopyModalInternal: typeof window.closeCopyModalInternal === 'function'
    };
    
    console.log('[VALIDATE] Copy modal status:', checks);
    return checks;
}

// Handle copy form submission
function initializeCopyFormSubmission() {
    const copyExamForm = document.getElementById('copyExamForm');
    if (!copyExamForm) {
        console.error('copyExamForm not found');
        return;
    }
    
    copyExamForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('Copy form submitted');
        
        const formData = new FormData(this);
        const data = {
            source_exam_id: formData.get('source_exam_id'),
            target_class: formData.get('target_class'),
            target_timeslot: formData.get('timeslot')
        };
        
        console.log('Form data:', data);
        
        // Validate data
        if (!data.source_exam_id || !data.target_class || !data.target_timeslot) {
            console.error('Validation failed:', data);
            showErrorNotification('Please fill in all required fields');
            return;
        }
        
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Copying...';
        submitBtn.disabled = true;
    
    try {
        const response = await fetch('/RoutineTest/api/copy-exam/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': 'yyfeLvzkJzBaA4KBO4guHgw6USf4cPfVZU79Mn4slTm0geBuGz5GZsVqsR8LyZrA'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSuccessNotification(result.message || 'Exam copied successfully!');
            closeCopyModal();
            // Reload after a short delay to show the notification
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showErrorNotification(result.error || 'Failed to copy exam');
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    } catch (error) {
        console.error('Copy error:', error);
        showErrorNotification('Error copying exam: ' + error.message);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
    });
    
    console.log('Copy form submission handler initialized');
}

// Delete functions are now defined in critical_functions.html at the top of the page
// This ensures they're available before any onclick handlers are rendered
// The functions are: window.confirmDelete and window.deleteExam

// Verify delete functions are available
function verifyDeleteFunctions() {
    const functionsAvailable = {
        confirmDelete: typeof window.confirmDelete === 'function',
        deleteExam: typeof window.deleteExam === 'function',
        openCopyModal: typeof window.openCopyModal === 'function',
        closeCopyModal: typeof window.closeCopyModal === 'function',
        ready: window.EXAM_FUNCTIONS_READY
    };
    
    console.log('[VERIFY] Critical functions status:', functionsAvailable);
    
    if (!functionsAvailable.confirmDelete || !functionsAvailable.deleteExam) {
        console.error('[VERIFY] Critical delete functions not available!');
    }
    
    return functionsAvailable;
}

// Notification helper functions
function showSuccessNotification(message) {
    showNotification(message, 'success');
}

function showErrorNotification(message) {
    showNotification(message, 'error');
}

function showNotification(message, type = 'info') {
    // Remove any existing notification
    const existingNotification = document.getElementById('exam-notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // Create new notification
    const notification = document.createElement('div');
    notification.id = 'exam-notification';
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 4px;
        z-index: 10000;
        transition: opacity 0.3s;
        font-weight: 500;
        min-width: 250px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    `;
    
    // Set colors based on type
    if (type === 'success') {
        notification.style.backgroundColor = '#d4edda';
        notification.style.color = '#155724';
        notification.style.border = '1px solid #c3e6cb';
    } else if (type === 'error') {
        notification.style.backgroundColor = '#f8d7da';
        notification.style.color = '#721c24';
        notification.style.border = '1px solid #f5c6cb';
    } else {
        notification.style.backgroundColor = '#d1ecf1';
        notification.style.color = '#0c5460';
        notification.style.border = '1px solid #bee5eb';
    }
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // Fade in
    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);
    
    // Auto-hide after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 3000);
}

// Delete button color enforcement - Fixed to prevent infinite loop
let isProcessingDeleteButtons = false;

function enforceDeleteButtonColors() {
    // Prevent recursive calls
    if (isProcessingDeleteButtons) {
        return;
    }
    
    isProcessingDeleteButtons = true;
    
    // Find all possible delete button selectors that haven't been fixed yet
    const deleteButtons = document.querySelectorAll(`
        button[onclick*="confirmDelete"]:not([data-delete-button-fixed]),
        .btn-danger:not([data-delete-button-fixed]),
        button.btn-danger:not([data-delete-button-fixed]),
        .exam-actions button[onclick*="confirmDelete"]:not([data-delete-button-fixed]),
        .exam-actions .btn-danger:not([data-delete-button-fixed])
    `);
    
    if (deleteButtons.length === 0) {
        isProcessingDeleteButtons = false;
        return; // No buttons to fix
    }
    
    console.log(`[DELETE FIX] Found ${deleteButtons.length} delete buttons to fix`);
    
    deleteButtons.forEach((button, index) => {
        // Remove any conflicting theme classes that might make it green
        button.classList.remove('btn-success', 'btn-primary', 'btn-secondary', 'btn-info');
        
        // Ensure btn-danger class is present
        if (!button.classList.contains('btn-danger')) {
            button.classList.add('btn-danger');
        }
        
        // Force red styling with maximum specificity through inline styles
        button.style.setProperty('background-color', '#dc3545', 'important');
        button.style.setProperty('background', '#dc3545', 'important');
        button.style.setProperty('border-color', '#dc3545', 'important');
        button.style.setProperty('color', 'white', 'important');
        button.style.setProperty('background-image', 'none', 'important');
        
        // Set data attribute for identification
        button.setAttribute('data-delete-button-fixed', 'true');
        
        // Remove and re-add hover event listeners to prevent conflicts
        const newButton = button.cloneNode(true);
        button.parentNode.replaceChild(newButton, button);
        
        // Add proper hover events
        newButton.addEventListener('mouseenter', function(e) {
            e.target.style.setProperty('background-color', '#c82333', 'important');
            e.target.style.setProperty('background', '#c82333', 'important');
            e.target.style.setProperty('border-color', '#bd2130', 'important');
            e.target.style.setProperty('transform', 'translateY(-2px)', 'important');
            e.target.style.setProperty('box-shadow', '0 4px 8px rgba(220, 53, 69, 0.3)', 'important');
        });
        
        newButton.addEventListener('mouseleave', function(e) {
            e.target.style.setProperty('background-color', '#dc3545', 'important');
            e.target.style.setProperty('background', '#dc3545', 'important');
            e.target.style.setProperty('border-color', '#dc3545', 'important');
            e.target.style.setProperty('transform', 'none', 'important');
            e.target.style.setProperty('box-shadow', 'none', 'important');
        });
        
        console.log(`[DELETE FIX] Fixed button ${index}: ${newButton.textContent.trim()}`);
    });
    
    // Release the processing flag
    isProcessingDeleteButtons = false;
    
    // Check once more after a delay for any dynamically added buttons
    setTimeout(() => {
        // Only process if not already processing
        if (!isProcessingDeleteButtons) {
            const themeButtons = document.querySelectorAll('.routinetest-theme .btn:not([data-delete-button-fixed])');
            themeButtons.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes('confirmDelete')) {
                    // Fix this specific button inline without recursion
                    btn.classList.remove('btn-success', 'btn-primary', 'btn-secondary', 'btn-info');
                    btn.classList.add('btn-danger');
                    btn.style.setProperty('background-color', '#dc3545', 'important');
                    btn.style.setProperty('border-color', '#dc3545', 'important');
                    btn.style.setProperty('color', 'white', 'important');
                    btn.setAttribute('data-delete-button-fixed', 'true');
                }
        });
    }, 100);
}

// Run immediately when page loads
document.addEventListener('DOMContentLoaded', enforceDeleteButtonColors);

// Run after a short delay to catch theme-applied buttons
setTimeout(enforceDeleteButtonColors, 500);

// Watch for dynamic content changes - Fixed to prevent infinite loop
let observerTimeoutId;

const observer = new MutationObserver(function(mutations) {
    // Clear any pending timeouts
    clearTimeout(observerTimeoutId);
    
    // Debounce the enforcement to prevent rapid re-processing
    observerTimeoutId = setTimeout(() => {
        let hasNewDeleteButtons = false;
        
        mutations.forEach(function(mutation) {
            // Only process new nodes, not attribute changes
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === 1 && (
                        (node.matches && node.matches('button[onclick*="confirmDelete"]:not([data-delete-button-fixed])')) ||
                        (node.querySelector && node.querySelector('button[onclick*="confirmDelete"]:not([data-delete-button-fixed])'))
                    )) {
                        hasNewDeleteButtons = true;
                    }
                });
            }
        });
        
        if (hasNewDeleteButtons) {
            console.log('[DELETE FIX] New delete buttons detected, processing');
            enforceDeleteButtonColors();
        }
    }, 250); // Debounce for 250ms
});

// Start observing with more specific configuration (only childList changes)
observer.observe(document.body, {
    childList: true,
    subtree: true
    // Removed attributes watching to prevent infinite loop
});

// Function to update the exam name preview
function updateCopyExamNamePreview() {
    console.log('[COPY_MODAL_PREVIEW] Updating exam name preview...');
    
    const examTypeSelect = document.getElementById('copyExamType');
    const timeslotSelect = document.getElementById('timeslot');
    const academicYearSelect = document.getElementById('academicYear');
    const customSuffixInput = document.getElementById('customSuffix');
    const previewText = document.getElementById('previewText');
    
    if (!previewText) {
        console.error('[COPY_MODAL_PREVIEW] Preview text element not found');
        return;
    }
    
    // Check if all required fields are filled
    if (!examTypeSelect?.value || !timeslotSelect?.value || !academicYearSelect?.value) {
        previewText.textContent = 'Please complete all fields to see preview...';
        console.log('[COPY_MODAL_PREVIEW] Missing required fields');
        return;
    }
    
    // Get the source exam name from the display
    const sourceExamName = document.getElementById('sourceExamName')?.textContent || '';
    
    // Build the name preview
    let nameParts = [];
    
    // Add exam type prefix
    const prefix = examTypeSelect.value === 'QUARTERLY' ? '[QTR]' : '[RT]';
    nameParts.push(prefix);
    
    // Add time period with year
    if (examTypeSelect.value === 'REVIEW') {
        // Convert month code to abbreviated name
        const monthAbbrev = {
            'JAN': 'Jan', 'FEB': 'Feb', 'MAR': 'Mar', 'APR': 'Apr',
            'MAY': 'May', 'JUN': 'Jun', 'JUL': 'Jul', 'AUG': 'Aug',
            'SEP': 'Sep', 'OCT': 'Oct', 'NOV': 'Nov', 'DEC': 'Dec'
        };
        const monthName = monthAbbrev[timeslotSelect.value] || timeslotSelect.value;
        nameParts.push(`${monthName} ${academicYearSelect.value}`);
    } else {
        nameParts.push(`${timeslotSelect.value} ${academicYearSelect.value}`);
    }
    
    // Extract curriculum from source exam name
    const curriculumMatch = sourceExamName.match(/(CORE|ASCENT|EDGE|PINNACLE)\s+(\w+)\s+Lv(\d+)/);
    if (curriculumMatch) {
        const curriculum = `${curriculumMatch[1]} ${curriculumMatch[2]} Lv${curriculumMatch[3]}`;
        nameParts.push(curriculum);
    } else {
        // Try to extract any curriculum-like pattern
        const levelMatch = sourceExamName.match(/Lv\d+/);
        if (levelMatch) {
            const beforeLevel = sourceExamName.substring(
                sourceExamName.lastIndexOf('-') + 1,
                sourceExamName.indexOf(levelMatch[0])
            ).trim();
            if (beforeLevel) {
                nameParts.push(`${beforeLevel}${levelMatch[0]}`);
            }
        }
    }
    
    // Join parts
    let previewName = nameParts.join(' - ');
    
    // Add custom suffix if provided
    const customSuffix = customSuffixInput?.value?.trim();
    if (customSuffix) {
        previewName += customSuffix.startsWith('_') ? customSuffix : `_${customSuffix}`;
    }
    
    previewText.textContent = previewName;
    console.log('[COPY_MODAL_PREVIEW] Generated preview:', previewName);
}

// Populate timeslots based on exam type
function initializeCopyExamEventListeners() {
    console.log('Initializing copy exam event listeners...');
    
    const copyExamTypeSelect = document.getElementById('copyExamType');
    if (!copyExamTypeSelect) {
        console.error('copyExamType element not found');
        return;
    }
    
    copyExamTypeSelect.addEventListener('change', function() {
        console.log('[COPY_MODAL] Exam type changed to:', this.value);
        
        const timeslotSelect = document.getElementById('timeslot');
        if (!timeslotSelect) {
            console.error('[COPY_MODAL] timeslot element not found');
            return;
        }
        
        // Clear existing options
        timeslotSelect.innerHTML = '<option value="">Select time period...</option>';
        
        if (this.value === 'REVIEW') {
            console.log('[COPY_MODAL] Setting up monthly timeslots...');
            // Enable the select
            timeslotSelect.disabled = false;
            
            // Monthly timeslots with proper month codes
            const months = [
                {value: 'JAN', text: 'January'},
                {value: 'FEB', text: 'February'},
                {value: 'MAR', text: 'March'},
                {value: 'APR', text: 'April'},
                {value: 'MAY', text: 'May'},
                {value: 'JUN', text: 'June'},
                {value: 'JUL', text: 'July'},
                {value: 'AUG', text: 'August'},
                {value: 'SEP', text: 'September'},
                {value: 'OCT', text: 'October'},
                {value: 'NOV', text: 'November'},
                {value: 'DEC', text: 'December'}
            ];
            
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.textContent = month.text;
                timeslotSelect.appendChild(option);
            });
        } else if (this.value === 'QUARTERLY') {
            console.log('[COPY_MODAL] Setting up quarterly timeslots...');
            // Enable the select
            timeslotSelect.disabled = false;
            
            // Quarterly timeslots
            ['Q1', 'Q2', 'Q3', 'Q4'].forEach(quarter => {
                const option = document.createElement('option');
                option.value = quarter;
                option.textContent = quarter;
                timeslotSelect.appendChild(option);
            });
        } else {
            console.log('[COPY_MODAL] No exam type selected, disabling timeslot');
            // No exam type selected, disable timeslot
            timeslotSelect.disabled = true;
            timeslotSelect.innerHTML = '<option value="">First select exam type...</option>';
        }
        
        // Update name preview
        updateCopyExamNamePreview();
    });
    
    // Add event listeners for name preview updates
    const timeslotSelect = document.getElementById('timeslot');
    const academicYearSelect = document.getElementById('academicYear');
    const customSuffixInput = document.getElementById('customSuffix');
    
    if (timeslotSelect) {
        timeslotSelect.addEventListener('change', updateCopyExamNamePreview);
    }
    
    if (academicYearSelect) {
        academicYearSelect.addEventListener('change', updateCopyExamNamePreview);
    }
    
    if (customSuffixInput) {
        customSuffixInput.addEventListener('input', updateCopyExamNamePreview);
    }
    
    console.log('Copy exam event listeners initialized successfully');
}

// Initialize all copy exam functionality when DOM is ready
function initializeAllCopyExamFunctionality() {
    initializeCopyExamEventListeners();
    initializeCopyFormSubmission();
    console.log('All copy exam functionality initialized');
}

// Debug function to test modal directly
window.testCopyModal = function() {
    console.log('Testing copy modal...');
    const modal = document.getElementById('copyExamModal');
    if (modal) {
        console.log('Modal found. Current display:', window.getComputedStyle(modal).display);
        console.log('Modal has show class:', modal.classList.contains('show'));
        
        // Toggle the modal using the proper functions
        if (modal.classList.contains('show')) {
            console.log('Closing modal...');
            closeCopyModal();
        } else {
            console.log('Opening modal with test data...');
            openCopyModal('test-id-123', 'Test Exam Name');
        }
        
        const modalContent = modal.querySelector('.modal-content');
        if (modalContent) {
            console.log('Modal content found');
        } else {
            console.error('Modal content not found');
        }
        
        console.log('Modal should be visible now');
        console.log('Final display:', window.getComputedStyle(modal).display);
    } else {
        console.error('Modal not found in DOM');
        
        // Check if the modal HTML exists at all
        const allModals = document.querySelectorAll('.modal');
        console.log('Found modals:', allModals.length);
        allModals.forEach((m, i) => {
            console.log(`Modal ${i}:`, m.id, m.className);
        });
    }
};

// CRITICAL: Ensure openCopyModal is always available
(function() {
    // Create a robust fallback function if not defined
    if (typeof window.openCopyModal === 'undefined') {
        console.warn('[FALLBACK] Creating fallback openCopyModal function');
        window.openCopyModal = function(examId, examName) {
            alert('Fallback function called. examId: ' + examId + ', examName: ' + examName);
        };
    }
    
    if (typeof window.closeCopyModal === 'undefined') {
        console.warn('[FALLBACK] Creating fallback closeCopyModal function');
        window.closeCopyModal = function() {
            console.log('Fallback closeCopyModal called');
        };
    }
    
    console.log('[FUNCTION_CHECK] openCopyModal type:', typeof window.openCopyModal);
    console.log('[FUNCTION_CHECK] closeCopyModal type:', typeof window.closeCopyModal);
})();

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        initializeAllCopyExamFunctionality();
        console.log('Copy exam functionality initialized on DOMContentLoaded');
        
        // Verify functions are available after initialization
        console.log('[POST_INIT] openCopyModal available:', typeof window.openCopyModal === 'function');
        console.log('[POST_INIT] closeCopyModal available:', typeof window.closeCopyModal === 'function');
    });
} else {
    initializeAllCopyExamFunctionality();
    console.log('Copy exam functionality initialized immediately');
    
    // Verify functions are available after initialization
    console.log('[POST_INIT] openCopyModal available:', typeof window.openCopyModal === 'function');
    console.log('[POST_INIT] closeCopyModal available:', typeof window.closeCopyModal === 'function');
}

// ============================================================================
// CLEANUP: Ensure no duplicate functions exist
// ============================================================================
console.log('[COPY MODAL] Final verification of functions:');
console.log('  - window.openCopyModal:', typeof window.openCopyModal);
console.log('  - window.closeCopyModal:', typeof window.closeCopyModal);
</script>

<!-- Load the comprehensive copy modal module -->
<script src="/static/js/routinetest/copy-exam-modal.js?v=1755845820" defer></script>


        </div>
    </div>
    
    <!-- Load RoutineTest Theme CSS IMMEDIATELY after base styles -->
    <link rel="stylesheet" href="/static/css/routinetest-theme.css?v=1755845820">
    
    <!-- Pre-apply theme class to prevent FOUC and ensure CSS rules work -->
    <script>
    (function() {
        // Apply theme class immediately to prevent flash of unstyled content
        document.documentElement.classList.add('routinetest-theme');
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.body.classList.contains('routinetest-theme')) {
                document.body.classList.add('routinetest-theme');
                console.log('[Theme Pre-apply] Added routinetest-theme class to body');
            }
        });
    })();
    </script>
    
    <!-- Load RoutineTest Theme JS -->
    <script src="/static/js/routinetest-theme.js?v=1755845820"></script>
    
    <!-- Removed redundant matrix tab JavaScript files - Navigation V8 handles this -->
    
    <!-- Navigation JavaScript with Console Debugging -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.group('%c[RoutineTest Navigation] Initialization', 'color: #00A65E; font-weight: bold;');
            
            // Log navigation state
            const navTabs = document.querySelectorAll('.nav-tabs a');
            console.log(`Found ${navTabs.length} navigation tabs`);
            
            // Log active tab
            const activeTab = document.querySelector('.nav-tabs a.active');
            if (activeTab) {
                console.log('Active Tab:', activeTab.getAttribute('data-nav') || activeTab.textContent.trim());
                console.log('Active URL:', activeTab.href);
            }
            
            // Add click tracking to all nav items
            navTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    const navName = this.getAttribute('data-nav') || this.textContent.trim();
                    console.log(`%c[RoutineTest Nav Click] ${navName}`, 'color: #00A65E;');
                    console.log('Target URL:', this.href);
                    console.log('Timestamp:', new Date().toISOString());
                    
                    // Track navigation in sessionStorage
                    const navHistory = JSON.parse(sessionStorage.getItem('routinetest_nav_history') || '[]');
                    navHistory.push({
                        tab: navName,
                        url: this.href,
                        timestamp: new Date().toISOString()
                    });
                    sessionStorage.setItem('routinetest_nav_history', JSON.stringify(navHistory.slice(-10))); // Keep last 10
                });
            });
            
            // Log authentication state
            const authState = {
                authenticated: true,
                username: 'teacher1',
                fullName: 'Taehyun Kim',
                is_staff: false,
                page: 'exam_list',
                path: '/RoutineTest/exams/',
                timestamp: new Date().toISOString()
            };
            
            console.log('[RoutineTest Auth State]', authState);
            
            // Log theme confirmation
            console.log('[RoutineTest Theme Check]', {
                primaryColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') || '#00A65E',
                headerBg: getComputedStyle(document.querySelector('.header')).background,
                navBg: getComputedStyle(document.querySelector('.nav-tabs')).backgroundColor
            });
            
            // Performance metrics
            if (window.performance) {
                const perfData = window.performance.timing;
                const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                console.log(`[RoutineTest Performance] Page load time: ${pageLoadTime}ms`);
            }
            
            console.groupEnd();
            
            // Navigation history display
            const navHistory = JSON.parse(sessionStorage.getItem('routinetest_nav_history') || '[]');
            if (navHistory.length > 0) {
                console.group('%c[RoutineTest Navigation History]', 'color: #007C3F;');
                console.table(navHistory);
                console.groupEnd();
            }
        });
        
        // Logout confirmation
        const logoutLink = document.getElementById('logout-link');
        if (logoutLink) {
            logoutLink.addEventListener('click', function(e) {
                console.log('[RoutineTest] Logout initiated');
                if (!confirm('Are you sure you want to logout?')) {
                    e.preventDefault();
                    console.log('[RoutineTest] Logout cancelled');
                }
            });
        }
        
        // Global error handler for debugging
        window.addEventListener('error', function(e) {
            console.error('[RoutineTest Error]', {
                message: e.message,
                filename: e.filename,
                line: e.lineno,
                column: e.colno,
                error: e.error
            });
        });
    </script>
    
    
</body>
</html>