<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview & Answer Keys - [PlacementTest] PRIME ASCENT NOVA - Level 1_v_a - PrimePath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        .header h1 {
            text-align: center;
            font-size: 2rem;
        }
        .content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            background-color: #34495e;
            padding: 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-tabs * {
            box-sizing: border-box;
        }
        .nav-tabs ul {
            list-style: none;
            display: flex;
            margin: 0 auto;
            max-width: 1200px;
            padding: 0 20px;
        }
        .nav-tabs li {
            margin-right: 2px;
        }
        .nav-tabs a {
            display: block;
            padding: 15px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: background-color 0.3s;
            font-weight: 500;
            position: relative;
        }
        .nav-tabs a:hover {
            background-color: #2c3e50;
        }
        .nav-tabs a.active {
            background-color: #3498db !important;
            color: white;
            font-weight: 600;
        }
        
        /* Alert Messages */
        .messages {
            margin-bottom: 20px;
            position: relative;
            z-index: 1000;
        }
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            animation: fadeIn 0.5s ease-in;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 25px 30px;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
        }
        .alert-success::before {
            content: "‚úì";
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 80px;
            opacity: 0.1;
            color: #28a745;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    
<style>
    .container-main {
        max-width: 1600px;
        margin: 0 auto;
        padding: 15px;
    }
    
    /* Create unified card appearance */
    .exam-wrapper {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .exam-info-bar {
        background-color: #f8f9fa;
        padding: 15px 20px;
        border-radius: 8px 8px 0 0;
        margin-bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        border: 1px solid #dee2e6;
        border-bottom: none;
    }
    
    .info-items {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
    }
    
    .info-label {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 2px;
    }
    
    .info-value {
        font-size: 1.1rem;
        font-weight: 500;
        color: #212529;
    }
    
    .status-active {
        color: #28a745;
    }
    
    .status-inactive {
        color: #dc3545;
    }
    
    .pdf-title-section {
        text-align: center;
        margin-bottom: 0;
        padding: 15px 0;
        background-color: #f0f4f8;
        border-radius: 8px 8px 0 0;
        border: 1px solid #dee2e6;
        border-bottom: 1px solid #e9ecef;
    }
    
    .pdf-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin: 0;
        word-break: break-word;
        line-height: 1.3;
    }
    
    /* Responsive Design for 8-18 year olds */
    
    /* Desktop optimizations (1024px+) */
    @media (min-width: 1024px) {
        .container-main {
            max-width: 1800px;
            padding: 25px;
        }
        
        .pdf-section {
            height: 600px;
        }
        
        .pdf-title {
            font-size: 2.8rem;
        }
        
        .pdf-controls {
            background: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 0 !important;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .pdf-controls button {
            min-width: 110px;
            min-height: 44px;
            font-size: 1rem;
            padding: 10px 18px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        #pdf-page-info {
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0 30px;
        }
    }
    
    /* Tablet optimizations (768px to 1023px) */
    @media (min-width: 768px) and (max-width: 1023px) {
        .container-main {
            max-width: 100%;
            padding: 20px 15px;
        }
        
        .pdf-section {
            min-height: 350px;
            height: auto;
            max-height: 75vh;
        }
        
        .pdf-title {
            font-size: 2.2rem;
        }
        
        .pdf-controls {
            background: #fff;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .pdf-controls button {
            min-width: 95px;
            min-height: 44px;
            font-size: 0.95rem;
            padding: 10px 16px;
            border-radius: 6px;
            touch-action: manipulation;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        #pdf-page-info {
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            flex: 1;
        }
    }
    
    /* Touch-friendly improvements for all sizes */
    .pdf-controls button:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .pdf-controls button:active {
        transform: translateY(0);
        transition: all 0.1s ease;
    }
    
    .pdf-controls button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        background-color: #e9ecef !important;
        border-color: #dee2e6 !important;
        color: #6c757d !important;
    }
    
    /* Removed complex PDF canvas styles - using browser-native display */
    
    /* Responsive navigation layout */
    @media (max-width: 767px) {
        .pdf-controls {
            flex-direction: column;
            gap: 10px;
        }
        
        .pdf-controls > div {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .pdf-navigation {
            margin: 0;
        }
    }
    
    .main-content {
        display: flex;
        flex-direction: column;
        gap: 0;
        background: white;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        overflow: hidden;
    }
    
    .pdf-section {
        background: white;
        border: none;
        border-top: 1px solid #dee2e6;
        border-radius: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 400px;
        height: auto;
        max-height: 85vh;
        width: 100%;
    }
    
    .answers-section {
        background: white;
        border: none;
        border-top: 1px solid #dee2e6;
        border-radius: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 400px;
        width: 100%;
    }
    
    /* Last section gets bottom border radius */
    .main-content > *:last-child {
        border-radius: 0 0 8px 8px;
    }
    
    .audio-files-section {
        background: white;
        border: none;
        border-top: 1px solid #dee2e6;
        border-radius: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        width: 100%;
    }
    
    .audio-files-content {
        padding: 20px;
    }
    
    .audio-file-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    
    .audio-actions {
        display: flex;
        gap: 5px;
        align-items: center;
    }
    
    .rename-btn {
        padding: 2px 8px;
        font-size: 0.875rem;
    }
    
    .delete-btn {
        padding: 2px 8px;
        font-size: 0.875rem;
    }
    
    .audio-file-info {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .audio-file-name-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 1rem;
    }
    
    
    .audio-player {
        width: 200px;
    }
    
    .audio-save-indicator {
        color: #28a745;
        font-size: 0.85rem;
        display: none;
    }
    
    .section-header {
        background-color: #f8f9fa;
        padding: 12px 20px;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
    }
    
    .section-header::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(180deg, #007bff, #0056b3);
    }
    
    .section-title {
        font-size: 1.05rem;
        font-weight: 600;
        margin: 0;
        color: #2c3e50;
    }
    
    .pdf-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin: 0 !important;
    }
    
    .pdf-viewer {
        flex: 1;
        overflow: auto;
        text-align: center;
        background-color: #f5f5f5;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }
    
    .answers-content {
        flex: 1;
        overflow-y: auto;
        padding: 15px 20px;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
    }
    
    .question-entry {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 12px;
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .question-number {
        font-weight: 600;
        color: #2c3e50;
        font-size: 1.1rem;
    }
    
    .question-points {
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .question-controls {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 15px;
        margin-bottom: 12px;
    }
    
    .type-selector {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .type-selector label {
        font-size: 0.9rem;
        color: #495057;
        margin: 0;
    }
    
    .type-selector select {
        padding: 6px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 0.9rem;
    }
    
    .options-count-selector {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-left: 15px;
    }
    
    .options-count-selector input {
        width: 50px;
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 0.9rem;
    }
    
    /* Mixed question type styles */
    .mixed-answer-section {
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 12px;
        background: #fbfcfd;
    }
    
    .mixed-type-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .mixed-type-label {
        font-weight: 600;
        color: #495057;
        font-size: 0.95rem;
    }
    
    .remove-section-btn {
        padding: 4px 10px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85rem;
    }
    
    .add-section-btn {
        padding: 8px 16px;
        background: #17a2b8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-top: 10px;
    }
    
    .add-section-btn:hover {
        background: #138496;
    }
    
    .audio-button {
        padding: 6px 15px;
        font-size: 0.85rem;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px;
    }
    
    .audio-button:hover {
        background: #e9ecef;
    }
    
    .audio-button.has-audio {
        background: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
    }
    
    .answer-input-group {
        display: flex;
        gap: 10px;
        align-items: flex-start;
    }
    
    .answer-input {
        flex: 1;
    }
    
    .answer-input input, 
    .answer-input textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 1rem;
        font-family: inherit;
    }
    
    .answer-input textarea {
        min-height: 80px;
        resize: vertical;
    }
    
    .answer-help {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 4px;
    }
    
    /* Multiple choice buttons */
    .mcq-options {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .mcq-button {
        width: 55px;
        height: 55px;
        border: 2px solid #dee2e6;
        background: white;
        border-radius: 8px;
        font-size: 1.3rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .mcq-button:hover {
        background: #f8f9fa;
        border-color: #adb5bd;
    }
    
    .mcq-button.selected {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    .mcq-button.selected:hover {
        background: #0056b3;
        border-color: #0056b3;
    }
    
    /* Checkbox options */
    .checkbox-options {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }
    
    .checkbox-option {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .checkbox-option input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }
    
    .checkbox-option label {
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        margin: 0;
    }
    
    /* Short answer responses */
    .short-answer-responses {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .response-item {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    
    .response-item input {
        flex: 1;
        padding: 6px 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }
    
    .remove-response {
        padding: 4px 8px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85rem;
    }
    
    .remove-response:hover {
        background: #c82333;
    }
    
    .add-response {
        align-self: flex-start;
        padding: 6px 12px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-top: 8px;
    }
    
    .add-response:hover {
        background: #218838;
    }
    
    .save-indicator {
        color: #28a745;
        font-size: 0.85rem;
        display: none;
    }
    
    .audio-section {
        background-color: #f0f8ff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .audio-item {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 10px;
    }
    
    .audio-label {
        font-weight: 500;
        min-width: 150px;
    }
    
    .save-all-section {
        position: sticky;
        bottom: 0;
        background: white;
        border-top: 2px solid #dee2e6;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .unsaved-indicator {
        color: #ffc107;
        display: none;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
        .pdf-section {
            height: 500px;
        }
        
        .answers-content {
            padding: 20px;
        }
    }
    
    /* PDF Canvas Styles - Enhanced for better display */
    .pdf-viewer {
        flex: 1;
        overflow: auto;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 20px;
        min-height: 400px;
    }
    
    /* Removed complex PDF canvas styles - using browser-native display */
    
    .pdf-navigation {
        margin: 0 15px;
        font-size: 1rem;
        font-weight: 500;
        color: #495057;
        white-space: nowrap;
    }
    
    .zoom-controls {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .zoom-level {
        min-width: 50px;
        text-align: center;
        font-weight: 500;
        font-size: 0.9rem;
        color: #495057;
    }
    
    .pdf-controls .btn-sm {
        min-width: 35px;
        min-height: 35px;
        padding: 6px 8px;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .zoom-controls {
        display: flex;
        gap: 5px;
        align-items: center;
    }
    
    .zoom-level {
        min-width: 50px;
        text-align: center;
        font-size: 0.9rem;
    }
    
    /* Success notification animations */
    @keyframes slideDown {
        from {
            transform: translateX(-50%) translateY(-100%);
            opacity: 0;
        }
        to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: translateX(-50%) scale(1);
        }
        50% {
            transform: translateX(-50%) scale(1.02);
        }
    }
</style>

</head>
<body>
    <div class="header">
        <div class="container">
            <h1>[PlacementTest] PRIME ASCENT NOVA - Level 1_v_a - Preview & Answer Keys</h1>
        </div>
    </div>
    
    <nav class="nav-tabs">
        <ul>
            <li><a href="/teacher/dashboard/" class="">Dashboard</a></li>
            <li><a href="/api/placement/exams/create/" class="">Upload Exam</a></li>
            <li><a href="/api/placement/exams/" class="active">Manage Exams</a></li>
            <li><a href="/exam-mapping/" class="">Exam-to-Level Mapping</a></li>
            <li><a href="/placement-rules/" class="">Placement Rules</a></li>
            <li><a href="/api/placement/sessions/" class="">Student Sessions</a></li>
        </ul>
    </nav>
    
    <div class="container">
        
        
        <div class="content">
            
<!-- Success Notification Container -->
<div id="success-notification" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 400px;">
    <div class="alert alert-success" style="margin: 0; padding: 12px 20px; font-size: 1rem; font-weight: 600; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2); background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border-left: 4px solid #28a745; position: relative;">
        <button type="button" class="close-alert" onclick="document.getElementById('success-notification').style.display='none'" style="float: right; background: none; border: none; font-size: 1.3rem; cursor: pointer; color: inherit; margin-left: 15px;">&times;</button>
        <span id="success-message">All answers saved successfully!</span>
        <span style="position: absolute; right: 45px; top: 50%; transform: translateY(-50%); font-size: 1.2rem;">‚úì</span>
    </div>
</div>
<div class="container-main">
    <!-- PDF Title -->
    <div class="pdf-title-section">
        <h1 class="pdf-title">
            [PlacementTest] PRIME ASCENT NOVA - Level 1_v_a
        </h1>
    </div>
    
    <!-- Unified Card Wrapper -->
    <div class="exam-wrapper">
        <!-- Exam Info Bar -->
        <div class="exam-info-bar">
            <div class="info-items">
                <div class="info-item">
                    <span class="info-label">Duration</span>
                    <span class="info-value">30 min</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Questions</span>
                    <span class="info-value">20</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="info-value status-active">
                        Active
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">Created</span>
                    <span class="info-value">Aug 06, 2025</span>
                </div>
            </div>
            <a href="/api/placement/exams/" class="btn btn-secondary btn-sm">Back to List</a>
        </div>
        
        <!-- Main Content Grid -->
        <div class="main-content">
        <!-- PDF Preview Section -->
        <div class="pdf-section">
            <div class="section-header">
                <h3 class="section-title">PDF Preview</h3>
                <!-- Unified PDF Control Bar -->
                <div class="pdf-controls" style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; justify-content: center; padding: 10px; background: #f8f9fa; border-radius: 6px; margin: 0;">
                    <!-- Navigation Group -->
                    <div class="control-group" style="display: flex; align-items: center; gap: 10px;">
                        <button type="button" id="pdf-prev" class="btn btn-primary" disabled>
                            <span class="d-none d-md-inline">‚Üê Previous</span>
                            <span class="d-md-none">‚Üê</span>
                        </button>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span>Page</span>
                            <input type="number" id="pdf-page-input" value="1" min="1" max="1" 
                                   style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                            <span>of <span id="total-pages">1</span></span>
                        </div>
                        <button type="button" id="pdf-next" class="btn btn-primary">
                            <span class="d-none d-md-inline">Next ‚Üí</span>
                            <span class="d-md-none">‚Üí</span>
                        </button>
                    </div>
                    
                    <!-- Divider -->
                    <div class="control-divider" style="width: 1px; height: 30px; background: #dee2e6;"></div>
                    
                    <!-- Rotation Group -->
                    <div class="control-group" style="display: flex; align-items: center; gap: 10px;">
                        <button type="button" id="pdf-rotate-left" class="btn btn-secondary" title="Rotate Left">
                            <span>‚Ü∫ Rotate</span>
                        </button>
                        <button type="button" id="pdf-rotate-right" class="btn btn-secondary" title="Rotate Right">
                            <span>Rotate ‚Üª</span>
                        </button>
                    </div>
                    
                    <!-- Divider -->
                    <div class="control-divider" style="width: 1px; height: 30px; background: #dee2e6;"></div>
                    
                    <!-- Zoom Group -->
                    <div class="control-group zoom-controls" style="display: flex; align-items: center; gap: 10px;">
                        <button type="button" id="pdf-zoom-out" class="btn btn-sm btn-outline-secondary">‚àí</button>
                        <span class="zoom-level" id="pdf-zoom-level">100%</span>
                        <button type="button" id="pdf-zoom-in" class="btn btn-sm btn-outline-secondary">+</button>
                    </div>
                    
                    <!-- Divider -->
                    <div class="control-divider" style="width: 1px; height: 30px; background: #dee2e6;"></div>
                    
                    <!-- Quick Jump Group -->
                    <div class="control-group" style="display: flex; align-items: center; gap: 10px;">
                        <label for="pdf-jump-input" style="margin: 0;">Go to:</label>
                        <input type="number" id="pdf-jump-input" placeholder="Page #" min="1" 
                               style="width: 80px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        <button type="button" id="pdf-jump-btn" class="btn btn-info">
                            <span>üîç Go</span>
                        </button>
                    </div>
                </div>
                    <!-- Skip First Left Half Status (Read-only) - REMOVED FEATURE -->
                    
                    <a href="/media/exams/pdfs/Prime_Path_Prime_Ascent_Drive_Level_1.pdf" class="btn btn-sm btn-primary" download>
                        Download PDF
                    </a>
                </div>
            </div>
            <div class="pdf-viewer" id="pdf-viewer">
                <!-- PDF Image Display -->
                <div id="pdf-image-display" style="width: 100%; height: 100%; position: relative;">
                    <div id="pdf-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                        <p>Loading PDF...</p>
                    </div>
                    <img id="pdf-page-image" style="width: 100%; height: 100%; object-fit: contain; background: white;" alt="PDF Page">
                    
                    <!-- Navigation Controls -->
                    <div id="pdf-nav-controls" style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); border-radius: 25px; padding: 10px 15px; display: flex; align-items: center; gap: 15px;">
                        <button id="pdf-prev" class="btn btn-sm" style="background: #fff; border: none; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">‚Äπ</button>
                        <span id="pdf-page-info" style="color: white; font-weight: 500; min-width: 80px; text-align: center;">Page 1 of 1</span>
                        <button id="pdf-next" class="btn btn-sm" style="background: #fff; border: none; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">‚Ä∫</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Audio Files Management Section -->
        
        <div class="audio-files-section">
            <div class="section-header">
                <h3 class="section-title">Audio Files</h3>
                <button type="button" class="btn btn-sm btn-success" onclick="saveAllAudioNames()">
                    Save Audio Names
                </button>
            </div>
            <div class="audio-files-content">
                
                <div class="audio-file-item" data-audio-id="48" id="audio-item-48">
                    <div class="audio-file-info">
                        <input type="text" 
                               class="audio-file-name-input" 
                               id="audio-name-48"
                               value="EFL Phonics 3rd E_Placement Test_Track 4_D"
                               placeholder="Enter display name for this exam"
                               onchange="markAudioNameChanged(48)">
                        <span class="text-muted" style="font-size: 0.8rem; margin-left: 10px;">(Original: EFL Phonics 3rd E_Placement Test_Track 4_D)</span>
                    </div>
                    <audio controls class="audio-player">
                        <source src="/api/placement/audio/48/" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="audio-actions">
                        <button type="button" 
                                class="btn btn-sm btn-primary rename-btn" 
                                onclick="renameAudioFile(48)"
                                title="Rename this audio file">
                            Rename
                        </button>
                        <button type="button" 
                                class="btn btn-sm btn-danger delete-btn" 
                                onclick="deleteAudioFile(48)"
                                title="Remove this audio file from exam">
                            Delete
                        </button>
                    </div>
                    <span class="audio-save-indicator" id="audio-saved-48">‚úì Saved</span>
                </div>
                
                <div class="audio-file-item" data-audio-id="49" id="audio-item-49">
                    <div class="audio-file-info">
                        <input type="text" 
                               class="audio-file-name-input" 
                               id="audio-name-49"
                               value="EFL Phonics 3rd E_Placement Test_Track 5_E"
                               placeholder="Enter display name for this exam"
                               onchange="markAudioNameChanged(49)">
                        <span class="text-muted" style="font-size: 0.8rem; margin-left: 10px;">(Original: EFL Phonics 3rd E_Placement Test_Track 5_E)</span>
                    </div>
                    <audio controls class="audio-player">
                        <source src="/api/placement/audio/49/" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="audio-actions">
                        <button type="button" 
                                class="btn btn-sm btn-primary rename-btn" 
                                onclick="renameAudioFile(49)"
                                title="Rename this audio file">
                            Rename
                        </button>
                        <button type="button" 
                                class="btn btn-sm btn-danger delete-btn" 
                                onclick="deleteAudioFile(49)"
                                title="Remove this audio file from exam">
                            Delete
                        </button>
                    </div>
                    <span class="audio-save-indicator" id="audio-saved-49">‚úì Saved</span>
                </div>
                
                <div class="audio-file-item" data-audio-id="50" id="audio-item-50">
                    <div class="audio-file-info">
                        <input type="text" 
                               class="audio-file-name-input" 
                               id="audio-name-50"
                               value="Prime Path_Prime Edge_Pursuit_Level 1"
                               placeholder="Enter display name for this exam"
                               onchange="markAudioNameChanged(50)">
                        <span class="text-muted" style="font-size: 0.8rem; margin-left: 10px;">(Original: Prime Path_Prime Edge_Pursuit_Level 1)</span>
                    </div>
                    <audio controls class="audio-player">
                        <source src="/api/placement/audio/50/" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="audio-actions">
                        <button type="button" 
                                class="btn btn-sm btn-primary rename-btn" 
                                onclick="renameAudioFile(50)"
                                title="Rename this audio file">
                            Rename
                        </button>
                        <button type="button" 
                                class="btn btn-sm btn-danger delete-btn" 
                                onclick="deleteAudioFile(50)"
                                title="Remove this audio file from exam">
                            Delete
                        </button>
                    </div>
                    <span class="audio-save-indicator" id="audio-saved-50">‚úì Saved</span>
                </div>
                
            </div>
        </div>
        
        
        <!-- Answer Keys Section -->
        <div class="answers-section">
            <div class="section-header">
                <h3 class="section-title">Answer Keys</h3>
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn btn-sm btn-warning" onclick="randomizeAnswers()">
                        üé≤ Randomize for QA
                    </button>
                    <button type="button" class="btn btn-sm btn-success" onclick="saveAllAnswers()">
                        Save All
                    </button>
                </div>
            </div>
            <div class="answers-content">
                
                <div class="question-entry" data-question-number="1" data-question-id="820">
                    <div class="question-header">
                        <span class="question-number">Question 1</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-1">Question Type:</label>
                            <select id="type-1" 
                                    data-question="1"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-1" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-1"
                                           
                                           onchange="toggleMultipleAnswers(1)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-1"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(1)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="1"
                                onclick="toggleAudio(1)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-1">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-1">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="1"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(1, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="1"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(1, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="1"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(1, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-1" 
                                       data-question="1"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-1">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-1">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="2" data-question-id="821">
                    <div class="question-header">
                        <span class="question-number">Question 2</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-2">Question Type:</label>
                            <select id="type-2" 
                                    data-question="2"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-2" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-2"
                                           
                                           onchange="toggleMultipleAnswers(2)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-2"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(2)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="2"
                                onclick="toggleAudio(2)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-2">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-2">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="2"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(2, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="2"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(2, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="2"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(2, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-2" 
                                       data-question="2"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-2">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-2">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="3" data-question-id="822">
                    <div class="question-header">
                        <span class="question-number">Question 3</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-3">Question Type:</label>
                            <select id="type-3" 
                                    data-question="3"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-3" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-3"
                                           
                                           onchange="toggleMultipleAnswers(3)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-3"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(3)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="3"
                                onclick="toggleAudio(3)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-3">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-3">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="3"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(3, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="3"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(3, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="3"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(3, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-3" 
                                       data-question="3"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-3">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-3">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="4" data-question-id="823">
                    <div class="question-header">
                        <span class="question-number">Question 4</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-4">Question Type:</label>
                            <select id="type-4" 
                                    data-question="4"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-4" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-4"
                                           
                                           onchange="toggleMultipleAnswers(4)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-4"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(4)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="4"
                                onclick="toggleAudio(4)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-4">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-4">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="4"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(4, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="4"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(4, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="4"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(4, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-4" 
                                       data-question="4"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-4">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-4">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="5" data-question-id="824">
                    <div class="question-header">
                        <span class="question-number">Question 5</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-5">Question Type:</label>
                            <select id="type-5" 
                                    data-question="5"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-5" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-5"
                                           
                                           onchange="toggleMultipleAnswers(5)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-5"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(5)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="5"
                                onclick="toggleAudio(5)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-5">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-5">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="5"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(5, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="5"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(5, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="5"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(5, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-5" 
                                       data-question="5"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-5">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-5">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="6" data-question-id="825">
                    <div class="question-header">
                        <span class="question-number">Question 6</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-6">Question Type:</label>
                            <select id="type-6" 
                                    data-question="6"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-6" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-6"
                                           
                                           onchange="toggleMultipleAnswers(6)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-6"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(6)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="6"
                                onclick="toggleAudio(6)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-6">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-6">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="6"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(6, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="6"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(6, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="6"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(6, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-6" 
                                       data-question="6"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-6">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-6">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="7" data-question-id="826">
                    <div class="question-header">
                        <span class="question-number">Question 7</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-7">Question Type:</label>
                            <select id="type-7" 
                                    data-question="7"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-7" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-7"
                                           
                                           onchange="toggleMultipleAnswers(7)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-7"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(7)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="7"
                                onclick="toggleAudio(7)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-7">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-7">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="7"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(7, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="7"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(7, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="7"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(7, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-7" 
                                       data-question="7"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-7">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-7">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="8" data-question-id="827">
                    <div class="question-header">
                        <span class="question-number">Question 8</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-8">Question Type:</label>
                            <select id="type-8" 
                                    data-question="8"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-8" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-8"
                                           
                                           onchange="toggleMultipleAnswers(8)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-8"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(8)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="8"
                                onclick="toggleAudio(8)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-8">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-8">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="8"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(8, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="8"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(8, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="8"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(8, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-8" 
                                       data-question="8"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-8">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-8">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="9" data-question-id="828">
                    <div class="question-header">
                        <span class="question-number">Question 9</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-9">Question Type:</label>
                            <select id="type-9" 
                                    data-question="9"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-9" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-9"
                                           
                                           onchange="toggleMultipleAnswers(9)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-9"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(9)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="9"
                                onclick="toggleAudio(9)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-9">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-9">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="9"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(9, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="9"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(9, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="9"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(9, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-9" 
                                       data-question="9"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-9">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-9">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="10" data-question-id="829">
                    <div class="question-header">
                        <span class="question-number">Question 10</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-10">Question Type:</label>
                            <select id="type-10" 
                                    data-question="10"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-10" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-10"
                                           
                                           onchange="toggleMultipleAnswers(10)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-10"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(10)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="10"
                                onclick="toggleAudio(10)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-10">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-10">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="10"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(10, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="10"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(10, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="10"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(10, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-10" 
                                       data-question="10"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-10">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-10">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="11" data-question-id="830">
                    <div class="question-header">
                        <span class="question-number">Question 11</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-11">Question Type:</label>
                            <select id="type-11" 
                                    data-question="11"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-11" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-11"
                                           
                                           onchange="toggleMultipleAnswers(11)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-11"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(11)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="11"
                                onclick="toggleAudio(11)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-11">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-11">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="11"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(11, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="11"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(11, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="11"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(11, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-11" 
                                       data-question="11"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-11">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-11">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="12" data-question-id="831">
                    <div class="question-header">
                        <span class="question-number">Question 12</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-12">Question Type:</label>
                            <select id="type-12" 
                                    data-question="12"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-12" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-12"
                                           
                                           onchange="toggleMultipleAnswers(12)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-12"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(12)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="12"
                                onclick="toggleAudio(12)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-12">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-12">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="12"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(12, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="12"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(12, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="12"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(12, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-12" 
                                       data-question="12"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-12">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-12">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="13" data-question-id="832">
                    <div class="question-header">
                        <span class="question-number">Question 13</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-13">Question Type:</label>
                            <select id="type-13" 
                                    data-question="13"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-13" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-13"
                                           
                                           onchange="toggleMultipleAnswers(13)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-13"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(13)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="13"
                                onclick="toggleAudio(13)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-13">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-13">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="13"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(13, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="13"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(13, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="13"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(13, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-13" 
                                       data-question="13"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-13">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-13">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="14" data-question-id="833">
                    <div class="question-header">
                        <span class="question-number">Question 14</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-14">Question Type:</label>
                            <select id="type-14" 
                                    data-question="14"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-14" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-14"
                                           
                                           onchange="toggleMultipleAnswers(14)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-14"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(14)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="14"
                                onclick="toggleAudio(14)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-14">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-14">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="14"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(14, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="14"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(14, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="14"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(14, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-14" 
                                       data-question="14"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-14">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-14">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="15" data-question-id="834">
                    <div class="question-header">
                        <span class="question-number">Question 15</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-15">Question Type:</label>
                            <select id="type-15" 
                                    data-question="15"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-15" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-15"
                                           
                                           onchange="toggleMultipleAnswers(15)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-15"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(15)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="15"
                                onclick="toggleAudio(15)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-15">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-15">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="15"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(15, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="15"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(15, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="15"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(15, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-15" 
                                       data-question="15"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-15">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-15">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="16" data-question-id="835">
                    <div class="question-header">
                        <span class="question-number">Question 16</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-16">Question Type:</label>
                            <select id="type-16" 
                                    data-question="16"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-16" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-16"
                                           
                                           onchange="toggleMultipleAnswers(16)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-16"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(16)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="16"
                                onclick="toggleAudio(16)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-16">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-16">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="16"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(16, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="16"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(16, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="16"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(16, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-16" 
                                       data-question="16"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-16">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-16">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="17" data-question-id="836">
                    <div class="question-header">
                        <span class="question-number">Question 17</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-17">Question Type:</label>
                            <select id="type-17" 
                                    data-question="17"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-17" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-17"
                                           
                                           onchange="toggleMultipleAnswers(17)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-17"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(17)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="17"
                                onclick="toggleAudio(17)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-17">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-17">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="17"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(17, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="17"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(17, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="17"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(17, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-17" 
                                       data-question="17"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-17">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-17">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="18" data-question-id="837">
                    <div class="question-header">
                        <span class="question-number">Question 18</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-18">Question Type:</label>
                            <select id="type-18" 
                                    data-question="18"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-18" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-18"
                                           
                                           onchange="toggleMultipleAnswers(18)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-18"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(18)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="18"
                                onclick="toggleAudio(18)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-18">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-18">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="18"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(18, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="18"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(18, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="18"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(18, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-18" 
                                       data-question="18"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-18">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-18">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="19" data-question-id="838">
                    <div class="question-header">
                        <span class="question-number">Question 19</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-19">Question Type:</label>
                            <select id="type-19" 
                                    data-question="19"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-19" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-19"
                                           
                                           onchange="toggleMultipleAnswers(19)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-19"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(19)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="19"
                                onclick="toggleAudio(19)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-19">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-19">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="19"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(19, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="19"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(19, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="19"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(19, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-19" 
                                       data-question="19"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-19">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-19">‚úì Saved</span>
                    </div>
                </div>
                
                <div class="question-entry" data-question-number="20" data-question-id="839">
                    <div class="question-header">
                        <span class="question-number">Question 20</span>
                        <span class="question-points">1 point</span>
                    </div>
                    
                    <div class="question-controls">
                        <div class="type-selector">
                            <label for="type-20">Question Type:</label>
                            <select id="type-20" 
                                    data-question="20"
                                    class="question-type-select">
                                <option value="MCQ" selected>Multiple Choice</option>
                                <option value="SHORT" >Short Answer</option>
                                <option value="LONG" >Long Answer</option>
                                <option value="MIXED" >Mixed</option>
                            </select>
                            <span id="mcq-options-20" style="">
                                <label style="margin-left: 15px;">
                                    <input type="checkbox" 
                                           id="multi-20"
                                           
                                           onchange="toggleMultipleAnswers(20)">
                                    Allow multiple
                                </label>
                                <span class="options-count-selector">
                                    <label>Options:</label>
                                    <input type="number" 
                                           id="options-count-20"
                                           value="3"
                                           min="1" max="10"
                                           onchange="updateOptionsCount(20)">
                                </span>
                            </span>
                        </div>
                        <button type="button" 
                                class="audio-button"
                                data-question="20"
                                onclick="toggleAudio(20)">
                            üéµ Audio
                        </button>
                    </div>
                    
                    <div class="answer-input-group">
                        <div class="answer-input" id="answer-container-20">
                            
                                
                                <div class="mcq-options" id="mcq-buttons-20">
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="20"
                                                data-value="A"
                                                data-multiple="false"
                                                onclick="selectMCQ(20, 'A')">
                                            A
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="20"
                                                data-value="B"
                                                data-multiple="false"
                                                onclick="selectMCQ(20, 'B')">
                                            B
                                        </button>
                                    
                                        <button type="button" 
                                                class="mcq-button "
                                                data-question="20"
                                                data-value="C"
                                                data-multiple="false"
                                                onclick="selectMCQ(20, 'C')">
                                            C
                                        </button>
                                    
                                </div>
                                <input type="hidden" 
                                       id="answer-20" 
                                       data-question="20"
                                       value=""
                                       class="answer-field">
                                <div class="answer-help" id="mcq-help-20">
                                    
                                        Click to select the correct answer
                                    
                                </div>
                                
                            
                        </div>
                        <span class="save-indicator" id="saved-20">‚úì Saved</span>
                    </div>
                </div>
                
            </div>
            <div class="save-all-section">
                <span class="unsaved-indicator" id="unsaved-changes">
                    <i>‚ö† Unsaved changes</i>
                </span>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="clearAllAnswers()">
                        Clear All
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveAllAnswers()">
                        Save All Answers
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End exam-wrapper -->
</div>

<!-- PDF.js for image conversion -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// Wait for PDF.js to load properly
window.addEventListener('DOMContentLoaded', function() {
    // Set a timeout to ensure PDF.js is fully loaded
    setTimeout(function() {
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            console.log('PDF.js loaded successfully');
        } else {
            console.error('PDF.js library failed to load');
        }
    }, 100);
});
</script>
<script>
// Exam ID
const examId = "5ba6870f-7f9f-437c-86e7-37ed04933d97";

// Answer tracking
let unsavedChanges = false;
const answers = {};

// Audio assignments tracking
const audioAssignments = {};

// Track changed audio names
const changedAudioNames = new Set();

// Track local audio display names
const localAudioNames = {};

// Answers are already loaded in the input fields from the backend

// Get CSRF token from cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

console.log('üöÄ NUCLEAR DEBUG - Script loading at ' + new Date().toISOString());

// NUCLEAR OVERRIDE - Clear any existing assignments
window.audioAssignments = {};
console.log('üí• NUCLEAR: Cleared audioAssignments');

document.addEventListener('DOMContentLoaded', function() {
    console.log('üî• NUCLEAR DEBUG - DOMContentLoaded fired! Timestamp: ' + new Date().toISOString());
    
    // NUCLEAR: Override any existing loading
    window.audioAssignments = {};
    console.log('üí• NUCLEAR: Re-cleared audioAssignments in DOMContentLoaded');
    
    console.log('üîç DEBUG: audioAssignments initial state:', audioAssignments);
    
    // Initialize PDF image display
    initializePdfImageDisplay();
    
    // Initialize answer tracking
    initializeAnswerTracking();
    
    // Load saved local audio names
    loadLocalAudioNames();
    
    // Load audio assignments from Question.audio_file relationships
    console.log('üîç DEBUG: Template rendering questions...');
    
        console.log('üîç Question 1: audio_file = null');
    
        console.log('üîç Question 2: audio_file = null');
    
        console.log('üîç Question 3: audio_file = null');
    
        console.log('üîç Question 4: audio_file = null');
    
        console.log('üîç Question 5: audio_file = null');
    
        console.log('üîç Question 6: audio_file = null');
    
        console.log('üîç Question 7: audio_file = null');
    
        console.log('üîç Question 8: audio_file = null');
    
        console.log('üîç Question 9: audio_file = null');
    
        console.log('üîç Question 10: audio_file = null');
    
        console.log('üîç Question 11: audio_file = null');
    
        console.log('üîç Question 12: audio_file = null');
    
        console.log('üîç Question 13: audio_file = null');
    
        console.log('üîç Question 14: audio_file = null');
    
        console.log('üîç Question 15: audio_file = null');
    
        console.log('üîç Question 16: audio_file = null');
    
        console.log('üîç Question 17: audio_file = null');
    
        console.log('üîç Question 18: audio_file = null');
    
        console.log('üîç Question 19: audio_file = null');
    
        console.log('üîç Question 20: audio_file = null');
    
    
    const questionAudioData = [
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    ];
    
    console.log('üîç DEBUG: questionAudioData length:', questionAudioData.length);
    
    console.log('=== NEW AUDIO ASSIGNMENT LOADING DEBUG ===');
    console.log('questionAudioData:', questionAudioData);
    console.log('audioAssignments before loading:', audioAssignments);
    
    // NUCLEAR: Clear before loading new assignments
    window.audioAssignments = {};
    console.log('üí• NUCLEAR: Final clear before loading assignments');
    
    questionAudioData.forEach((data, index) => {
        console.log(`üöÄ NUCLEAR LOADING assignment ${index + 1}: Q${data.questionNum} -> Audio ${data.audioId}`);
        
        // Load direct Question -> AudioFile relationships
        audioAssignments[data.questionNum] = data.audioId;
        console.log('‚úÖ NUCLEAR ASSIGNMENT: Q' + data.questionNum + ' -> Audio ID ' + data.audioId);
        
        const buttonSelector = `[data-question="${data.questionNum}"].audio-button`;
        console.log('üîç Looking for button with selector:', buttonSelector);
        
        const button = document.querySelector(buttonSelector);
        console.log('üîç Button found:', button ? 'YES' : 'NO');
        
        if (button) {
            button.classList.add('has-audio');
            // Use local name if available, otherwise use original
            const name = localAudioNames[data.audioId] || data.audioName;
            const displayName = name.substring(0, 20) + (name.length > 20 ? '...' : '');
            const newText = `üéµ Audio: ${displayName}`;
            button.innerHTML = newText;
            console.log(`‚úÖ Updated button for Q${data.questionNum}: "${newText}"`);
        } else {
            console.log(`‚ùå Button not found for Q${data.questionNum} with selector: ${buttonSelector}`);
        }
    });
    
    console.log('audioAssignments after loading:', audioAssignments);
    console.log('=== END AUDIO ASSIGNMENT LOADING DEBUG ===');
    
    // NUCLEAR: Final check and protection
    console.log('üí• NUCLEAR FINAL CHECK - audioAssignments contains:', Object.keys(audioAssignments).length, 'assignments');
    for (const [q, audioId] of Object.entries(audioAssignments)) {
        console.log(`üí• FINAL: Q${q} -> Audio ${audioId}`);
    }
});

// PDF Image Display System
let pdfDoc = null;
let currentPage = 1;
let totalPages = 0;
let pageImages = new Map(); // Cache for converted images
let currentZoomLevel = 1.0; // Zoom level for image scaling
let currentRotation = 0; // Track rotation angle (0, 90, 180, 270)
let minZoom = 0.5;
let maxZoom = 3.0;

function initializePdfImageDisplay() {
    const pdfUrl = "/media/exams/pdfs/Prime_Path_Prime_Ascent_Drive_Level_1.pdf";
    
    if (typeof pdfjsLib === 'undefined') {
        console.warn('PDF.js not loaded yet, retrying...');
        setTimeout(function() {
            initializePdfImageDisplay();
        }, 500);
        return;
    }
    
    pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
        pdfDoc = pdf;
        totalPages = pdf.numPages;
        currentPage = 1;
        pageImages.clear();
        
        // Update page info
        updatePageInfo();
        
        // Load first page
        renderPageAsImage(1);
        
        console.log('‚úÖ PDF loaded successfully:', totalPages, 'pages');
        
    }).catch(function(error) {
        console.error('Error loading PDF:', error);
        document.getElementById('pdf-loading').innerHTML = '<p style="color: red;">Error loading PDF. Please try again.</p>';
    });
}

function renderPageAsImage(pageNum) {
    if (!pdfDoc) return;
    
    const loading = document.getElementById('pdf-loading');
    const pageImage = document.getElementById('pdf-page-image');
    
    // Clear cache when rotation changes (include rotation in cache key)
    const cacheKey = `${pageNum}_${currentRotation}`;
    
    // Check cache first
    if (pageImages.has(cacheKey)) {
        pageImage.src = pageImages.get(cacheKey);
        loading.style.display = 'none';
        return;
    }
    
    loading.style.display = 'block';
    
    pdfDoc.getPage(pageNum).then(function(page) {
        // Create canvas for rendering
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // Calculate scale for good quality with rotation
        const viewport = page.getViewport({ scale: 2.0, rotation: currentRotation });
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        
        // Render page to canvas
        const renderContext = {
            canvasContext: ctx,
            viewport: viewport
        };
        
        page.render(renderContext).promise.then(function() {
            // Convert canvas to image
            const imageDataURL = canvas.toDataURL('image/png');
            
            // Cache the image with rotation key
            pageImages.set(cacheKey, imageDataURL);
            
            // Display the image
            pageImage.src = imageDataURL;
            loading.style.display = 'none';
            
            // Apply current zoom level to new image
            applyZoomToImage();
            updateZoomDisplay();
            
            console.log('‚úÖ Page', pageNum, 'rendered as image');
        });
    });
}

function updatePageInfo() {
    const prevBtn = document.getElementById('pdf-prev');
    const nextBtn = document.getElementById('pdf-next');
    const pageInput = document.getElementById('pdf-page-input');
    const totalPagesSpan = document.getElementById('total-pages');
    const jumpInput = document.getElementById('pdf-jump-input');
    
    if (prevBtn) {
        prevBtn.disabled = currentPage === 1;
    }
    if (nextBtn) {
        nextBtn.disabled = currentPage === totalPages;
    }
    if (pageInput) {
        pageInput.value = currentPage;
        pageInput.max = totalPages;
    }
    if (totalPagesSpan) {
        totalPagesSpan.textContent = totalPages;
    }
    if (jumpInput) {
        jumpInput.max = totalPages;
    }
}

function updateZoomDisplay() {
    const zoomElement = document.getElementById('pdf-zoom-level');
    if (zoomElement) {
        zoomElement.textContent = Math.round(currentZoomLevel * 100) + '%';
    }
}

function applyZoomToImage() {
    const pageImage = document.getElementById('pdf-page-image');
    if (pageImage) {
        pageImage.style.transform = `scale(${currentZoomLevel})`;
        pageImage.style.transformOrigin = 'center center';
        console.log('‚úÖ Applied zoom level:', Math.round(currentZoomLevel * 100) + '%');
    }
}

function zoomIn() {
    if (currentZoomLevel < maxZoom) {
        currentZoomLevel = Math.min(currentZoomLevel * 1.2, maxZoom);
        applyZoomToImage();
        updateZoomDisplay();
    }
}

function zoomOut() {
    if (currentZoomLevel > minZoom) {
        currentZoomLevel = Math.max(currentZoomLevel / 1.2, minZoom);
        applyZoomToImage();
        updateZoomDisplay();
    }
}

function resetZoom() {
    currentZoomLevel = 1.0;
    applyZoomToImage();
    updateZoomDisplay();
}

// Navigation event listeners
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('pdf-prev')?.addEventListener('click', function() {
        if (currentPage > 1) {
            currentPage--;
            renderPageAsImage(currentPage);
            updatePageInfo();
        }
    });

    document.getElementById('pdf-next')?.addEventListener('click', function() {
        if (currentPage < totalPages) {
            currentPage++;
            renderPageAsImage(currentPage);
            updatePageInfo();
        }
    });

    // Zoom event listeners
    document.getElementById('pdf-zoom-in')?.addEventListener('click', function() {
        zoomIn();
    });

    document.getElementById('pdf-zoom-out')?.addEventListener('click', function() {
        zoomOut();
    });

    document.getElementById('pdf-zoom-level')?.addEventListener('dblclick', function() {
        resetZoom();
    });
});

// Removed complex PDF functions - replaced with image display system

// Helper function to mark as unsaved
function initializePdfViewer_REMOVED() {
    console.log('üî• [PREVIEW_EXAM] initializePdfViewer() called');
    console.log('üî• [PREVIEW_EXAM] pdfjsLib available:', typeof pdfjsLib !== 'undefined');
    
    if (typeof pdfjsLib === 'undefined') {
        console.error('‚ùå [PREVIEW_EXAM] pdfjsLib is undefined');
        document.getElementById('pdf-loading').style.display = 'none';
        document.getElementById('pdf-error').style.display = 'block';
        return;
    }
    
    const pdfUrl = "/media/exams/pdfs/Prime_Path_Prime_Ascent_Drive_Level_1.pdf";
    console.log('üî• [PREVIEW_EXAM] PDF URL:', pdfUrl);
    
    console.log('üî• [PREVIEW_EXAM] Calling pdfjsLib.getDocument...');
    pdfjsLib.getDocument({
        url: pdfUrl,
        // Disable CMap loading to avoid CORS issues
        disableFontFace: false,
        disableStream: false,
        disableAutoFetch: false
    }).promise.then(function(pdf) {
        console.log('‚úÖ [PREVIEW_EXAM] PDF loaded successfully');
        pdfDoc = pdf;
        detectedDividers.clear(); // Clear divider cache for new PDF
        
        // Convert to virtual pages (each actual page = 2 virtual pages for split view)
        totalPages = pdf.numPages * 2;
        
        // Skip first left half is disabled (field removed)
        const skipFirstLeftHalf = false;
        currentPageNum = skipFirstLeftHalf ? 2 : 1; // Start from page 2 if first left half is hidden
        
        console.log('üî• [PREVIEW_EXAM] PDF info:', {
            actualPages: pdf.numPages,
            totalPages,
            startingVirtualPage: currentPageNum
        });
        
        const totalPagesElement = document.getElementById('total-pages');
        if (totalPagesElement) {
            totalPagesElement.textContent = totalPages;
            console.log('üî• [PREVIEW_EXAM] Total pages element updated to:', totalPages);
        } else {
            console.warn('‚ö†Ô∏è [PREVIEW_EXAM] Total pages element not found');
        }
        
        console.log('üî• [PREVIEW_EXAM] Starting virtual page set to:', currentPageNum);
        
        console.log('üî• [PREVIEW_EXAM] Updating navigation buttons...');
        updateNavigationButtons();
        
        const loadingElement = document.getElementById('pdf-loading');
        const canvasElement = document.getElementById('pdf-canvas');
        
        if (loadingElement) {
            loadingElement.style.display = 'none';
            console.log('üî• [PREVIEW_EXAM] Loading element hidden');
        } else {
            console.warn('‚ö†Ô∏è [PREVIEW_EXAM] Loading element not found');
        }
        
        if (canvasElement) {
            canvasElement.style.display = 'block';
            console.log('üî• [PREVIEW_EXAM] Canvas element shown');
        } else {
            console.warn('‚ö†Ô∏è [PREVIEW_EXAM] Canvas element not found');
        }
        
        console.log('üî• [PREVIEW_EXAM] Starting first virtual page render...');
        renderPage(currentPageNum);
    }).catch(function(error) {
        console.error('‚ùå [PREVIEW_EXAM] Error loading PDF:', error);
        
        const loadingElement = document.getElementById('pdf-loading');
        const errorElement = document.getElementById('pdf-error');
        
        if (loadingElement) {
            loadingElement.style.display = 'none';
            console.log('üî• [PREVIEW_EXAM] Loading element hidden after error');
        }
        
        if (errorElement) {
            errorElement.style.display = 'block';
            console.log('üî• [PREVIEW_EXAM] Error element shown');
        }
    });
}

// Detect content boundaries to minimize white space and improve resolution
function detectContentBoundaries(canvas, ctx) {
    console.log('üîç [PREVIEW_EXAM] Starting content boundary detection...');
    
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;
    const width = canvas.width;
    const height = canvas.height;
    
    // Detect top boundary (first row with content)
    let topBoundary = 0;
    for (let y = 0; y < height; y++) {
        let hasContent = false;
        for (let x = 0; x < width; x++) {
            const idx = (y * width + x) * 4;
            const r = data[idx];
            const g = data[idx + 1];
            const b = data[idx + 2];
            // Check if pixel is not white/near-white (allowing for scanning artifacts)
            if (r < 240 || g < 240 || b < 240) {
                hasContent = true;
                break;
            }
        }
        if (hasContent) {
            topBoundary = Math.max(0, y - 10); // Add small margin
            break;
        }
    }
    
    // Detect bottom boundary (last row with content)
    let bottomBoundary = height;
    for (let y = height - 1; y >= 0; y--) {
        let hasContent = false;
        for (let x = 0; x < width; x++) {
            const idx = (y * width + x) * 4;
            const r = data[idx];
            const g = data[idx + 1];
            const b = data[idx + 2];
            if (r < 240 || g < 240 || b < 240) {
                hasContent = true;
                break;
            }
        }
        if (hasContent) {
            bottomBoundary = Math.min(height, y + 10); // Add small margin
            break;
        }
    }
    
    console.log('üîç [PREVIEW_EXAM] Content boundaries detected:', {
        topBoundary,
        bottomBoundary,
        contentHeight: bottomBoundary - topBoundary,
        originalHeight: height,
        whitespaceReduction: Math.round((1 - (bottomBoundary - topBoundary) / height) * 100) + '%'
    });
    
    return { topBoundary, bottomBoundary };
}

// Detect divider line in scanned PDF page (enhanced with content boundaries)
function detectDividerLine(canvas, ctx, viewport) {
    console.log('üîç [PREVIEW_EXAM] Starting divider line detection...');
    
    // Get image data from the full page canvas
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;
    const width = canvas.width;
    const height = canvas.height;
    
    console.log('üîç [PREVIEW_EXAM] Canvas dimensions:', { width, height });
    
    // Search range: 40%-60% of page width (as specified)
    const searchStartX = Math.floor(width * 0.4);
    const searchEndX = Math.floor(width * 0.6);
    const searchWidth = searchEndX - searchStartX;
    
    console.log('üîç [PREVIEW_EXAM] Search range:', { 
        searchStartX, 
        searchEndX, 
        searchWidth,
        percentageRange: '40%-60%'
    });
    
    // Enhanced divider detection using content gap analysis
    const sampleInterval = Math.max(1, Math.floor(searchWidth / 100)); // Increased sampling density
    let bestDividerX = Math.floor(width / 2); // Default to 50% if no line found
    let maxScore = 0;
    
    console.log('üîç [PREVIEW_EXAM] Enhanced sample interval:', sampleInterval);
    
    // Method 1: Content gap detection - look for vertical strips with minimal content
    const contentAnalysis = [];
    for (let x = searchStartX; x < searchEndX; x += sampleInterval) {
        let contentPixels = 0;
        let totalPixels = 0;
        let subtleFeatures = 0;
        
        // Sample pixels vertically through the strip (focus on content area)
        const sampleStartY = Math.floor(height * 0.15);
        const sampleEndY = Math.floor(height * 0.85);
        const verticalSampleInterval = Math.max(1, Math.floor((sampleEndY - sampleStartY) / 40));
        
        for (let y = sampleStartY; y < sampleEndY; y += verticalSampleInterval) {
            const pixelIndex = (y * width + x) * 4;
            const r = data[pixelIndex];
            const g = data[pixelIndex + 1];
            const b = data[pixelIndex + 2];
            const brightness = (r + g + b) / 3;
            
            totalPixels++;
            
            // Detect content pixels (not pure white)
            if (brightness < 240) {
                contentPixels++;
            }
            
            // Detect subtle features (slightly off-white, like book spine shadows)
            if (brightness >= 240 && brightness < 250) {
                subtleFeatures++;
            }
        }
        
        const contentRatio = totalPixels > 0 ? contentPixels / totalPixels : 0;
        const subtleRatio = totalPixels > 0 ? subtleFeatures / totalPixels : 0;
        
        contentAnalysis.push({ x, contentRatio, subtleRatio });
    }
    
    // Method 2: Multi-factor scoring for book spine detection
    for (let i = 0; i < contentAnalysis.length; i++) {
        const current = contentAnalysis[i];
        let score = 0;
        
        // Factor 1: Low content density (spine areas have less text/content)
        const contentGapScore = (1 - current.contentRatio) * 40;
        score += contentGapScore;
        
        // Factor 2: Proximity to center (book spines are typically near 50%)
        const distanceFromCenter = Math.abs((current.x / width) - 0.5);
        const centerScore = (1 - distanceFromCenter * 2) * 30;
        score += centerScore;
        
        // Factor 3: Subtle features (spine shadows, binding lines)
        const subtleScore = current.subtleRatio * 25;
        score += subtleScore;
        
        // Factor 4: Content transition detection (left content vs right content)
        if (i >= 2 && i < contentAnalysis.length - 2) {
            const leftContent = (contentAnalysis[i-2].contentRatio + contentAnalysis[i-1].contentRatio) / 2;
            const rightContent = (contentAnalysis[i+1].contentRatio + contentAnalysis[i+2].contentRatio) / 2;
            const transitionScore = Math.abs(leftContent - rightContent) * 20;
            score += transitionScore;
        }
        
        // Factor 5: Vertical consistency (spine features should be consistent vertically)
        let verticalConsistency = 0;
        const checkPoints = 8;
        const sampleStartY = Math.floor(height * 0.2);
        const sampleEndY = Math.floor(height * 0.8);
        
        for (let j = 0; j < checkPoints; j++) {
            const y = sampleStartY + Math.floor(j * (sampleEndY - sampleStartY) / checkPoints);
            const pixelIndex = (y * width + current.x) * 4;
            const r = data[pixelIndex];
            const g = data[pixelIndex + 1];
            const b = data[pixelIndex + 2];
            const brightness = (r + g + b) / 3;
            
            // Look for consistent non-content pixels (white-ish or subtle shadows)
            if (brightness >= 235) {
                verticalConsistency++;
            }
        }
        
        const consistencyScore = (verticalConsistency / checkPoints) * 15;
        score += consistencyScore;
        
        if (score > maxScore) {
            maxScore = score;
            bestDividerX = current.x;
            
            console.log('üîç [PREVIEW_EXAM] New best divider candidate:', {
                x: current.x,
                ratio: (current.x / width).toFixed(3),
                contentRatio: current.contentRatio.toFixed(3),
                subtleRatio: current.subtleRatio.toFixed(3),
                score: score.toFixed(2),
                factors: {
                    contentGap: contentGapScore.toFixed(1),
                    center: centerScore.toFixed(1),
                    subtle: subtleScore.toFixed(1),
                    consistency: consistencyScore.toFixed(1)
                }
            });
        }
    }
    
    // Validate the detected position
    const dividerRatio = bestDividerX / width;
    let finalDividerX;
    
    if (dividerRatio >= 0.4 && dividerRatio <= 0.6) {
        finalDividerX = bestDividerX;
        console.log('‚úÖ [PREVIEW_EXAM] Enhanced divider detected at:', {
            x: finalDividerX,
            ratio: dividerRatio,
            percentage: Math.round(dividerRatio * 100) + '%',
            score: maxScore.toFixed(2),
            method: 'Content gap analysis with multi-factor scoring'
        });
    } else {
        finalDividerX = Math.floor(width / 2); // Fallback to 50%
        console.log('‚ö†Ô∏è [PREVIEW_EXAM] Enhanced detection out of range, using 50% fallback:', {
            detectedX: bestDividerX,
            detectedRatio: dividerRatio,
            detectedScore: maxScore.toFixed(2),
            fallbackX: finalDividerX,
            fallbackRatio: 0.5
        });
    }
    
    return finalDividerX;
}

function renderPage(vPageNum) {
    console.log('üî• [PREVIEW_EXAM] renderPage() called with vPageNum:', vPageNum);
    console.log('üî• [PREVIEW_EXAM] pdfDoc exists:', !!pdfDoc);
    console.log('üî• [PREVIEW_EXAM] totalPages:', totalPages);
    
    if (!pdfDoc) {
        console.error('‚ùå [PREVIEW_EXAM] No pdfDoc available for rendering');
        return;
    }
    
    currentPageNum = vPageNum;
    
    // Calculate actual PDF page based on virtual page
    let actualPageNum = Math.ceil(vPageNum / 2);
    let isLeftColumn = (vPageNum % 2) === 1;
    
    console.log('üî• [PREVIEW_EXAM] Virtual to actual page mapping:', {
        virtualPage: vPageNum,
        actualPage: actualPageNum,
        isLeftColumn,
        columnText: isLeftColumn ? 'Left' : 'Right'
    });
    
    console.log('üî• [PREVIEW_EXAM] Getting actual page', actualPageNum, 'from PDF...');
    pdfDoc.getPage(actualPageNum).then(function(page) {
        console.log('‚úÖ [PREVIEW_EXAM] Successfully got actual page', actualPageNum);
        
        currentPdfPage = page; // Store for zoom operations
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');
        
        console.log('üî• [PREVIEW_EXAM] Canvas element found:', !!canvas);
        console.log('üî• [PREVIEW_EXAM] Canvas context obtained:', !!ctx);
        
        // Get container dimensions
        const container = document.getElementById('pdf-viewer');
        const containerWidth = container.clientWidth - 20;
        const containerHeight = container.clientHeight - 20;
        
        console.log('üî• [PREVIEW_EXAM] Container dimensions:', {
            containerWidth,
            containerHeight,
            containerClientWidth: container.clientWidth,
            containerClientHeight: container.clientHeight
        });
        
        // Get page viewport at scale 1
        const viewport = page.getViewport({ scale: 1 });
        
        console.log('üî• [PREVIEW_EXAM] Page viewport at scale 1:', {
            width: viewport.width,
            height: viewport.height
        });
        
        // Enhanced scale calculation for maximum content utilization
        const targetWidth = containerWidth * 0.95; // Use 95% of container width
        const targetHeight = containerHeight * 0.90; // Use 90% of container height
        
        // Scale for half-width display but optimize for content visibility
        const scaleX = (targetWidth * 1.8) / viewport.width; // Increased multiplier for better width usage
        const scaleY = targetHeight / viewport.height;
        
        // Use higher minimum scale for better readability, prioritize content size
        const scale = Math.max(Math.min(scaleX, scaleY), 1.5); // Increased minimum from 0.95 to 1.5
        
        console.log('üî• [PREVIEW_EXAM] Scale calculations for column view:', {
            originalViewportWidth: viewport.width,
            halfPageWidth: viewport.width / 2,
            scaleX,
            scaleY,
            finalScale: scale,
            scalingPercentage: Math.round(scale * 100)
        });
        
        // Get scaled viewport for rendering
        const scaledViewport = page.getViewport({ scale: scale });
        
        console.log('üî• [PREVIEW_EXAM] Scaled viewport:', {
            width: scaledViewport.width,
            height: scaledViewport.height
        });
        
        // Set canvas size for column view (true half of original page width - match Student interface)
        // Height set initially, width will be set after divider detection
        canvas.height = scaledViewport.height;
        
        console.log('üî• [PREVIEW_EXAM] Initial canvas setup for adaptive column view:', {
            height: canvas.height,
            originalPageWidth: scaledViewport.width,
            note: 'Canvas width will be set after divider detection'
        });
        
        // Create a temporary canvas for full page rendering
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = scaledViewport.width;
        tempCanvas.height = scaledViewport.height;
        
        console.log('üî• [PREVIEW_EXAM] Temporary canvas created for full page:', {
            width: tempCanvas.width,
            height: tempCanvas.height
        });
        
        // Render full page to temp canvas
        const renderContext = {
            canvasContext: tempCtx,
            viewport: scaledViewport
        };
        
        console.log('üî• [PREVIEW_EXAM] Starting full page render to temp canvas...');
        
        const renderPromise = page.render(renderContext);
        
        renderPromise.promise.then(() => {
            console.log('‚úÖ [PREVIEW_EXAM] Full page rendered to temp canvas successfully');
            
            // Detect content boundaries to minimize white space
            const contentBounds = detectContentBoundaries(tempCanvas, tempCtx);
            
            // Detect or retrieve cached divider position for this page
            let dividerX;
            const pageKey = `page_${actualPageNum}`;
            
            if (detectedDividers.has(pageKey)) {
                dividerX = detectedDividers.get(pageKey);
                console.log('üìã [PREVIEW_EXAM] Using cached divider position:', { pageKey, dividerX });
            } else {
                // Detect divider line in the full page
                dividerX = detectDividerLine(tempCanvas, tempCtx, viewport);
                detectedDividers.set(pageKey, dividerX);
                console.log('üîç [PREVIEW_EXAM] Detected and cached divider position:', { pageKey, dividerX });
            }
            
            // Calculate source region with content boundaries for optimal display
            let sourceX, sourceWidth, sourceY, sourceHeight;
            if (isLeftColumn) {
                sourceX = 0;
                sourceWidth = dividerX;
            } else {
                sourceX = dividerX;
                sourceWidth = scaledViewport.width - dividerX; // Remaining width after divider
            }
            
            // Use content boundaries to eliminate white space
            sourceY = contentBounds.topBoundary;
            sourceHeight = contentBounds.bottomBoundary - contentBounds.topBoundary;
            
            // Calculate optimized canvas dimensions
            const canvasWidth = sourceWidth * scale;
            const canvasHeight = sourceHeight * scale;
            
            // Set canvas size to content-optimized dimensions
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            console.log('üî• [PREVIEW_EXAM] Content-optimized canvas dimensions:', {
                canvasWidth,
                canvasHeight,
                sourceWidth,
                sourceHeight,
                contentHeightReduction: Math.round((1 - sourceHeight / scaledViewport.height) * 100) + '%'
            });
            
            // Clear main canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            console.log('üî• [PREVIEW_EXAM] Copying optimized content area from temp canvas:', {
                isLeftColumn,
                dividerX,
                dividerRatio: (dividerX / scaledViewport.width).toFixed(3),
                sourceX,
                sourceY,
                sourceWidth,
                sourceHeight,
                canvasWidth: canvas.width,
                canvasHeight: canvas.height,
                scale: scale,
                qualityImprovement: 'Content-focused rendering with boundary detection'
            });
            
            ctx.drawImage(
                tempCanvas,
                sourceX, sourceY, sourceWidth, sourceHeight,  // source (content-optimized area)
                0, 0, canvas.width, canvas.height            // destination (full canvas)
            );
            
            console.log('‚úÖ [PREVIEW_EXAM] Adaptive column copied to main canvas successfully');
            
            // Update zoom level display
            const zoomElement = document.getElementById('pdf-zoom-level');
            if (zoomElement) {
                zoomElement.textContent = Math.round(currentZoomLevel * 100) + '%';
                console.log('üî• [PREVIEW_EXAM] Base zoom level set to:', Math.round(currentZoomLevel * 100) + '%');
            } else {
                console.warn('‚ö†Ô∏è [PREVIEW_EXAM] Zoom level element not found');
            }
            
        }).catch((error) => {
            console.error('‚ùå [PREVIEW_EXAM] Error rendering page:', error);
        });
        
    }).catch(function(error) {
        console.error('‚ùå [PREVIEW_EXAM] Error getting page', actualPageNum, ':', error);
    });
    
    // Update page counter
    const pageCountElement = document.getElementById('current-page');
    if (pageCountElement) {
        const columnText = (vPageNum % 2) === 1 ? '(Left)' : '(Right)';
        pageCountElement.textContent = `${vPageNum} ${columnText}`;
        console.log('üî• [PREVIEW_EXAM] Page counter updated to:', `${vPageNum} ${columnText}`);
    } else {
        console.warn('‚ö†Ô∏è [PREVIEW_EXAM] Page counter element not found');
    }
}

function updateNavigationButtons() {
    const skipFirstLeftHalf = false;
    const minPage = skipFirstLeftHalf ? 2 : 1;
    document.getElementById('pdf-prev').disabled = currentPageNum <= minPage;
    document.getElementById('pdf-next').disabled = currentPageNum >= totalPages;
}

// PDF navigation
document.getElementById('pdf-prev').addEventListener('click', function() {
    const skipFirstLeftHalf = false;
    const minPage = skipFirstLeftHalf ? 2 : 1;
    
    if (!pdfDoc || currentPageNum <= minPage) {
        return;
    }
    currentPageNum--;
    console.log('üî• [PREVIEW_EXAM] Previous page clicked, new currentPageNum:', currentPageNum);
    renderPage(currentPageNum);
    updateNavigationButtons();
});

document.getElementById('pdf-next').addEventListener('click', function() {
    if (!pdfDoc || currentPageNum >= totalPages) {
        return;
    }
    currentPageNum++;
    console.log('üî• [PREVIEW_EXAM] Next page clicked, new currentPageNum:', currentPageNum);
    renderPage(currentPageNum);
    updateNavigationButtons();
});

// Rotate left button
document.getElementById('pdf-rotate-left').addEventListener('click', function() {
    if (!pdfDoc) return;
    
    currentRotation = (currentRotation - 90) % 360;
    if (currentRotation < 0) currentRotation += 360;
    
    console.log('üî• [PREVIEW_EXAM] Rotate left clicked, new rotation:', currentRotation);
    renderPageAsImage(currentPage); // Re-render current page with new rotation
});

// Rotate right button
document.getElementById('pdf-rotate-right').addEventListener('click', function() {
    if (!pdfDoc) return;
    
    currentRotation = (currentRotation + 90) % 360;
    
    console.log('üî• [PREVIEW_EXAM] Rotate right clicked, new rotation:', currentRotation);
    renderPageAsImage(currentPage); // Re-render current page with new rotation
});

// Page input navigation
document.getElementById('pdf-page-input')?.addEventListener('change', function() {
    const targetPage = parseInt(this.value);
    if (targetPage >= 1 && targetPage <= totalPages && targetPage !== currentPage) {
        currentPage = targetPage;
        console.log('üî• [PREVIEW_EXAM] Page input changed to:', currentPage);
        renderPageAsImage(currentPage);
        updatePageInfo();
    } else {
        // Reset to current page if invalid
        this.value = currentPage;
    }
});

// Jump to page functionality
document.getElementById('pdf-jump-btn')?.addEventListener('click', function() {
    const jumpInput = document.getElementById('pdf-jump-input');
    if (jumpInput) {
        const targetPage = parseInt(jumpInput.value);
        if (targetPage >= 1 && targetPage <= totalPages) {
            currentPage = targetPage;
            console.log('üî• [PREVIEW_EXAM] Jump to page:', currentPage);
            renderPageAsImage(currentPage);
            updatePageInfo();
            jumpInput.value = ''; // Clear after jump
        } else {
            alert(`Please enter a page number between 1 and ${totalPages}`);
        }
    }
});

// Jump input enter key support
document.getElementById('pdf-jump-input')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('pdf-jump-btn')?.click();
    }
});

// Old complex zoom functions removed - replaced with simple image scaling system

function reRenderAtZoomLevel_REMOVED() {
    if (!currentPdfPage) return;
    
    console.log('üîç [PREVIEW_EXAM] Re-rendering at zoom level:', currentZoomLevel);
    
    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('pdf-viewer');
    
    // Calculate enhanced scale combining base scale and zoom
    const combinedScale = baseRenderScale * currentZoomLevel;
    
    // Get fresh viewport with combined scale
    const zoomedViewport = currentPdfPage.getViewport({ scale: combinedScale });
    
    // Create temporary canvas for full page at zoomed scale
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = zoomedViewport.width;
    tempCanvas.height = zoomedViewport.height;
    
    // Render at high resolution
    const renderContext = {
        canvasContext: tempCtx,
        viewport: zoomedViewport
    };
    
    currentPdfPage.render(renderContext).promise.then(() => {
        // Detect content boundaries at this scale
        const contentBounds = detectContentBoundaries(tempCanvas, tempCtx);
        
        // Get cached divider position and scale it
        const pageKey = `page_${Math.ceil(currentPageNum / 2)}`;
        let dividerX = detectedDividers.get(pageKey) || (zoomedViewport.width / 2);
        dividerX = dividerX * (combinedScale / baseRenderScale); // Scale divider to current zoom
        
        // Determine column extraction
        const isLeftColumn = (currentPageNum % 2 === 1);
        let sourceX, sourceWidth;
        
        if (isLeftColumn) {
            sourceX = 0;
            sourceWidth = dividerX;
        } else {
            sourceX = dividerX;
            sourceWidth = zoomedViewport.width - dividerX;
        }
        
        // Use content boundaries
        const sourceY = contentBounds.topBoundary;
        const sourceHeight = contentBounds.bottomBoundary - contentBounds.topBoundary;
        
        // Set final canvas size
        canvas.width = sourceWidth;
        canvas.height = sourceHeight;
        
        // Copy optimized content
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(
            tempCanvas,
            sourceX, sourceY, sourceWidth, sourceHeight,
            0, 0, canvas.width, canvas.height
        );
        
        // Update zoom display
        const zoomElement = document.getElementById('pdf-zoom-level');
        if (zoomElement) {
            zoomElement.textContent = Math.round(currentZoomLevel * 100) + '%';
        }
        
        // Reset any CSS transforms that might interfere
        container.style.transform = 'none';
        
        console.log('‚úÖ [PREVIEW_EXAM] High-quality zoom render complete:', {
            zoomLevel: currentZoomLevel,
            combinedScale,
            finalCanvasSize: { width: canvas.width, height: canvas.height }
        });
    });
}

// Note: Skip First Left Half control removed - setting is now configured during exam upload
// Display behavior - skip_first_left_half is disabled (field removed)

// Answer tracking functions
function initializeAnswerTracking() {
    // Initialize questions from saved data
    document.querySelectorAll('.question-entry').forEach(entry => {
        const questionNum = entry.dataset.questionNumber;
        const typeSelect = entry.querySelector('.question-type-select');
        const answerField = entry.querySelector('.answer-field');
        
        // Initialize SHORT answers with multiple responses
        if (typeSelect.value === 'SHORT' && answerField.value && answerField.value.includes('|')) {
            const responses = answerField.value.split('|').filter(r => r.trim());
            if (responses.length > 1) {
                const container = document.getElementById(`responses-${questionNum}`);
                if (container) {
                    container.innerHTML = '';
                    responses.forEach((response, index) => {
                        const responseDiv = document.createElement('div');
                        responseDiv.className = 'response-item';
                        responseDiv.innerHTML = `
                            <input type="text" 
                                   value="${response}"
                                   placeholder="Acceptable response ${index + 1}"
                                   onchange="updateShortAnswers(${questionNum})">
                            ${index > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                        `;
                        container.appendChild(responseDiv);
                    });
                }
            }
        }
        
        // Initialize LONG answers with multiple responses
        if (typeSelect.value === 'LONG' && answerField.value && answerField.value.includes('|||')) {
            const responses = answerField.value.split('|||').filter(r => r.trim());
            if (responses.length > 1) {
                const container = document.getElementById(`responses-${questionNum}`);
                if (container) {
                    container.innerHTML = '';
                    responses.forEach((response, index) => {
                        const responseDiv = document.createElement('div');
                        responseDiv.className = 'response-item';
                        responseDiv.innerHTML = `
                            <textarea placeholder="Grading guideline or sample answer ${index + 1}"
                                      onchange="updateLongAnswers(${questionNum})"
                                      style="min-height: 80px; width: 100%;">${response}</textarea>
                            ${index > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                        `;
                        container.appendChild(responseDiv);
                    });
                }
            }
        }
        
        // Initialize MIXED questions
        if (typeSelect.value === 'MIXED' && answerField.value) {
            try {
                const mixedData = JSON.parse(answerField.value);
                initializeMixedQuestion(questionNum, mixedData);
            } catch (e) {
                console.error('Error parsing mixed data for question', questionNum, e);
            }
        }
    });
    
    // Handle answer field changes
    document.querySelectorAll('.answer-field').forEach(input => {
        input.addEventListener('input', function() {
            const questionNum = this.dataset.question;
            answers[questionNum] = this.value;
            unsavedChanges = true;
            document.getElementById('unsaved-changes').style.display = 'inline';
            document.getElementById(`saved-${questionNum}`).style.display = 'none';
        });
        
        // Auto-save on blur
        input.addEventListener('blur', function() {
            if (this.value && unsavedChanges) {
                saveAnswer(this.dataset.question, this.value);
            }
        });
    });
    
    // Handle question type changes
    document.querySelectorAll('.question-type-select').forEach(select => {
        select.addEventListener('change', function() {
            const questionNum = this.dataset.question;
            const newType = this.value;
            updateAnswerInput(questionNum, newType);
            
            // Show/hide MCQ options
            const mcqOptions = document.getElementById(`mcq-options-${questionNum}`);
            if (newType === 'MCQ') {
                mcqOptions.style.display = 'inline';
            } else {
                mcqOptions.style.display = 'none';
            }
            
            unsavedChanges = true;
            document.getElementById('unsaved-changes').style.display = 'inline';
            document.getElementById(`saved-${questionNum}`).style.display = 'none';
        });
    });
}

// Update answer input based on question type
function updateAnswerInput(questionNum, questionType) {
    const container = document.getElementById(`answer-container-${questionNum}`);
    const currentValue = document.getElementById(`answer-${questionNum}`) ? 
                        document.getElementById(`answer-${questionNum}`).value : '';
    
    let newHtml = '';
    
    switch(questionType) {
        case 'MCQ':
            const selectedLetters = currentValue.split(',').map(v => v.trim().toUpperCase());
            const optionsCount = parseInt(document.getElementById(`options-count-${questionNum}`)?.value || 5);
            const isMultiple = document.getElementById(`multi-${questionNum}`)?.checked || false;
            const letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'].slice(0, optionsCount);
            
            newHtml = `
                <div class="mcq-options">
                    ${letters.map(letter => `
                        <button type="button" 
                                class="mcq-button ${selectedLetters.includes(letter) ? 'selected' : ''}"
                                data-question="${questionNum}"
                                data-value="${letter}"
                                data-multiple="${isMultiple}"
                                onclick="selectMCQ(${questionNum}, '${letter}')">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
                <input type="hidden" 
                       id="answer-${questionNum}" 
                       data-question="${questionNum}"
                       value="${currentValue}"
                       class="answer-field">
                <div class="answer-help" id="mcq-help-${questionNum}">
                    ${isMultiple ? 'Click to select correct answer(s) - multiple selections allowed' : 'Click to select the correct answer'}
                </div>
            `;
            break;
            
        case 'CHECKBOX':
            const selectedValues = currentValue.split(',').map(v => v.trim().toUpperCase());
            newHtml = `
                <div class="checkbox-options">
                    ${['A', 'B', 'C', 'D', 'E'].map(letter => `
                        <div class="checkbox-option">
                            <input type="checkbox" 
                                   id="check-${questionNum}-${letter}"
                                   value="${letter}"
                                   ${selectedValues.includes(letter) ? 'checked' : ''}
                                   onchange="updateCheckboxes(${questionNum})">
                            <label for="check-${questionNum}-${letter}">${letter}</label>
                        </div>
                    `).join('')}
                </div>
                <input type="hidden" 
                       id="answer-${questionNum}" 
                       data-question="${questionNum}"
                       value="${currentValue}"
                       class="answer-field">
                <div class="answer-help">Select all correct answers</div>
            `;
            break;
            
        case 'SHORT':
            const responses = currentValue ? currentValue.split('|').filter(r => r.trim()) : [''];
            newHtml = `
                <div class="short-answer-responses" id="responses-${questionNum}">
                    ${responses.map((response, index) => `
                        <div class="response-item">
                            <input type="text" 
                                   value="${response}"
                                   placeholder="Acceptable response ${index + 1}"
                                   onchange="updateShortAnswers(${questionNum})">
                            ${index > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                        </div>
                    `).join('')}
                </div>
                <button type="button" class="add-response" onclick="addResponse(${questionNum})">+ Add Response</button>
                <input type="hidden" 
                       id="answer-${questionNum}" 
                       data-question="${questionNum}"
                       value="${currentValue}"
                       class="answer-field">
                <div class="answer-help">Add multiple acceptable responses</div>
            `;
            break;
            
        case 'LONG':
            const longResponses = currentValue ? currentValue.split('|||').filter(r => r.trim()) : [''];
            newHtml = `
                <div class="short-answer-responses" id="responses-${questionNum}">
                    ${longResponses.map((response, index) => `
                        <div class="response-item">
                            <textarea placeholder="Grading guideline or sample answer ${index + 1}"
                                      onchange="updateLongAnswers(${questionNum})"
                                      style="min-height: 80px; width: 100%;">${response}</textarea>
                            ${index > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                        </div>
                    `).join('')}
                </div>
                <button type="button" class="add-response" onclick="addLongResponse(${questionNum})">+ Add Grading Guideline</button>
                <input type="hidden" 
                       id="answer-${questionNum}" 
                       data-question="${questionNum}"
                       value="${currentValue}"
                       class="answer-field">
                <div class="answer-help">Add multiple grading guidelines or sample answers</div>
            `;
            break;
            
        case 'MIXED':
            newHtml = `
                <div id="mixed-container-${questionNum}">
                    <div class="mixed-sections" id="mixed-sections-${questionNum}">
                        <!-- Mixed sections will be added here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="add-section-btn" onclick="addMixedSection(${questionNum}, 'MCQ')">+ Add Multiple Choice</button>
                        <button type="button" class="add-section-btn" onclick="addMixedSection(${questionNum}, 'SHORT')">+ Add Short Answer</button>
                        <button type="button" class="add-section-btn" onclick="addMixedSection(${questionNum}, 'LONG')">+ Add Long Answer</button>
                    </div>
                </div>
                <input type="hidden" 
                       id="answer-${questionNum}" 
                       data-question="${questionNum}"
                       value="${currentValue}"
                       class="answer-field">
                <div class="answer-help">Create a mixed question with multiple answer types</div>
            `;
            break;
    }
    
    container.innerHTML = newHtml;
    
    // Re-attach event listeners based on type
    if (questionType === 'LONG') {
        // Long answers use hidden input, update immediately
        updateLongAnswers(questionNum);
    } else if (questionType === 'SHORT') {
        updateShortAnswers(questionNum);
    } else if (questionType === 'MIXED') {
        // Initialize mixed with empty data
        updateMixedAnswers(questionNum);
    }
}

// Helper function to mark as unsaved
function markUnsaved(questionNum) {
    unsavedChanges = true;
    document.getElementById('unsaved-changes').style.display = 'inline';
    document.getElementById(`saved-${questionNum}`).style.display = 'none';
}

// MCQ selection (now supports multiple answers)
function selectMCQ(questionNum, letter) {
    const button = event.target;
    const hiddenInput = document.getElementById(`answer-${questionNum}`);
    const isMultiple = button.dataset.multiple === 'true';
    let currentAnswers = hiddenInput.value.split(',').filter(a => a.trim()).map(a => a.toUpperCase());
    
    if (isMultiple) {
        // Toggle selection for multiple answers
        if (button.classList.contains('selected')) {
            button.classList.remove('selected');
            currentAnswers = currentAnswers.filter(a => a !== letter);
        } else {
            button.classList.add('selected');
            if (!currentAnswers.includes(letter)) {
                currentAnswers.push(letter);
            }
        }
    } else {
        // Single selection - clear others first
        document.querySelectorAll(`[data-question="${questionNum}"].mcq-button`).forEach(btn => {
            btn.classList.remove('selected');
        });
        button.classList.add('selected');
        currentAnswers = [letter];
    }
    
    // Sort answers alphabetically
    currentAnswers.sort();
    
    // Update hidden input
    const newValue = currentAnswers.join(',');
    hiddenInput.value = newValue;
    answers[questionNum] = newValue;
    markUnsaved(questionNum);
}

// Update checkboxes
function updateCheckboxes(questionNum) {
    const checkboxes = document.querySelectorAll(`#answer-container-${questionNum} input[type="checkbox"]:checked`);
    const values = Array.from(checkboxes).map(cb => cb.value).join(',');
    document.getElementById(`answer-${questionNum}`).value = values;
    answers[questionNum] = values;
    markUnsaved(questionNum);
}

// Update short answers
function updateShortAnswers(questionNum) {
    const inputs = document.querySelectorAll(`#responses-${questionNum} input[type="text"]`);
    const values = Array.from(inputs).map(input => input.value).filter(v => v.trim()).join('|');
    document.getElementById(`answer-${questionNum}`).value = values;
    answers[questionNum] = values;
    markUnsaved(questionNum);
}

// Add response for short answer
function addResponse(questionNum) {
    const container = document.getElementById(`responses-${questionNum}`);
    const responseCount = container.querySelectorAll('.response-item').length;
    const newResponse = document.createElement('div');
    newResponse.className = 'response-item';
    newResponse.innerHTML = `
        <input type="text" 
               placeholder="Acceptable response ${responseCount + 1}"
               onchange="updateShortAnswers(${questionNum})">
        <button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>
    `;
    container.appendChild(newResponse);
}

// Remove response for short/long answer
function removeResponse(questionNum, button) {
    button.parentElement.remove();
    
    // Check if it's a long answer by looking for textareas
    const container = document.getElementById(`responses-${questionNum}`);
    if (container.querySelector('textarea')) {
        updateLongAnswers(questionNum);
    } else {
        updateShortAnswers(questionNum);
    }
}

// Toggle multiple answers checkbox
function toggleMultipleAnswers(questionNum) {
    const isMultiple = document.getElementById(`multi-${questionNum}`).checked;
    const buttons = document.querySelectorAll(`[data-question="${questionNum}"].mcq-button`);
    
    buttons.forEach(btn => {
        btn.dataset.multiple = isMultiple;
    });
    
    // Update help text
    const helpText = document.getElementById(`mcq-help-${questionNum}`);
    if (helpText) {
        helpText.textContent = isMultiple ? 
            'Click to select correct answer(s) - multiple selections allowed' : 
            'Click to select the correct answer';
    }
    
    // If switching to single answer, keep only first selected
    if (!isMultiple) {
        const hiddenInput = document.getElementById(`answer-${questionNum}`);
        const currentAnswers = hiddenInput.value.split(',').filter(a => a.trim());
        if (currentAnswers.length > 1) {
            hiddenInput.value = currentAnswers[0];
            answers[questionNum] = currentAnswers[0];
            
            // Update visual selection
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.value === currentAnswers[0]) {
                    btn.classList.add('selected');
                }
            });
        }
    }
    
    markUnsaved(questionNum);
}

// Update options count
function updateOptionsCount(questionNum) {
    const newCount = parseInt(document.getElementById(`options-count-${questionNum}`).value);
    updateAnswerInput(questionNum, 'MCQ');
    markUnsaved(questionNum);
}

// Update long answers
function updateLongAnswers(questionNum) {
    const textareas = document.querySelectorAll(`#responses-${questionNum} textarea`);
    const values = Array.from(textareas).map(ta => ta.value).filter(v => v.trim()).join('|||');
    document.getElementById(`answer-${questionNum}`).value = values;
    answers[questionNum] = values;
    markUnsaved(questionNum);
}

// Add long response
function addLongResponse(questionNum) {
    const container = document.getElementById(`responses-${questionNum}`);
    const responseCount = container.querySelectorAll('.response-item').length;
    const newResponse = document.createElement('div');
    newResponse.className = 'response-item';
    newResponse.innerHTML = `
        <textarea placeholder="Grading guideline or sample answer ${responseCount + 1}"
                  onchange="updateLongAnswers(${questionNum})"
                  style="min-height: 80px; width: 100%;"></textarea>
        <button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>
    `;
    container.appendChild(newResponse);
}

// Add mixed section
function addMixedSection(questionNum, type) {
    const container = document.getElementById(`mixed-sections-${questionNum}`);
    const sectionId = `mixed-${questionNum}-${Date.now()}`;
    
    let sectionHtml = '';
    const sectionDiv = document.createElement('div');
    sectionDiv.className = 'mixed-answer-section';
    sectionDiv.id = sectionId;
    
    switch(type) {
        case 'MCQ':
            sectionDiv.innerHTML = `
                <div class="mixed-type-header">
                    <span class="mixed-type-label">Multiple Choice</span>
                    <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                </div>
                <div class="mcq-options">
                    ${['A', 'B', 'C', 'D', 'E'].map(letter => `
                        <button type="button" 
                                class="mcq-button"
                                data-section="${sectionId}"
                                data-value="${letter}"
                                onclick="selectMixedMCQ('${sectionId}', '${letter}', ${questionNum})">
                            ${letter}
                        </button>
                    `).join('')}
                </div>
            `;
            break;
            
        case 'SHORT':
            sectionDiv.innerHTML = `
                <div class="mixed-type-header">
                    <span class="mixed-type-label">Short Answer</span>
                    <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                </div>
                <input type="text" 
                       placeholder="Enter acceptable answer"
                       onchange="updateMixedAnswers(${questionNum})"
                       style="width: 100%; padding: 8px;">
            `;
            break;
            
        case 'LONG':
            sectionDiv.innerHTML = `
                <div class="mixed-type-header">
                    <span class="mixed-type-label">Long Answer</span>
                    <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                </div>
                <textarea placeholder="Enter grading guidelines"
                          onchange="updateMixedAnswers(${questionNum})"
                          style="width: 100%; min-height: 80px; padding: 8px;"></textarea>
            `;
            break;
    }
    
    container.appendChild(sectionDiv);
    updateMixedAnswers(questionNum);
}

// Remove mixed section
function removeMixedSection(sectionId, questionNum) {
    document.getElementById(sectionId).remove();
    updateMixedAnswers(questionNum);
}

// Update mixed answers
function updateMixedAnswers(questionNum) {
    const sections = document.querySelectorAll(`#mixed-sections-${questionNum} .mixed-answer-section`);
    const mixedData = [];
    
    sections.forEach(section => {
        const typeLabel = section.querySelector('.mixed-type-label').textContent;
        let value = '';
        
        if (typeLabel === 'Multiple Choice') {
            const selected = Array.from(section.querySelectorAll('.mcq-button.selected'))
                .map(btn => btn.dataset.value);
            value = selected.join(',');
        } else if (typeLabel === 'Short Answer') {
            value = section.querySelector('input').value;
        } else if (typeLabel === 'Long Answer') {
            value = section.querySelector('textarea').value;
        }
        
        if (value) {
            mixedData.push({type: typeLabel, value: value});
        }
    });
    
    const jsonValue = JSON.stringify(mixedData);
    document.getElementById(`answer-${questionNum}`).value = jsonValue;
    answers[questionNum] = jsonValue;
    markUnsaved(questionNum);
}

// Select MCQ in mixed section
function selectMixedMCQ(sectionId, letter, questionNum) {
    const button = event.target;
    button.classList.toggle('selected');
    updateMixedAnswers(questionNum);
}

// Initialize mixed question from saved data
function initializeMixedQuestion(questionNum, mixedData) {
    const container = document.getElementById(`mixed-sections-${questionNum}`);
    if (!container) return;
    
    container.innerHTML = ''; // Clear existing content
    
    mixedData.forEach(section => {
        const sectionId = `mixed-${questionNum}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'mixed-answer-section';
        sectionDiv.id = sectionId;
        
        switch(section.type) {
            case 'Multiple Choice':
                sectionDiv.innerHTML = `
                    <div class="mixed-type-header">
                        <span class="mixed-type-label">Multiple Choice</span>
                        <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                    </div>
                    <div class="mcq-options">
                        ${['A', 'B', 'C', 'D', 'E'].map(letter => `
                            <button type="button" 
                                    class="mcq-button ${section.value && section.value.includes(letter) ? 'selected' : ''}"
                                    data-section="${sectionId}"
                                    data-value="${letter}"
                                    onclick="selectMixedMCQ('${sectionId}', '${letter}', ${questionNum})">
                                ${letter}
                            </button>
                        `).join('')}
                    </div>
                `;
                break;
                
            case 'Short Answer':
                sectionDiv.innerHTML = `
                    <div class="mixed-type-header">
                        <span class="mixed-type-label">Short Answer</span>
                        <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                    </div>
                    <input type="text" 
                           value="${section.value || ''}"
                           placeholder="Enter acceptable answer"
                           onchange="updateMixedAnswers(${questionNum})"
                           style="width: 100%; padding: 8px;">
                `;
                break;
                
            case 'Long Answer':
                sectionDiv.innerHTML = `
                    <div class="mixed-type-header">
                        <span class="mixed-type-label">Long Answer</span>
                        <button type="button" class="remove-section-btn" onclick="removeMixedSection('${sectionId}', ${questionNum})">Remove</button>
                    </div>
                    <textarea placeholder="Enter grading guidelines"
                              onchange="updateMixedAnswers(${questionNum})"
                              style="width: 100%; min-height: 80px; padding: 8px;">${section.value || ''}</textarea>
                `;
                break;
        }
        
        container.appendChild(sectionDiv);
    });
}

// Toggle audio for a question
function toggleAudio(questionNum) {
    console.log('Current audio assignments:', audioAssignments);
    console.log('Toggling audio for question:', questionNum);
    
    // Get existing audio files for this exam (for assignment interface only)
    const audioFiles = [
        
        {
            id: 48,
            name: "EFL Phonics 3rd E_Placement Test_Track 4_D",
            url: "/api/placement/audio/48/",
            filename: "exams/audio/EFL_Phonics_3rd_E_Placement_Test_Track_4_D.mp3"
        },
        
        {
            id: 49,
            name: "EFL Phonics 3rd E_Placement Test_Track 5_E",
            url: "/api/placement/audio/49/",
            filename: "exams/audio/EFL_Phonics_3rd_E_Placement_Test_Track_5_E.mp3"
        },
        
        {
            id: 50,
            name: "Prime Path_Prime Edge_Pursuit_Level 1",
            url: "/api/placement/audio/50/",
            filename: "exams/audio/Prime_Path_Prime_Edge_Pursuit_Level_1.mp3"
        },
        
    ];
    
    if (audioFiles.length === 0) {
        alert('No audio files have been uploaded for this exam.\n\nTo add audio files:\n1. Go to Exam List\n2. Click "Upload New Exam" to create a new exam with audio files');
        return;
    }
    
    // Check if this question has an assigned audio (from our tracking)
    const currentAssignedAudioId = audioAssignments[questionNum];
    let currentAssignedAudio = null;
    if (currentAssignedAudioId) {
        currentAssignedAudio = audioFiles.find(a => a.id === currentAssignedAudioId);
    }
    
    // Current assignment is already handled by audioAssignments object
    
    // Build audio list with clear indication of current assignment
    let audioList = 'üéµ ASSIGN AUDIO TO QUESTION ' + questionNum + '\n';
    audioList += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    audioList += 'Available Audio Files:\n';
    audioFiles.forEach((audio, index) => {
        // Display the audio name, or extract filename if name is generic
        let displayName = audio.name;
        if (displayName === 'Audio File' || displayName.startsWith('Audio ')) {
            // Extract filename from path and remove extension
            const parts = audio.filename.split('/');
            const filename = parts[parts.length - 1];
            displayName = filename.replace(/\.[^/.]+$/, ''); // Remove extension
        }
        
        // Check localStorage for updated name
    const localAudioNames = JSON.parse(localStorage.getItem(`exam_${examId}_audio_names`) || '{}');
    const storedName = localAudioNames[audio.id];
    if (storedName) {
        displayName = storedName;
    }
    
    audioList += `${index + 1}. ${displayName}`;
        if (currentAssignedAudio && currentAssignedAudio.id === audio.id) {
            audioList += ' ‚Üê CURRENTLY ASSIGNED';
        }
        audioList += '\n';
    });
    
    audioList += '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
    audioList += 'To assign audio: Enter the number (1-' + audioFiles.length + ')\n';
    audioList += 'To remove audio: Enter 0\n';
    audioList += 'To cancel: Click Cancel\n\n';
    audioList += 'Example: Enter "2" to assign "ss" to this question';
    
    const choice = prompt(audioList);
    if (choice !== null && choice !== '') {
        const choiceNum = parseInt(choice);
        if (choiceNum === 0) {
            // Remove assignment
            removeAudioAssignment(questionNum);
        } else if (!isNaN(choiceNum)) {
            const index = choiceNum - 1;
            if (index >= 0 && index < audioFiles.length) {
                const selectedAudio = audioFiles[index];
                assignAudioToQuestion(questionNum, selectedAudio);
            }
        }
    }
}

// Assign audio to question
function assignAudioToQuestion(questionNum, audio) {
    console.log('Assigning audio:', audio, 'to question:', questionNum);
    
    // Track the assignment
    audioAssignments[questionNum] = audio.id;
    
    // Get the display name from localStorage or use original
    const localAudioNames = JSON.parse(localStorage.getItem(`exam_${examId}_audio_names`) || '{}');
    const displayName = localAudioNames[audio.id] || audio.name;
    console.log('Display name:', displayName, 'for audio ID:', audio.id);
    
    // Update the UI
    const button = document.querySelector(`[data-question="${questionNum}"].audio-button`);
    if (button) {
        button.classList.add('has-audio');
        // Update button text to show which audio is assigned
        const shortName = displayName.substring(0, 20) + (displayName.length > 20 ? '...' : '');
        button.innerHTML = `üéµ Audio: ${shortName}`;
    }
    
    // Mark as unsaved
    markUnsaved(questionNum);
    
    // Show confirmation
    alert(`Audio "${displayName}" assigned to Question ${questionNum}!\n\nNote: This assignment is temporary. Click "Save All" to save changes.`);
}

// Remove audio assignment
function removeAudioAssignment(questionNum) {
    // Remove from tracking
    delete audioAssignments[questionNum];
    
    // Update the UI
    const button = document.querySelector(`[data-question="${questionNum}"].audio-button`);
    if (button) {
        button.classList.remove('has-audio');
        button.innerHTML = 'üéµ Audio';
    }
    
    // Mark as unsaved
    markUnsaved(questionNum);
    
    alert(`Audio assignment removed from Question ${questionNum}.`);
}

function saveAnswer(questionNum, answer) {
    // This would make an API call to save individual answer
    // For now, we'll just show the saved indicator
    document.getElementById(`saved-${questionNum}`).style.display = 'inline';
}

function saveAllAnswers() {
    const questionsData = [];
    
    document.querySelectorAll('.question-entry').forEach(entry => {
        const questionNum = entry.dataset.questionNumber;
        const questionId = entry.dataset.questionId;
        const answerField = entry.querySelector('.answer-field');
        const typeSelect = entry.querySelector('.question-type-select');
        const optionsCount = document.getElementById(`options-count-${questionNum}`);
        
        let correctAnswer = answerField.value;
        
        // For SHORT answers, collect from multiple input fields
        if (typeSelect.value === 'SHORT') {
            const responseContainer = document.getElementById(`responses-${questionNum}`);
            if (responseContainer) {
                const inputs = responseContainer.querySelectorAll('input[type="text"]');
                if (inputs.length > 0) {
                    const values = Array.from(inputs).map(input => input.value).filter(v => v.trim());
                    correctAnswer = values.join('|');
                }
            }
        }
        
        // For LONG answers, collect from multiple textareas
        if (typeSelect.value === 'LONG') {
            const responseContainer = document.getElementById(`responses-${questionNum}`);
            if (responseContainer) {
                const textareas = responseContainer.querySelectorAll('textarea');
                if (textareas.length > 0) {
                    const values = Array.from(textareas).map(ta => ta.value).filter(v => v.trim());
                    correctAnswer = values.join('|||');
                }
            }
        }
        
        // For MIXED answers, collect the JSON data
        if (typeSelect.value === 'MIXED') {
            const sections = document.querySelectorAll(`#mixed-sections-${questionNum} .mixed-answer-section`);
            const mixedData = [];
            
            sections.forEach(section => {
                const typeLabel = section.querySelector('.mixed-type-label').textContent;
                let value = '';
                
                if (typeLabel === 'Multiple Choice') {
                    const selected = Array.from(section.querySelectorAll('.mcq-button.selected'))
                        .map(btn => btn.dataset.value);
                    value = selected.join(',');
                } else if (typeLabel === 'Short Answer') {
                    value = section.querySelector('input').value;
                } else if (typeLabel === 'Long Answer') {
                    value = section.querySelector('textarea').value;
                }
                
                if (value) {
                    mixedData.push({type: typeLabel, value: value});
                }
            });
            
            correctAnswer = JSON.stringify(mixedData);
        }
        
        const data = {
            id: questionId,
            question_number: questionNum,
            question_type: typeSelect.value,
            correct_answer: correctAnswer
        };
        
        // Add options count for MCQ, CHECKBOX, and SHORT question types
        if ((typeSelect.value === 'MCQ' || typeSelect.value === 'CHECKBOX' || typeSelect.value === 'SHORT') && optionsCount) {
            data.options_count = parseInt(optionsCount.value);
        }
        
        questionsData.push(data);
    });
    
    // Debug: Log the URL being called
    const saveUrl = `/api/placement/exams/5ba6870f-7f9f-437c-86e7-37ed04933d97/save-answers/`;
    console.log('Saving to URL:', saveUrl);
    console.log('Data being sent:', questionsData);
    console.log('Audio assignments being saved:', audioAssignments);
    
    // Make API call to save all answers and types INCLUDING audio assignments
    fetch(saveUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
            questions: questionsData,
            audio_assignments: audioAssignments 
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            unsavedChanges = false;
            document.getElementById('unsaved-changes').style.display = 'none';
            
            // Show the prominent success notification
            const notification = document.getElementById('success-notification');
            const alertDiv = notification.querySelector('.alert');
            notification.style.display = 'block';
            
            // Apply animations
            alertDiv.style.animation = 'slideDown 0.5s ease-out, pulse 2s ease-in-out';
            
            // Scroll to top to ensure notification is visible
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Force page refresh after brief success display to clear any browser cache
            setTimeout(() => {
                console.log('üîÑ Refreshing page to ensure latest data is displayed');
                window.location.reload(true); // Hard refresh to bypass cache
            }, 2000);
            
            // Also show the small save indicators
            document.querySelectorAll('.save-indicator').forEach(indicator => {
                indicator.style.display = 'inline';
            });
            
            // Auto-hide the notification after 8 seconds
            setTimeout(() => {
                const notif = document.getElementById('success-notification');
                const alert = notif.querySelector('.alert');
                alert.style.transition = 'opacity 0.5s ease-out';
                alert.style.opacity = '0';
                setTimeout(() => {
                    notif.style.display = 'none';
                    alert.style.opacity = '1';
                }, 500);
            }, 8000);
            
            // Hide small indicators after 3 seconds
            setTimeout(() => {
                document.querySelectorAll('.save-indicator').forEach(indicator => {
                    indicator.style.display = 'none';
                });
            }, 3000);
        } else {
            console.error('Save error:', data);
            alert('Error saving answers: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Save request failed:', error);
        alert('Error saving answers: ' + error.message);
    });
}

function clearAllAnswers() {
    if (confirm('Are you sure you want to clear all answers?')) {
        document.querySelectorAll('.answer-field').forEach(input => {
            input.value = '';
        });
        unsavedChanges = true;
        document.getElementById('unsaved-changes').style.display = 'inline';
        document.querySelectorAll('.save-indicator').forEach(indicator => {
            indicator.style.display = 'none';
        });
    }
}

// Randomize answers for QA testing
function randomizeAnswers() {
    if (!confirm('This will randomize all answers for QA testing. Continue?')) {
        return;
    }
    
    document.querySelectorAll('.question-entry').forEach(entry => {
        const questionNum = entry.dataset.questionNumber;
        const typeSelect = entry.querySelector('.question-type-select');
        const questionType = typeSelect.value;
        
        switch(questionType) {
            case 'MCQ':
                // For MCQ, randomly select answer(s)
                const isMultiple = document.getElementById(`multi-${questionNum}`)?.checked || false;
                const optionsCount = parseInt(document.getElementById(`options-count-${questionNum}`)?.value || 5);
                const availableOptions = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'].slice(0, optionsCount);
                
                // Clear all selections first
                document.querySelectorAll(`[data-question="${questionNum}"].mcq-button`).forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                if (isMultiple) {
                    // Select 1-3 random answers for multiple choice
                    const numAnswers = Math.floor(Math.random() * 3) + 1;
                    const selectedAnswers = [];
                    for (let i = 0; i < numAnswers; i++) {
                        const randomIndex = Math.floor(Math.random() * availableOptions.length);
                        const option = availableOptions[randomIndex];
                        if (!selectedAnswers.includes(option)) {
                            selectedAnswers.push(option);
                            const btn = document.querySelector(`[data-question="${questionNum}"][data-value="${option}"]`);
                            if (btn) btn.classList.add('selected');
                        }
                    }
                    document.getElementById(`answer-${questionNum}`).value = selectedAnswers.sort().join(',');
                } else {
                    // Select one random answer
                    const randomOption = availableOptions[Math.floor(Math.random() * availableOptions.length)];
                    const btn = document.querySelector(`[data-question="${questionNum}"][data-value="${randomOption}"]`);
                    if (btn) btn.classList.add('selected');
                    document.getElementById(`answer-${questionNum}`).value = randomOption;
                }
                break;
                
            case 'SHORT':
                // Generate random short answers
                const shortAnswers = [
                    ['answer', 'response', 'solution'],
                    ['cat', 'dog', 'bird'],
                    ['red', 'blue', 'green'],
                    ['yes', 'correct', 'true'],
                    ['10', 'ten', '10.0']
                ];
                const randomShortSet = shortAnswers[Math.floor(Math.random() * shortAnswers.length)];
                
                // Clear existing responses
                const shortContainer = document.getElementById(`responses-${questionNum}`);
                shortContainer.innerHTML = '';
                
                // Add random responses
                randomShortSet.forEach((answer, index) => {
                    const responseDiv = document.createElement('div');
                    responseDiv.className = 'response-item';
                    responseDiv.innerHTML = `
                        <input type="text" 
                               value="${answer}"
                               placeholder="Acceptable response ${index + 1}"
                               onchange="updateShortAnswers(${questionNum})">
                        ${index > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                    `;
                    shortContainer.appendChild(responseDiv);
                });
                updateShortAnswers(questionNum);
                break;
                
            case 'LONG':
                // Generate random grading guidelines
                const guidelines = [
                    'Student should demonstrate clear understanding of the concept',
                    'Answer must include specific examples',
                    'Response should be 2-3 paragraphs',
                    'Must reference the main topic',
                    'Should show critical thinking'
                ];
                
                // Clear existing responses
                const longContainer = document.getElementById(`responses-${questionNum}`);
                longContainer.innerHTML = '';
                
                // Add 2-3 random guidelines
                const numGuidelines = Math.floor(Math.random() * 2) + 2;
                for (let i = 0; i < numGuidelines; i++) {
                    const responseDiv = document.createElement('div');
                    responseDiv.className = 'response-item';
                    const guideline = guidelines[Math.floor(Math.random() * guidelines.length)];
                    responseDiv.innerHTML = `
                        <textarea placeholder="Grading guideline or sample answer ${i + 1}"
                                  onchange="updateLongAnswers(${questionNum})"
                                  style="min-height: 80px; width: 100%;">${guideline}</textarea>
                        ${i > 0 ? `<button type="button" class="remove-response" onclick="removeResponse(${questionNum}, this)">Remove</button>` : ''}
                    `;
                    longContainer.appendChild(responseDiv);
                }
                updateLongAnswers(questionNum);
                break;
                
            case 'MIXED':
                // For mixed type, add random sections
                const mixedContainer = document.getElementById(`mixed-sections-${questionNum}`);
                mixedContainer.innerHTML = '';
                
                // Add MCQ section
                addMixedSection(questionNum, 'MCQ');
                setTimeout(() => {
                    const mcqSection = mixedContainer.querySelector('.mcq-button');
                    if (mcqSection) {
                        mcqSection.click(); // Select option A
                    }
                }, 100);
                
                // Add short answer section
                addMixedSection(questionNum, 'SHORT');
                setTimeout(() => {
                    const shortInput = mixedContainer.querySelector('input[type="text"]');
                    if (shortInput) {
                        shortInput.value = 'Sample answer';
                        updateMixedAnswers(questionNum);
                    }
                }, 200);
                break;
        }
        
        markUnsaved(questionNum);
    });
    
    alert('Answers have been randomized for QA testing!');
}

// Mark audio name as changed
function markAudioNameChanged(audioId) {
    changedAudioNames.add(audioId);
    document.getElementById(`audio-saved-${audioId}`).style.display = 'none';
    
    // Store the local name
    const nameInput = document.getElementById(`audio-name-${audioId}`);
    if (nameInput) {
        localAudioNames[audioId] = nameInput.value.trim();
    }
}

// Delete audio file from exam
function renameAudioFile(audioId) {
    const input = document.getElementById(`audio-name-${audioId}`);
    const currentName = input.value;
    const newName = prompt('Enter new name for this audio file:', currentName);
    
    if (newName && newName !== currentName) {
        input.value = newName;
        markAudioNameChanged(audioId);
    }
}

function deleteAudioFile(audioId) {
    if (!confirm('Are you sure you want to remove this audio file from the exam?')) {
        return;
    }
    
    // Make API call to delete audio
    fetch(`/api/placement/exams/5ba6870f-7f9f-437c-86e7-37ed04933d97/audio/${audioId}/delete/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Remove the audio item from the UI
            const audioItem = document.getElementById(`audio-item-${audioId}`);
            if (audioItem) {
                audioItem.remove();
            }
            
            // Remove from local tracking
            delete localAudioNames[audioId];
            changedAudioNames.delete(audioId);
            
            alert('Audio file removed from exam successfully!');
            
            // If no audio files left, hide the entire section
            const audioSection = document.querySelector('.audio-files-section');
            const remainingItems = audioSection.querySelectorAll('.audio-file-item');
            if (remainingItems.length === 0) {
                audioSection.style.display = 'none';
            }
        } else {
            alert('Error removing audio file: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Delete request failed:', error);
        alert('Error removing audio file: ' + error.message);
    });
}

// Save all audio names (locally for this exam view only)
function saveAllAudioNames() {
    if (changedAudioNames.size === 0) {
        alert('No audio names have been changed.');
        return;
    }
    
    // Save to localStorage for this specific exam
    const storageKey = `exam_${examId}_audio_names`;
    
    // Update localAudioNames with all current values
    changedAudioNames.forEach(audioId => {
        const nameInput = document.getElementById(`audio-name-${audioId}`);
        if (nameInput) {
            localAudioNames[audioId] = nameInput.value.trim();
        }
    });
    
    // Save to localStorage
    localStorage.setItem(storageKey, JSON.stringify(localAudioNames));
    
    // Clear the changed set and show saved indicators
    changedAudioNames.forEach(audioId => {
        document.getElementById(`audio-saved-${audioId}`).style.display = 'inline';
    });
    changedAudioNames.clear();
    
    // Update audio buttons in the answer section
    updateAudioButtonNames();
    
    // Hide saved indicators after 3 seconds
    setTimeout(() => {
        document.querySelectorAll('.audio-save-indicator').forEach(indicator => {
            indicator.style.display = 'none';
        });
    }, 3000);
    
    alert('Audio display names saved locally for this exam!');
}

// Load local audio names from localStorage
function loadLocalAudioNames() {
    const storageKey = `exam_${examId}_audio_names`;
    const saved = localStorage.getItem(storageKey);
    
    if (saved) {
        try {
            const savedNames = JSON.parse(saved);
            Object.assign(localAudioNames, savedNames);
            
            // Apply saved names to input fields
            Object.keys(savedNames).forEach(audioId => {
                const input = document.getElementById(`audio-name-${audioId}`);
                if (input) {
                    input.value = savedNames[audioId];
                }
            });
        } catch (e) {
            console.error('Error loading saved audio names:', e);
        }
    }
}

// Update audio button names after saving
function updateAudioButtonNames() {
    // Get the latest saved names from localStorage
    const savedNames = JSON.parse(localStorage.getItem(`exam_${examId}_audio_names`) || '{}');
    
    // Update all audio buttons based on current assignments
    Object.entries(audioAssignments).forEach(([questionNum, audioId]) => {
        const button = document.querySelector(`[data-question="${questionNum}"].audio-button`);
        if (button) {
            // Get the display name
            const displayName = savedNames[audioId] || 
                               document.getElementById(`audio-name-${audioId}`)?.value || 
                               'Audio ' + audioId;
            
            const shortName = displayName.substring(0, 20) + (displayName.length > 20 ? '...' : '');
            button.innerHTML = `üéµ Audio: ${shortName}`;
        }
    });
}



// Warn before leaving with unsaved changes
window.addEventListener('beforeunload', function(e) {
    if (unsavedChanges || changedAudioNames.size > 0) {
        e.preventDefault();
        e.returnValue = '';
    }
});
</script>

        </div>
    </div>
    
    
</body>
</html>